(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{1562:(e,t,n)=>{Promise.resolve().then(n.bind(n,68246))},68246:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>rI});var r=n(95155),o=n(12115),i=n(87971),l=n(41236);let a=(0,i.lh)(),s=(0,i.lh)(),d=(0,i.y$)({open:!1,message:"",severity:"info"}),c=(0,i.lh)(),u=(0,i.lh)();async function p(e){let{message:t,model:n,apiKey:r}=e;try{var o,i,l;let e=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:null!=n?n:"mistralai/mixtral-8x7b-instruct",messages:[{role:"user",content:t}]})});if(!e.ok)throw Error("OpenRouter API error: ".concat(e.status));let a=await e.json(),s=null===(l=a.choices)||void 0===l?void 0:null===(i=l[0])||void 0===i?void 0:null===(o=i.message)||void 0===o?void 0:o.content;if("string"==typeof s)return s.trim();throw Error("Malformed OpenRouter response")}catch(e){return console.error("OpenRouter API error",e),"Sorry, there was an error processing your request."}}(0,l.c)({source:c,timeout:2500,target:u}),(0,i.XM)({source:d,clock:a,filter:(e,t)=>{let{open:n}=e,{message:r}=t;return!n&&!!r},fn:(e,t)=>{let{message:n,severity:r="info"}=t;return{open:!0,message:n,severity:r}},target:d}),(0,i.XM)({source:d,filter:e=>{let{open:t}=e;return!!t},target:c}),(0,i.XM)({clock:[s,u],source:d,filter:e=>{let{open:t}=e;return!!t},fn:(e,t)=>{let{message:n="",severity:r="info"}=t||{};return{open:!1,message:n,severity:r}},target:d});let g="openrouter_api_key",m="default_temperature",h="default_system_prompt",x=(0,i.$5)("settings"),f=x.event("loadSettings"),v=x.event("settingsLoaded"),y=x.event("apiKeyChanged"),j=x.event("temperatureChanged"),A=x.event("systemPromptChanged"),w=x.store("",{name:"apiKey"}),b=x.store(.7,{name:"temperature"}),k=x.store("",{name:"systemPrompt"}),M=x.store(!1,{name:"settingsLoaded"}).on(v,()=>!0),S=(0,i.kg)({apiKey:w,temperature:b,systemPrompt:k}),C=x.effect({name:"loadSettingsFx",handler:async()=>{var e,t;let n=null!==(e=localStorage.getItem(g))&&void 0!==e?e:"",r=localStorage.getItem(m),o=null!==(t=localStorage.getItem(h))&&void 0!==t?t:"",i=.7;if(r){let e=parseFloat(r);isNaN(e)||(i=e)}return{apiKey:n,temperature:i,systemPrompt:o}}}),I=x.effect({name:"saveSettingsFx",handler:async e=>{let{apiKey:t,temperature:n,systemPrompt:r}=e;localStorage.setItem(g,t),localStorage.setItem(m,String(n)),localStorage.setItem(h,r)}});(0,i.XM)({clock:f,target:C}),(0,i.XM)({clock:C.doneData,target:v}),w.on(v,(e,t)=>t.apiKey),b.on(v,(e,t)=>t.temperature),k.on(v,(e,t)=>t.systemPrompt),w.on(y,(e,t)=>t),b.on(j,(e,t)=>t),k.on(A,(e,t)=>t),(0,i.XM)({clock:S,filter:M,target:I}),C.fail.watch(e=>{let{error:t}=e;console.error("Failed to load settings:",t)}),I.fail.watch(e=>{let{error:t}=e;console.error("Failed to save settings:",t)});var D=n(4602);let E=(0,i.$5)("models"),T=E.store([],{name:"availableModels"}),z=E.store("openrouter/quasar-alpha",{name:"selectedModelId"}),F=E.store(!1,{name:"isLoadingModels"}),X=E.store(!1,{name:"showFreeOnly"}),P=E.store(!1,{name:"isModelSelectorActive"}),O=E.event("setShowFreeOnly");X.on(O,(e,t)=>t),(0,D.Zr)({store:X,key:"showFreeOnly"}),(0,D.Zr)({store:z,key:"selectedModelId"});let R=E.store("google/gemini-2.0-flash-lite-001",{name:"autoTitleModelId"}),L=E.event("autoTitleModelSelected");R.on(L,(e,t)=>t),(0,D.Zr)({store:R,key:"autoTitleModelId"});let U=E.store(null,{name:"modelsError"}),W=E.event("fetchModels"),N=E.event("modelSelected"),B=E.event("modelSelectorFocused"),G=E.effect({name:"fetchModelsFx",handler:async()=>{let e=await fetch("https://openrouter.ai/api/v1/models");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).data.sort((e,t)=>{var n,r;return(null!==(n=t.created)&&void 0!==n?n:0)-(null!==(r=e.created)&&void 0!==r?r:0)})}});(0,i.XM)({clock:W,target:G}),F.on(G,()=>!0).reset(G.finally),T.on(G.doneData,(e,t)=>t),(0,i.XM)({clock:G.doneData,source:z,fn:(e,t)=>t.length>0?t.some(t=>t.id===e)?e:t[0].id:e,target:z}),z.on(N,(e,t)=>t),U.on(G.failData,(e,t)=>t.message).reset(G),U.reset(G.done),P.on(B,(e,t)=>t);var $=n(76012);let q=async e=>{let{modelId:t,messages:n,apiKey:r,temperature:o,systemPrompt:i}=e,l=[];i&&i.trim()&&l.push({role:"system",content:i}),n.forEach(e=>{("user"===e.role||"assistant"===e.role)&&l.push({role:e.role,content:e.content})});let a=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:t,messages:l,temperature:o})});if(!a.ok){let e="HTTP error! status: ".concat(a.status);try{let t=await a.json();e="API Error (".concat(a.status,"): ").concat(t.error.message)}catch(e){}throw Error(e)}return await a.json()},H=(e,t)=>{var n,r,o;let{messages:i}=e,l=null===(o=t.choices)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(n=r.message)||void 0===n?void 0:n.content;return[...i,l?{id:t.id||crypto.randomUUID(),role:"assistant",content:l,timestamp:Date.now()}:{id:t.id||crypto.randomUUID(),role:"assistant",content:"Error: Empty response",timestamp:Date.now()}]},_=(e,t)=>{let n,{messages:r,apiKey:o,temperature:i,systemPrompt:l,selectedModelId:a}=e,s=r.findIndex(e=>e.id===t.id);if(-1===s)throw Error("Message to retry not found: "+t.id);if("user"===t.role)n=r.slice(0,s+1);else{if(s<0)throw Error("Invalid retryIndex for assistant message retry.");n=r.slice(0,s)}return{modelId:a,messages:n,apiKey:o,temperature:i,systemPrompt:l}},K=(e,t)=>{var n,r,o,i,l,a,s,d;let c;let{messages:u,requestContext:p}=e,g=-1,m=!1;if((null==p?void 0:p.type)==="generate"){if(-1===(g=u.findIndex(e=>e.id===p.placeholderId)))return console.error("Generating placeholder message not found for replacement:",p.placeholderId),null;m=!1,console.log("[DEBUG][lib] calculateRetryUpdatePayloadFn: GENERATE FLOW RETURNING:",{targetIndex:g,newAssistantMessageId:(c={id:t.id||crypto.randomUUID(),role:"assistant",content:null!==(i=null===(o=t.choices)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(n=r.message)||void 0===n?void 0:n.content)&&void 0!==i?i:"Error: Empty response",timestamp:Date.now(),isLoading:!1}).id,insert:m}),console.log("[DEBUG] calculateRetryUpdatePayloadFn: GENERATE FLOW RETURNING:",{targetIndex:g,newAssistantMessage:c,insert:m})}else{if((null==p?void 0:p.type)!=="retry")return console.error("calculateRetryUpdatePayloadFn called with unexpected context:",p),null;let{originalMessageId:e,originalRole:n}=p;if(c={id:t.id||crypto.randomUUID(),role:"assistant",content:null!==(d=null===(s=t.choices)||void 0===s?void 0:null===(a=s[0])||void 0===a?void 0:null===(l=a.message)||void 0===l?void 0:l.content)&&void 0!==d?d:"Error: Empty response",timestamp:Date.now()},"assistant"===n)g=u.findIndex(t=>t.id===e);else{if("user"!==n)return console.error("Unexpected original role in retry context:",n),null;let t=u.findIndex(t=>t.id===e);if(-1===t)return console.error("Original user message for retry not found:",e),null;let r=u.findIndex((e,n)=>n>t&&"assistant"===e.role);-1!==r?(g=r,m=!1):(g=t,m=!0,console.log("[calculateRetryUpdatePayloadFn] No assistant after retried user message, inserting new assistant message after user:",e))}}if(-1===g)return console.error("Retry logic error: Could not determine target index."),null;let h={targetIndex:g,newAssistantMessage:c,insert:m};return -1===g?(console.error("Retry logic error: Final targetIndex is -1. Returning null."),null):h},Y=(e,t)=>{let{messageId:n,role:r}=t;if("assistant"===r)return n;{let t=e.findIndex(e=>e.id===n);if(-1===t)return console.error("Retrying user message not found:",n),null;let r=e.find((e,n)=>n>t&&"assistant"===e.role);return r?r.id:null}},Z=(e,t)=>{let{targetIndex:n,newAssistantMessage:r,insert:o=!1}=t;if(o){let t=[...e];return n>=-1&&n<e.length?(t.splice(n+1,0,r),t):(console.error("Retry update (insert) received invalid index:",n),e)}if(-1!==n&&n<e.length)return e.map((e,t)=>t===n?r:e);if(n===e.length){let t=[...e];return t[t.length-1]=r,t}return console.error("Retry update (replace) received invalid index or state."),e},V=(0,i.$5)("chat"),J=V.event("messageTextChanged"),Q=V.event("messageSent"),ee=V.event("editMessage"),et=V.event("deleteMessage"),en=V.event("messageRetry"),er=V.event("initialChatSaveNeeded"),eo=V.event("apiKeyMissing"),ei=V.event("apiRequestTokensUpdated"),el=V.event("userMessageCreated"),ea=V.event("scrollToLastMessageNeeded"),es=V.event("setPreventScroll"),ed=V.event("generateResponseClicked"),ec=V.event("retryUpdate"),eu=V.event("normalResponseProcessed"),ep=V.event("mainInputFocused"),eg=V.event("messageRetryInitiated"),em=V.event("prepareRetryParams"),eh=V.event("calculatedRetryUpdate"),ex=V.event("addPlaceholderForGeneration"),ef=V.event("placeholderGenerated"),ev=V.effect({name:"sendApiRequestFx",handler:q}),ey=V.store("",{name:"$messageText"}),ej=V.store([],{name:"$messages"}),eA=V.store(!1,{name:"$isGenerating"}),ew=V.store(0,{name:"$currentChatTokens"}),eb=V.store(null,{name:"$apiError"}),ek=V.store(null,{name:"$retryingMessageId"}),eM=V.store(!1,{name:"$preventScroll"}),eS=V.store(0,{name:"$scrollTrigger"}).on(ea,()=>Date.now()),eC=V.store(!1,{name:"$isMainInputFocused"}).on(ep,(e,t)=>t),eI=e=>!!e&&("user"===e.role||"assistant"===e.role);ey.on(J,(e,t)=>t),ej.on(ee,(e,t)=>{let{messageId:n,newContent:r}=t;return e.map(e=>e.id===n?{...e,content:r,isEdited:!0,originalContent:e.content}:e)}).on(et,(e,t)=>e.filter(e=>e.id!==t)).on(el,(e,t)=>[...e,t]).on(ef,(e,t)=>[...e,t]).on(ec,(e,t)=>Z(e,t)).on(ev.done,(e,t)=>{var n;let{params:r,result:o}=t;return(null===(n=r.requestContext)||void 0===n?void 0:n.type)==="normal"?H({messages:e},o):e}),eb.reset(Q,ed,en),eA.on(ev,()=>!0).reset(ev.finally),ew.on(ev.doneData,(e,t)=>{var n,r;return e+(null!==(r=null===(n=t.usage)||void 0===n?void 0:n.total_tokens)&&void 0!==r?r:0)}),ek.on(eg,(e,t)=>{let n=ej.getState();return"assistant"===t.role?t.messageId:Y(n,t)}).on(ef,(e,t)=>t.id).reset(ev.finally),eM.on([ee],()=>!0).on([eg,ed],()=>!1).on(ev.finally,(e,t)=>null===ek.getState()&&e),(0,i.XM)({clock:Q,source:ey,filter:e=>e.trim().length>0,fn:e=>({id:crypto.randomUUID(),role:"user",content:e.trim(),timestamp:Date.now()}),target:el}),(0,i.XM)({clock:el,fn:()=>"",target:ey}),(0,i.XM)({clock:el,source:ej,filter:e=>1===e.length,target:er}),(0,i.XM)({clock:el,source:{messages:ej,apiKey:w,temperature:b,systemPrompt:k,selectedModelId:z},filter:e=>{let{apiKey:t}=e;return!!t},fn:e=>{let{messages:t,apiKey:n,temperature:r,systemPrompt:o,selectedModelId:i}=e;return{modelId:i,messages:t,apiKey:n,temperature:r,systemPrompt:o,requestContext:{type:"normal"}}},target:ev}),(0,i.XM)({clock:Q,source:w,filter:e=>!e,target:eo}),(0,i.XM)({clock:ed,source:eA,filter:e=>!e,target:ex}),(0,i.XM)({clock:ex,fn:()=>({id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now(),isLoading:!0}),target:ef}),(0,i.XM)({clock:ef,source:{messages:ej,apiKey:w,temperature:b,systemPrompt:k,selectedModelId:z},filter:e=>{let{apiKey:t,messages:n}=e;return!!t&&n.length>0},fn:(e,t)=>{let{messages:n,apiKey:r,temperature:o,systemPrompt:i,selectedModelId:l}=e;return{modelId:l,messages:n.slice(0,-1),apiKey:r,temperature:o,systemPrompt:i,requestContext:{type:"generate",placeholderId:t.id}}},target:ev}),(0,i.XM)({clock:ed,source:w,filter:e=>!e,target:eo}),(0,i.XM)({clock:en,source:{messages:ej,apiKey:w,temperature:b,systemPrompt:k,selectedModelId:z},filter:(e,t)=>{let{apiKey:n}=e;return!!n&&eI(t)},fn:(e,t)=>{let{messages:n,apiKey:r,temperature:o,systemPrompt:i,selectedModelId:l}=e,a=_({messages:n,apiKey:r,temperature:o,systemPrompt:i,selectedModelId:l},t),s={type:"retry",originalMessageId:t.id,originalRole:t.role};return{...a,requestContext:s}},target:em}),(0,i.XM)({clock:en,filter:eI,fn:e=>({messageId:e.id,role:e.role}),target:eg}),(0,i.XM)({clock:em,target:ev}),(0,i.XM)({clock:ev.done,source:ej,fn:(e,t)=>{let{params:n,result:r}=t;return K({messages:e,requestContext:n.requestContext},r)},target:eh}),(0,i.XM)({clock:eh,filter:e=>{let t=null!==e;return console.log("[DEBUG] sample targeting retryUpdate:",{calculatedPayload:e,shouldTrigger:t}),t},target:ec}),(0,i.XM)({clock:ev.done,filter:e=>{var t;let{params:n}=e;return(null===(t=n.requestContext)||void 0===t?void 0:t.type)==="normal"},target:eu}),(0,i.XM)({clock:ev.doneData,target:ei}),(0,i.XM)({clock:[ec,eu],fn:()=>void 0,target:ea});var eD=n(198);let eE="chats",eT=null,ez=()=>(eT||(eT=(0,eD.P2)("LLMChatDB",1,{upgrade(e){if(!e.objectStoreNames.contains(eE)){let t=e.createObjectStore(eE,{keyPath:"id"});t.indexNames.contains("lastModified")||t.createIndex("lastModified","lastModified")}}})),eT),eF=async()=>{let e=(await ez()).transaction(eE,"readonly"),t=e.objectStore(eE),n=await t.getAll();return await e.done,n.sort((e,t)=>t.lastModified-e.lastModified).map(e=>{let{id:t,title:n,lastModified:r}=e;return{id:t,title:n,lastModified:r}})},eX=async e=>{let t=await ez(),n=await t.get(eE,e);return null!=n?n:null},eP=async e=>{let t=await ez(),n={...e,messages:e.messages.map(e=>({...e,isEdited:e.isEdited||!1,originalContent:e.originalContent||null}))};await t.put(eE,n)},eO=async e=>{let t=await ez();await t.delete(eE,e)},eR=async e=>{let{id:t,newTitle:n}=e,r=(await ez()).transaction(eE,"readwrite"),o=r.objectStore(eE),i=await o.get(t);return i?(i.title=n,i.lastModified=Date.now(),await o.put(i),await r.done,{id:i.id,title:i.title,lastModified:i.lastModified}):(await r.done,null)},eL=async e=>{var t,n,r;let{chatId:o,messages:i,apiKey:l}=e;if(!l)throw Error("API key is required for title generation.");if(0===i.length)throw Error("Cannot generate title for empty chat.");let a=[...i.slice(0,6).map(e=>({role:e.role,content:e.content})),{role:"user",content:"Summarize this chat conversation\n  in 1-5 words (maximum conciseness). Use title case. Focus on user's intent.\n  It will be used as a title. Do not mention yourself (assistant) or the user.\n  Example: Exploring Effector Stores"}],s={model:R.getState(),messages:a,temperature:.5,max_tokens:10},d=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify(s)});if(!d.ok){let e="Title generation failed! status: ".concat(d.status);try{let t=await d.json();e="Title Generation API Error (".concat(d.status,"): ").concat(t.error.message)}catch(e){}throw Error(e)}let c=await d.json(),u=null===(r=c.choices)||void 0===r?void 0:null===(n=r[0])||void 0===n?void 0:null===(t=n.message)||void 0===t?void 0:t.content,p=null==u?void 0:u.replace(/[^a-zA-Z0-9\s]/g,"").trim();if(!p)throw console.error("Title generation API response content is empty or undefined:",c),Error("Title generation resulted in an empty response.");return{chatId:o,generatedTitle:p}},eU=(e,t)=>{let n;let r={id:t.id,title:t.title,lastModified:t.lastModified},o=e.findIndex(e=>e.id===t.id);return -1!==o?(n=[...e])[o]=r:n=[r,...e],n.sort((e,t)=>t.lastModified-e.lastModified)},eW=(e,t)=>t?e.map(e=>e.id===t.id?t:e).sort((e,t)=>t.lastModified-e.lastModified):e,eN=e=>{var t,n,r,o,i;let{currentSession:l,messages:a,model:s,temperature:d,systemPrompt:c,tokens:u,draft:p,selectedModelInfo:g}=e,m=Date.now(),h=null==l?void 0:l.id,x=null!=h?h:crypto.randomUUID(),f=h&&null!==(r=null==l?void 0:l.title)&&void 0!==r?r:new Date(m).toLocaleString();return{id:x,title:f,createdAt:h&&null!==(o=null==l?void 0:l.createdAt)&&void 0!==o?o:m,lastModified:m,messages:a,settings:{model:{pricing:{prompt:Number(null==g?void 0:null===(t=g.pricing)||void 0===t?void 0:t.prompt)||0,completion:Number(null==g?void 0:null===(n=g.pricing)||void 0===n?void 0:n.completion)||0},context_length:null!==(i=null==g?void 0:g.context_length)&&void 0!==i?i:1e6},temperature:d,systemPrompt:c},totalTokens:u,draft:null!=p?p:"",modelInfo:null!=g?g:null}},eB=(0,i.lh)("appStarted"),eG=(0,i.$5)("history"),e$=eG.event("loadChatHistory"),eq=eG.event("chatSelected"),eH=eG.event("deleteChat"),e_=eG.event("newChatCreated"),eK=eG.event("chatTitleEdited"),eY=eG.event("generateTitle"),eZ=eG.event("duplicateChatClicked"),eV=eG.event("regenerateTitleForChat"),eJ=eG.effect("loadChatHistoryIndexFx",{handler:eF}),eQ=eG.effect("duplicateChatFx");eQ.use(async e=>{var t,n,r;let o=await eX(e);if(!o)throw Error("Original chat not found");let i=crypto.randomUUID(),l=Date.now(),a={...o,id:i,createdAt:l,lastModified:l,title:o.title+" (Copy)",messages:null!==(t=o.messages)&&void 0!==t?t:[],settings:null!==(n=o.settings)&&void 0!==n?n:{model:"",temperature:1,systemPrompt:""},totalTokens:null!==(r=o.totalTokens)&&void 0!==r?r:0};return await eP(a),i}),(0,i.XM)({clock:eZ,target:eQ}),(0,i.XM)({clock:eQ.doneData,target:eq}),(0,i.XM)({clock:eQ.doneData,target:eJ});let e0=eG.effect("loadSpecificChatFx",{handler:eX}),e1=eG.effect("saveChatFx",{handler:eP}),e2=eG.effect("deleteChatFx",{handler:eO}),e3=eG.effect("editChatTitleFx",{handler:eR}),e6=eG.effect("generateTitleFx",{handler:eL}),e5=eG.effect("regenerateTitleForChatFx");e5.use(async e=>{let t=w.getState();if(!t)throw Error("API key is missing");let n=await eX(e);if(!n)throw Error("Chat not found");if(!n.messages||0===n.messages.length)return;let r=await eL({chatId:e,messages:n.messages,apiKey:t,modelId:z.getState()});r.generatedTitle&&await eR({id:e,newTitle:r.generatedTitle})}),(0,i.XM)({clock:eV,target:e5}),(0,i.XM)({clock:e5.done,target:eJ});let e4=eG.store([],{name:"$chatHistoryIndex"}),e9=eG.store(null,{name:"$currentChatSession"});e9.map(e=>{var t;return null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null});let e8=eJ.pending;e1.pending,e0.pending,e9.reset(e_);let e7=e=>null!==e;(0,i.XM)({clock:eJ.doneData,fn:e=>e,target:e4}),(0,i.XM)({clock:e2.done,source:e4,fn:(e,t)=>{let{params:n}=t;return e.filter(e=>e.id!==n)},target:e4}),(0,i.XM)({clock:e1.done,source:e4,fn:(e,t)=>{let{params:n}=t;return eU(e,n)},target:e4}),(0,i.XM)({source:e9.updates,filter:e=>null!==e&&2===e.messages.length&&(/^\d{1,2}\/\d{1,2}\/\d{4}/.test(e.title)||""===e.title.trim()),target:eV.prepend(e=>e.id)}),(0,i.XM)({clock:e3.doneData,source:e4,filter:(e,t)=>!!t,fn:(e,t)=>eW(e,t),target:e4}),(0,i.XM)({clock:e0.doneData,fn:e=>e,target:e9}),(0,i.XM)({clock:e0.doneData,fn:e=>{var t;return null!==(t=null==e?void 0:e.draft)&&void 0!==t?t:""},target:ey}),(0,i.XM)({clock:e1.done,fn:e=>{let{params:t}=e;return t},target:e9}),(0,i.XM)({clock:e3.doneData,source:e9,filter:(e,t)=>!!e&&!!t&&e.id===t.id,fn:(e,t)=>({...e,title:t.title,lastModified:t.lastModified}),target:e9}),(0,i.XM)({clock:[eB,e$],target:eJ}),(0,i.XM)({clock:eq,target:e0}),(0,i.XM)({clock:eH,target:e2}),(0,i.XM)({clock:eK,target:e3}),(0,i.XM)({clock:e0.doneData,filter:e7,fn:e=>e.messages,target:ej}),(0,i.XM)({clock:e0.doneData,filter:e7,fn:e=>z.getState(),target:z}),(0,i.XM)({clock:e0.doneData,filter:e7,fn:e=>e.settings.temperature,target:b}),(0,i.XM)({clock:e0.doneData,filter:e7,fn:e=>e.settings.systemPrompt,target:k}),(0,i.XM)({clock:e0.doneData,filter:e7,fn:e=>{var t;return null!==(t=e.totalTokens)&&void 0!==t?t:0},target:ew}),(0,i.XM)({clock:e_,fn:()=>[],target:ej});let te=(0,$.s)({source:ey,timeout:1e3});(0,i.XM)({clock:te,source:e9,filter:e=>null!==e,fn:(e,t)=>({...e,draft:t,lastModified:Date.now()}),target:e9}),(0,i.XM)({clock:e9,filter:e=>null!==e,target:e1}),(0,i.XM)({clock:e_,fn:()=>0,target:ew}),(0,i.XM)({clock:[er,eu,ee,et,ec],source:{currentSession:e9,messages:ej,model:z,temperature:b,systemPrompt:k,tokens:ew,draft:ey,selectedModelInfo:T.map(e=>{var t;return null!==(t=e.find(e=>e.id===z.getState()))&&void 0!==t?t:null})},filter:e=>{let{messages:t}=e;return t.length>0},fn:e=>(console.log("[saveChatFx Trigger] Fired. Source Messages Length:",e.messages.length),e.messages.length>0&&console.log("[saveChatFx Trigger] Last Message ID:",e.messages[e.messages.length-1].id),eN(e)),target:e1}),(0,i.XM)({clock:e1.done,source:w,filter:(e,t)=>{let{params:n}=t;return!!e&&n.messages.length>0&&!n.title},fn:(e,t)=>{let{params:n}=t;return{chatId:n.id,messages:n.messages,apiKey:e,modelId:R.getState()}},target:e6}),(0,i.XM)({clock:e6.doneData,filter:e=>{let{generatedTitle:t}=e;return!!t},fn:e=>{let{chatId:t,generatedTitle:n}=e;return{id:t,newTitle:n}},target:e3}),(0,i.XM)({clock:eY,source:{apiKey:w,currentChat:e9},filter:e=>{let{apiKey:t,currentChat:n}=e;return!!t&&!!n&&n.messages.length>0},fn:e=>{let{apiKey:t,currentChat:n}=e;return{chatId:n.id,messages:n.messages,apiKey:t,modelId:R.getState()}},target:e6}),e6.fail.watch(e=>{let{error:t,params:n}=e;console.error("Failed to generate title for chat ".concat(n.chatId,":"),t)}),e1.done.watch(()=>{console.log("Effect: saveChatFx done (Debug)")}),e1.fail.watch(e=>{console.error("Effect: saveChatFx failed (Debug)",e)}),(0,i.XM)({clock:N,source:{chat:e9,models:T},filter:e=>{let{chat:t}=e;return null!==t},fn:(e,t)=>{var n,r,o;let{chat:i,models:l}=e,a=l.find(e=>e.id===t);return a?{...i,lastModified:Date.now(),settings:{...i.settings,model:{pricing:{prompt:Number(null===(n=a.pricing)||void 0===n?void 0:n.prompt)||0,completion:Number(null===(r=a.pricing)||void 0===r?void 0:r.completion)||0},context_length:null!==(o=a.context_length)&&void 0!==o?o:1e6}}}:i},target:e9}),(0,i.XM)({clock:e9.updates,filter:e=>null!==e,target:e1});let tt=(0,i.$5)("ui"),tn=tt.event("showApiKeyDialog"),tr=tt.event("hideApiKeyDialog"),to=tt.event("openSettingsDrawer"),ti=tt.event("closeSettingsDrawer"),tl=tt.event("toggleSettingsDrawer"),ta=tt.event("openModelInfoDrawer"),ts=tt.event("closeModelInfoDrawer"),td=tt.event("openHistoryDrawer"),tc=tt.event("closeHistoryDrawer"),tu=tt.event("toggleHistoryDrawer"),tp=tt.event("openMobileDrawer"),tg=tt.event("closeMobileDrawer"),tm=tt.event("setMobileDrawerTab"),th=tt.event("startEditingMessage"),tx=tt.event("stopEditingMessage"),tf=tt.event("openModelInfoAlert"),tv=tt.event("closeModelInfoAlert"),ty=tt.effect({name:"loadUiSettingsFx",handler:async()=>{try{let e="true"===localStorage.getItem("ui_historyDrawerOpen"),t="true"===localStorage.getItem("ui_settingsDrawerOpen");return{historyOpen:e,settingsOpen:t}}catch(e){return console.error("Failed to load UI settings from localStorage:",e),{historyOpen:!1,settingsOpen:!1}}}}),tj=tt.effect({name:"saveHistoryDrawerStateFx",handler:async e=>{try{localStorage.setItem("ui_historyDrawerOpen",String(e))}catch(e){console.error("Failed to save history drawer state to localStorage:",e)}}}),tA=tt.effect({name:"saveSettingsDrawerStateFx",handler:async e=>{try{localStorage.setItem("ui_settingsDrawerOpen",String(e))}catch(e){console.error("Failed to save settings drawer state to localStorage:",e)}}}),tw=tt.store(!1,{name:"$isHistoryDrawerPersistentOpen"}),tb=tt.store(!1,{name:"$isSettingsDrawerPersistentOpen"}),tk=tt.store(!1).on(tn,()=>!0).on(tr,()=>!1);tt.store(!1,{name:"isSettingsDrawerOpen"}).on(to,()=>!0).on(ti,()=>!1),tt.store(!1,{name:"isHistoryDrawerOpen"}).on(td,()=>!0).on(tc,()=>!1).on(tu,e=>!e),tt.store(!1,{name:"$isModelInfoDrawerOpen"}).on(ta,()=>!0).on(ts,()=>!1);let tM=tt.store(!1,{name:"$isModelInfoDrawerOpen"}).on(tf,()=>!0).on(tv,()=>!1),tS=tt.store(!1,{name:"isMobileDrawerOpen"}).on(tp,()=>!0).on(tg,()=>!1),tC=tt.store("history",{name:"mobileDrawerTab"}).on(tp,(e,t)=>t.tab).on(tm,(e,t)=>t).reset(tg),tI=tt.store(null,{name:"$editingMessageId"}).on(th,(e,t)=>t).reset(tx);tw.on(tu,e=>!e).on(td,()=>!0).on(tc,()=>!1).on(ty.doneData,(e,t)=>t.historyOpen),tb.on(tl,e=>!e).on(to,()=>!0).on(ti,()=>!1).on(ty.doneData,(e,t)=>t.settingsOpen),tI.reset(eq,e_),(0,i.XM)({clock:eB,target:ty}),(0,i.XM)({clock:tw.updates,filter:ty.pending.map(e=>!e),target:tj}),(0,i.XM)({clock:tb.updates,filter:ty.pending.map(e=>!e),target:tA}),(0,i.XM)({clock:[eB,eo],source:w,filter:e=>"string"==typeof e&&0===e.trim().length,target:tn}),(0,i.XM)({clock:w,source:tk,filter:(e,t)=>e&&"string"==typeof t&&t.trim().length>0,target:tr});let tD="miniChatModelId_v1",tE=(0,i.lh)();(0,i.lh)();let tT=(0,i.y$)("openai/gpt-3.5-turbo"),tz=(0,i.EH)(()=>localStorage.getItem(tD)),tF=(0,i.EH)(e=>{localStorage.setItem(tD,e)});(0,i.XM)({clock:eB,target:tz}),(0,i.XM)({clock:tz.doneData,filter:e=>null!==e,target:tT}),tT.on(tE,(e,t)=>t),(0,i.XM)({clock:tT.updates,target:tF});let tX=(0,i.lh)(),tP=(0,i.lh)(),tO=(0,i.y$)({visible:!1,x:0,y:0,selectionText:""}).on(tX,(e,t)=>({visible:!0,...t})).on(tP,e=>({...e,visible:!1,selectionText:""})),tR=(0,i.lh)(),tL=(0,i.lh)(),tU=(0,i.lh)(),tW=(0,i.lh)(),tN=(0,i.lh)(),tB=(0,i.lh)(),tG=(0,i.lh)(),t$=(0,i.lh)(),tq=(0,i.lh)(),tH=(0,i.lh)("triggerMiniChatScroll"),t_=(0,i.y$)({isOpen:!1,isCompact:!1,input:"",messages:[],loading:!1,isMinimized:!1,initialX:null,initialY:null}).on(tR,(e,t)=>{let{initialInput:n,startCompact:r,x:o,y:i}=t;return{...e,isOpen:!0,isCompact:!!r,input:null!=n?n:e.input,messages:e.isOpen?e.messages:[],loading:!1,isMinimized:!1,initialX:null!=o?o:null,initialY:null!=i?i:null}}).on(tL,()=>({isOpen:!1,isCompact:!1,input:"",messages:[],loading:!1,isMinimized:!1,initialX:null,initialY:null})).on(tU,(e,t)=>({...e,input:t})).on(tW,(e,t)=>({...e,isCompact:!1,input:"",messages:[...e.messages,{role:"user",content:t}],loading:!0})).on(tN,(e,t)=>({...e,isCompact:!1,messages:[...e.messages,{role:"assistant",content:t}],loading:!1})).on(tG,e=>({...e,isMinimized:!0})).on(t$,e=>({...e,isMinimized:!1})).reset(tq),tK=(0,i.y$)(0,{name:"$miniChatScrollTrigger"}).on(tH,()=>Date.now()).reset(tq,tL),tY=(0,i.EH)();tY.use(async e=>{let{message:t,model:n,apiKey:r}=e;return p({message:t,model:n,apiKey:r})}),(0,i.XM)({clock:tW,source:{apiKey:w,model:tT},fn:(e,t)=>{let{apiKey:n,model:r}=e;return{message:t,model:r,apiKey:n}},target:tY}),(0,i.XM)({clock:tY.doneData,target:tN});let tZ=(0,i.EH)();tZ.use(async()=>{let e=t_.getState();if(!e.messages.length)return;let t=crypto.randomUUID(),n=Date.now(),r={id:t,createdAt:n,lastModified:n,title:"",messages:e.messages.map(e=>({id:crypto.randomUUID(),timestamp:Date.now(),role:e.role,content:e.content})),settings:(()=>{var e,t,n;let r=tT.getState(),o=T.getState().find(e=>e.id===r);return{model:{pricing:{prompt:Number(null==o?void 0:null===(e=o.pricing)||void 0===e?void 0:e.prompt)||0,completion:Number(null==o?void 0:null===(t=o.pricing)||void 0===t?void 0:t.completion)||0},context_length:null!==(n=null==o?void 0:o.context_length)&&void 0!==n?n:1e6},temperature:b.getState(),systemPrompt:k.getState()}})(),totalTokens:0,draft:""};await e1(r),tq(),tP()}),(0,i.XM)({clock:[tW,tN,tR,t$],target:tH}),(0,i.XM)({clock:tU,source:t_,filter:e=>e.isOpen,target:tH}),(0,i.XM)({clock:tB,target:tZ});let tV=(0,i.XM)({source:t_,fn:e=>e.isOpen&&!e.isMinimized});(0,i.ah)({clock:tS,source:tV,filter:(e,t)=>e&&t,target:tG}),(0,i.ah)({clock:P,source:tV,filter:(e,t)=>e&&t,target:tG}),(0,i.ah)({clock:eC,source:tV,filter:(e,t)=>e&&t,target:tG});var tJ=n(18407),tQ=n(71803),t0=n(68534),t1=n(2123);let t2=()=>{let e=(0,t1.e3)(tO),t=(0,t1.e3)(t_);return e.visible?(0,r.jsx)(tJ.A,{elevation:4,sx:{position:"absolute",top:e.y,left:e.x,zIndex:9999},children:(0,r.jsxs)(tQ.A,{direction:"column",spacing:1,padding:1,children:[(0,r.jsxs)(t0.A,{size:"small",variant:"contained",onClick:()=>{var n;t.isMinimized&&t$(),t.isOpen?tU(""===t.input?"> ".concat(e.selectionText,"\n"):"".concat(t.input,"\n> ").concat(e.selectionText,"\n")):tR({initialInput:""===t.input?"> ".concat(e.selectionText,"\n"):"".concat(t.input,"\n> ").concat(e.selectionText,"\n"),startCompact:!0,x:e.x,y:e.y}),null===(n=window.getSelection())||void 0===n||n.removeAllRanges(),tP()},children:[t.isOpen?"Quote":"Ask"," "]}),!t.input.trim()&&(0,r.jsx)(t0.A,{size:"small",variant:"contained",color:"secondary",onClick:()=>{var n;t.isMinimized&&t$();let r="Please explain this to me: ".concat(e.selectionText);t.isOpen||tR({initialInput:""}),tW(r),null===(n=window.getSelection())||void 0===n||n.removeAllRanges(),tP()},children:"Explain"})]})}):null};var t3=n(5939),t6=n.n(t3),t5=n(54581),t4=n(700),t9=n(3127),t8=n(49540),t7=n(69242),ne=n(68004),nt=n(72502),nn=n(77262),nr=n(60440);let no=()=>{let{isOpen:e,isCompact:t,messages:n,loading:i,input:l,isMinimized:a,initialX:s,initialY:d}=(0,t1.e3)(t_),c=(0,t1.e3)(tK),u=o.useRef(null),p=o.useRef(null),g=o.useRef(null);return(o.useEffect(()=>{if(!e)return;let t=p.current;t&&requestAnimationFrame(()=>{t.scrollTop=t.scrollHeight})},[e,c]),o.useEffect(()=>{if(!e||t)return;let n=g.current;n&&requestAnimationFrame(()=>{n.scrollTop=n.scrollHeight})},[e,t,n]),e)?(0,r.jsx)(t6(),{handle:".drag-handle",nodeRef:u,children:(0,r.jsx)(tJ.A,{ref:u,elevation:6,sx:{position:"fixed",...null!=s&&null!=d?{top:d,left:s}:{bottom:"20px",right:"20px"},maxWidth:"300px",minWidth:"196px",maxHeight:"50vh",zIndex:9999,display:"flex",flexDirection:"column",transform:"translate(-50%, 10px)",pb:1},children:!a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(tQ.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{p:.5,pl:1.3,borderBottom:1,borderColor:"divider"},children:[(0,r.jsx)(t5.A,{className:"drag-handle",sx:{cursor:"move",flexGrow:1,mr:1},children:(0,r.jsx)(t4.A,{variant:"subtitle1",children:"Mini chat"})}),(0,r.jsxs)(tQ.A,{direction:"row",spacing:1,children:[!t&&(0,r.jsx)(t9.A,{"aria-label":"Expand",size:"small",onClick:()=>tB(),children:(0,r.jsx)(ne.A,{fontSize:"small"})}),(0,r.jsx)(t9.A,{"aria-label":"Minimize",size:"small",onClick:()=>tG(),children:(0,r.jsx)(nt.A,{fontSize:"small"})}),(0,r.jsx)(t9.A,{"aria-label":"Close",size:"small",onClick:()=>tL(),children:(0,r.jsx)(t7.A,{fontSize:"small"})})]})]}),!t&&(0,r.jsx)(tQ.A,{spacing:1,sx:{p:1,overflowY:"auto",flexShrink:1e3,minHeight:"52px"},ref:g,children:n.map((e,t)=>(0,r.jsx)(tJ.A,{className:"chat-message",sx:{p:1,minWidth:"30%",bgcolor:"user"===e.role?"primary.dark":"secondary.dark"},children:(0,r.jsx)(t4.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:e.content})},t))}),(0,r.jsx)(tQ.A,{ref:p,direction:"row",spacing:1,sx:{p:1,pb:0,borderTop:1,borderColor:"divider",overflow:"auto"},children:(0,r.jsx)(t8.A,{size:"small",placeholder:"Type a message...",fullWidth:!0,multiline:!0,value:l,onChange:e=>tU(e.target.value),sx:{"& .MuiOutlinedInput-root":{p:.6,pr:1},"& textarea":{pl:1,overflow:"auto"}},slotProps:{input:{endAdornment:(0,r.jsx)(t9.A,{"aria-label":"send",size:"small",edge:"end",disabled:!l.trim()||i,onClick:()=>{l.trim()&&tW(l.trim())},sx:{alignSelf:"flex-end"},children:(0,r.jsx)(nr.A,{fontSize:"small"})})}}})}),i&&(0,r.jsx)(nn.A,{color:"secondary",sx:{position:"absolute",bottom:0,width:"100%",height:"1px"}})]})})}):null};var ni=n(63010),nl=n(70496);let na=()=>{let{isMinimized:e,isOpen:t}=(0,t1.e3)(t_),n=(0,t1.e3)(tS);return t&&e&&!n?(0,r.jsx)(ni.A,{color:"primary","aria-label":"Restore mini chat",sx:{position:"sticky",bottom:0,right:0,zIndex:1e4,alignSelf:"flex-end",flexShrink:0},onClick:()=>t$(),children:(0,r.jsx)(nl.A,{})}):null};var ns=n(65997),nd=n(74964);async function nc(){var e,t,n,r;if(null===(t=navigator)||void 0===t?void 0:null===(e=t.storage)||void 0===e?void 0:e.estimate){let e=await navigator.storage.estimate();return{quota:null!==(n=e.quota)&&void 0!==n?n:0,usage:null!==(r=e.usage)&&void 0!==r?r:0}}return{quota:0,usage:0}}let nu=(0,i.lh)(),np=(0,i.y$)({tokensSent:0,tokensReceived:0,contextTokensUsed:0,contextTokensMax:1e6,apiCost:0,chatSizeMB:0,dbSizeMB:0,quotaMB:0,totalUsageMB:0,chatId:null}),ng=np.map(e=>e.contextTokensMax>0?e.contextTokensUsed/e.contextTokensMax*100:0),nm=(0,i.EH)(async()=>{let{quota:e,usage:t}=await nc();return{quotaMB:e/1048576,dbSizeMB:t/1048576,totalUsageMB:t/1048576,chatSizeMB:0}}),nh=(0,i.EH)(async e=>{var t,n,r,o,i,l;let{chatSession:a,totalTokens:s}=e,d=null!==(i=null==a?void 0:null===(n=a.settings)||void 0===n?void 0:null===(t=n.model)||void 0===t?void 0:t.context_length)&&void 0!==i?i:1e6,c=function(e,t,n){var r,o;return n?+(e/1e6*(null!==(r=n.prompt)&&void 0!==r?r:0)+0*(null!==(o=n.completion)&&void 0!==o?o:0)).toFixed(6):0}(s,0,null==a?void 0:null===(o=a.settings)||void 0===o?void 0:null===(r=o.model)||void 0===r?void 0:r.pricing);return{tokensSent:s,tokensReceived:0,contextTokensUsed:s,contextTokensMax:d,apiCost:c,chatId:null!==(l=null==a?void 0:a.id)&&void 0!==l?l:null}});(0,i.XM)({clock:nu,target:nm}),(0,i.XM)({clock:[nu,e9.updates,ew.updates],source:(0,i.kg)({chatSession:e9,totalTokens:ew}),target:nh}),(0,i.XM)({clock:[nm.doneData,nh.doneData],source:np,fn:(e,t)=>({...e,...t}),target:np});let nx=()=>{var e;let t=(0,t1.e3)(np),n=(0,t1.e3)(ng);return(0,r.jsxs)(tQ.A,{spacing:2,children:[(0,r.jsx)(nd.A,{children:"Context"}),(0,r.jsxs)(t4.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Used:"})," ",t.contextTokensUsed.toLocaleString()," / ",t.contextTokensMax.toLocaleString()]}),(0,r.jsx)(t5.A,{children:(0,r.jsx)(nn.A,{variant:"determinate",color:"success",value:Math.min(n,100),sx:{height:8,borderRadius:4,mt:1}})}),(0,r.jsx)(nd.A,{children:"API Cost"}),(0,r.jsxs)(t4.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Estimated Cost:"})," $",t.apiCost.toFixed(6)]}),(0,r.jsx)(nd.A,{children:"Chat Session"}),(0,r.jsxs)(t4.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Chat ID:"})," ",null!==(e=t.chatId)&&void 0!==e?e:"N/A"]}),(0,r.jsx)(nd.A,{children:"Storage"}),(0,r.jsxs)(t4.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Chat Size:"})," ",t.chatSizeMB.toFixed(2)," MB"]}),(0,r.jsxs)(t4.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Total DB:"})," ",t.dbSizeMB.toFixed(2)," MB"]}),(0,r.jsxs)(t4.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Quota:"})," ",t.quotaMB.toFixed(2)," MB"]}),(0,r.jsx)(nd.A,{children:"Tokens"}),(0,r.jsxs)(t4.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Sent:"})," ",t.tokensSent.toLocaleString()]}),(0,r.jsxs)(t4.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Received:"})," ",t.tokensReceived.toLocaleString()]}),(0,r.jsxs)(t4.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Total:"})," ",(t.tokensSent+t.tokensReceived).toLocaleString()]})]})};var nf=n(56278),nv=n(54492),ny=n(99927);let nj=e=>{let{open:t,onClose:n}=e;return(0,t1.e3)(np),(0,t1.e3)(ng),(0,r.jsxs)(nf.A,{open:t,onClose:n,maxWidth:"xs",fullWidth:!0,children:[(0,r.jsxs)(nv.A,{children:["Usage Info",(0,r.jsx)(t9.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,r.jsx)(t7.A,{})})]}),(0,r.jsx)(ny.A,{children:(0,r.jsx)(nx,{})})]})};var nA=n(16324),nw=n(27943),nb=n(35726),nk=n(18987),nM=n(29267),nS=n(18096),nC=n(30529),nI=n(33989),nD=n(14426),nE=n(63148),nT=n(65528),nz=n(22376),nF=n(85222),nX=n(21963),nP=n(76380),nO=n(39489),nR=n(6742),nL=n(25249),nU=n(63954),nW=n(28890),nN=n(19505),nB=n(95206),nG=n(69008),n$=n(62170),nq=n(37857);let nH=e=>{let{searchTerm:t,setSearchTerm:n,isLoading:i,filteredHistory:l,editingId:a,editedTitle:s,currentChatId:d,setEditedTitle:c,handleStartEdit:u,handleSaveEdit:p,handleCancelEdit:g,handleDeleteChat:m,handleSelectChat:h}=e,[x,f]=(0,o.useState)(null),[v,y]=(0,o.useState)(null),[j,A]=(0,o.useState)(""),w=(0,nA.A)(),b=(0,nw.A)(w.breakpoints.down("sm")),k=(0,t1.e3)(tS),M=(e,t,n)=>{e.stopPropagation(),f(e.currentTarget),y(t),A(n)},S=()=>{f(null),y(null),A("")};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t5.A,{sx:{width:{xs:"100%",sm:360,md:400},maxWidth:"100%",flexGrow:1,display:"flex",flexDirection:"column",height:"100%"},role:"presentation",children:[!k&&(0,r.jsxs)(nC.A,{disableGutters:!0,variant:"dense",sx:{display:"flex",alignItems:"center",justifyContent:"start",pl:2,pr:1,borderBottom:1,borderColor:"divider"},children:[(0,r.jsx)(t4.A,{variant:"h6",sx:{flexGrow:1},children:"Chat History"}),!b&&(0,r.jsx)(t9.A,{"aria-label":"New chat",onClick:()=>e_(),children:(0,r.jsx)(nL.A,{})}),!b&&(0,r.jsx)(t9.A,{onClick:()=>tc(),"aria-label":"close history drawer",children:(0,r.jsx)(nR.A,{})})]}),(0,r.jsx)(t5.A,{sx:{p:2},children:(0,r.jsx)(t8.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Search chats...",value:t,onChange:e=>n(e.target.value),InputProps:{startAdornment:(0,r.jsx)(nI.A,{position:"start",children:(0,r.jsx)(nU.A,{fontSize:"small"})})}})}),(0,r.jsx)(nd.A,{}),(0,r.jsx)(t5.A,{sx:{flexGrow:1,overflowY:"auto"},children:i?(0,r.jsx)(t5.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,r.jsx)(nD.A,{})}):(0,r.jsxs)(nE.A,{disablePadding:!0,children:[0===l.length&&!i&&(0,r.jsx)(t4.A,{sx:{p:2,textAlign:"center",color:"text.secondary"},children:t?"No matching chats found.":"No chat history yet."}),l.map(e=>(0,r.jsx)(nT.Ay,{disablePadding:!0,secondaryAction:(0,r.jsx)(r.Fragment,{children:a===e.id?(0,r.jsx)(t9.A,{edge:"end",size:"small","aria-label":"save",onClick:t=>{t.stopPropagation(),p(e.id)},children:(0,r.jsx)(nB.A,{fontSize:"medium"})}):(0,r.jsx)(t9.A,{edge:"end","aria-label":"more",onClick:t=>M(t,e.id,e.title),children:(0,r.jsx)(nG.A,{fontSize:"medium"})})}),children:(0,r.jsx)(nz.A,{onClick:()=>h(e.id),selected:e.id===d,children:a===e.id?(0,r.jsx)(t5.A,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:(0,r.jsx)(t8.A,{size:"small",value:s,onChange:e=>c(e.target.value),onClick:e=>e.stopPropagation(),onKeyDown:t=>{"Enter"===t.key?(t.preventDefault(),p(e.id)):"Escape"===t.key&&(t.preventDefault(),g())},onBlur:()=>p(e.id),autoFocus:!0,fullWidth:!0,variant:"standard"})}):(0,r.jsx)(nF.A,{primary:e.title,secondary:new Date(e.lastModified).toLocaleString(),primaryTypographyProps:{noWrap:!0,sx:{maxWidth:265,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:e.id===d?"bold":"normal"}},secondaryTypographyProps:{noWrap:!0,fontSize:"0.75rem"}})})},e.id))]})})]}),(0,r.jsxs)(nX.A,{anchorEl:x,open:!!x,onClose:S,onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)(nP.A,{onClick:e=>{e.stopPropagation(),S(),v&&setTimeout(()=>{u(v,j,e)},0)},children:[(0,r.jsx)(nO.A,{children:(0,r.jsx)(nW.A,{fontSize:"small"})}),(0,r.jsx)(nF.A,{primary:"Rename"})]}),(0,r.jsxs)(nP.A,{onClick:()=>{v&&eZ(v),S()},children:[(0,r.jsx)(nO.A,{children:(0,r.jsx)(n$.A,{fontSize:"small"})}),(0,r.jsx)(nF.A,{primary:"Duplicate"})]}),(0,r.jsxs)(nP.A,{onClick:()=>{v&&eV(v),S()},children:[(0,r.jsx)(nO.A,{children:(0,r.jsx)(nq.A,{fontSize:"small"})}),(0,r.jsx)(nF.A,{primary:"Regenerate Title"})]}),(0,r.jsxs)(nP.A,{onClick:e=>{e.stopPropagation(),v&&m(v,e),S()},sx:{color:"error.main"},children:[(0,r.jsx)(nO.A,{sx:{color:"error.main"},children:(0,r.jsx)(nN.A,{fontSize:"small"})}),(0,r.jsx)(nF.A,{primary:"Delete"})]})]})]})};var n_=n(11698);let nK=()=>{let[e,t]=(0,o.useState)(!1),n=(0,t1.e3)(T),i=(0,t1.e3)(F),l=(0,t1.e3)(tT),a=(0,t1.e3)(X),s=o.useMemo(()=>{var e;return null!==(e=n.find(e=>e.id===l))&&void 0!==e?e:null},[n,l]),d=o.useMemo(()=>{let e=n;return a&&(e=e.filter(e=>{var t,n;return(null===(t=e.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=e.pricing)||void 0===n?void 0:n.completion)==="0"})),e},[n,a]);return(0,r.jsx)(t5.A,{sx:{my:1},children:(0,r.jsx)(n_.A,{id:"mini-chat-model-selector",sx:{width:"100%"},open:e,onOpen:()=>{t(!0),0===n.length&&W()},onClose:()=>{t(!1)},value:s,onChange:(e,t)=>{t&&tE(t.id)},isOptionEqualToValue:(e,t)=>e.id===t.id,getOptionLabel:e=>e.name||e.id,options:d,loading:i,renderInput:e=>(0,r.jsx)(t8.A,{...e,label:"Mini-Chat Model",variant:"outlined",size:"small",InputProps:{...e.InputProps,endAdornment:(0,r.jsxs)(o.Fragment,{children:[i?(0,r.jsx)(nD.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})}}),renderOption:(e,t)=>(0,o.createElement)(t5.A,{component:"li",...e,key:t.id},t.name||t.id)})})};var nY=n(83729),nZ=n(82330),nV=n(4915),nJ=n(82449),nQ=n(11247),n0=n(58674),n1=n(81787);let n2=e=>{let{apiKey:t,showApiKey:n,temperature:i,systemPrompt:l,currentChatTokens:a,handleApiKeyChange:s,handleSystemPromptChange:d,handleTemperatureChange:c,handleClickShowApiKey:u,handleMouseDownApiKey:p}=e,g=(0,t1.e3)(O),[m,h]=o.useState(!1),x=(0,t1.e3)(tS),[f,v]=(0,t1.e3)([R,T]),y=o.useMemo(()=>{var e;return null!==(e=v.find(e=>e.id===f))&&void 0!==e?e:null},[v,f]);return o.useEffect(()=>{h(X.getState())},[]),(0,r.jsxs)(t5.A,{sx:{width:{xs:"100%",sm:360,md:400},maxWidth:"100%",flexGrow:1,display:"flex",flexDirection:"column",height:"100%"},children:[!x&&(0,r.jsxs)(nC.A,{disableGutters:!0,variant:"dense",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2},children:[(0,r.jsx)(t4.A,{variant:"h6",children:"Chat Settings"}),(0,r.jsx)(t9.A,{onClick:()=>ti(),"aria-label":"close settings drawer",edge:"end",children:(0,r.jsx)(nQ.A,{})})]}),(0,r.jsxs)(t5.A,{sx:{px:2,pt:2},children:[(0,r.jsxs)(t4.A,{gutterBottom:!0,children:["Temperature: ",i.toFixed(1)]}),(0,r.jsx)(nY.A,{title:"Controls randomness. Lower values are more deterministic.",placement:"left",children:(0,r.jsx)(nZ.Ay,{value:i,onChange:(e,t)=>"number"==typeof t&&c(t),"aria-labelledby":"temperature-slider",step:.1,marks:!0,min:0,max:2})})]}),(0,r.jsx)(nd.A,{}),(0,r.jsx)(t5.A,{sx:{p:2,pb:1},children:(0,r.jsx)(nY.A,{title:"Your OpenRouter API Key. Stored locally in your browser.",placement:"left",children:(0,r.jsx)(t8.A,{size:"small",fullWidth:!0,label:"OpenRouter API Key",variant:"outlined",type:n?"text":"password",value:t,onChange:e=>s(e.target.value),InputProps:{endAdornment:(0,r.jsx)(nI.A,{position:"end",children:(0,r.jsx)(t9.A,{"aria-label":"toggle api key visibility",onClick:u,onMouseDown:p,edge:"end",size:"small",children:n?(0,r.jsx)(n1.A,{}):(0,r.jsx)(n0.A,{})})})}})})}),(0,r.jsx)(t5.A,{sx:{px:2},children:(0,r.jsx)(nV.A,{control:(0,r.jsx)(nJ.A,{checked:m,onChange:e=>{let t=e.target.checked;h(t),g(t)},color:"primary"}),label:"Show only free models"})}),(0,r.jsx)(t5.A,{sx:{px:2,py:1},children:(0,r.jsx)(nK,{})}),(0,r.jsx)(t5.A,{sx:{px:2,pb:2,pt:1},children:(0,r.jsx)(n_.A,{size:"small",options:v,groupBy:e=>e.created?new Date(1e3*e.created).toLocaleString("default",{month:"long",year:"numeric"}):"Unknown",getOptionLabel:e=>e.name.replace(/^[^:]+:\s*/,"")||e.id,value:y,onChange:(e,t)=>{t&&L(t.id)},renderInput:e=>(0,r.jsx)(t8.A,{...e,label:"AutoTitle Model",variant:"outlined",fullWidth:!0}),isOptionEqualToValue:(e,t)=>e.id===t.id})}),(0,r.jsx)(nd.A,{}),(0,r.jsxs)(t5.A,{sx:{px:2,py:1,flexGrow:1,display:"flex",flexDirection:"column"},children:[(0,r.jsx)(t4.A,{variant:"overline",gutterBottom:!0,children:"System Prompt"}),(0,r.jsx)(t8.A,{fullWidth:!0,variant:"outlined",multiline:!0,value:l,onChange:e=>d(e.target.value),sx:{"& .MuiInputBase-input":{resize:"vertical"}},InputProps:{sx:{height:"100%"}}})]})]})};var n3=n(94980);let n6=e=>{var t,n,o,i;let{model:l}=e,a=(0,t1.e3)(tS),s=(null===(t=l.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=l.pricing)||void 0===n?void 0:n.completion)==="0",d=l.created?new Date(1e3*l.created).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"",c=(null===(o=l.pricing)||void 0===o?void 0:o.prompt)?(1e6*parseFloat(l.pricing.prompt)).toFixed(2):"0",u=(null===(i=l.pricing)||void 0===i?void 0:i.completion)?(1e6*parseFloat(l.pricing.completion)).toFixed(2):"0";return(0,r.jsxs)(t5.A,{children:[!a&&(0,r.jsx)(nC.A,{variant:"dense",disableGutters:!0,children:(0,r.jsx)(t4.A,{variant:"h6",fontWeight:"bold",children:"Model Info"})}),(0,r.jsxs)(t5.A,{padding:2,children:[(0,r.jsxs)(tQ.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(t4.A,{variant:"h6",fontWeight:"bold",children:l.name}),s&&(0,r.jsx)(nY.A,{title:"Free model",children:(0,r.jsx)(n3.A,{fontSize:"small"})})]}),(0,r.jsxs)(tQ.A,{direction:"row",alignItems:"center",spacing:1,mt:1,children:[(0,r.jsx)(t4.A,{variant:"body2",fontFamily:"monospace",children:l.id}),(0,r.jsx)(nY.A,{title:"Copy model ID",children:(0,r.jsx)(t9.A,{size:"small",onClick:()=>{navigator.clipboard.writeText(l.id)},children:(0,r.jsx)(n$.A,{fontSize:"small"})})})]}),(0,r.jsx)(nd.A,{sx:{my:2}}),(0,r.jsxs)(tQ.A,{spacing:1,flexWrap:"wrap",children:[(0,r.jsxs)(tQ.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(t4.A,{variant:"body2",color:"text.secondary",children:["Created ",d]}),(0,r.jsxs)(t4.A,{variant:"body2",color:"text.secondary",children:[l.context_length.toLocaleString()," context"]})]}),(0,r.jsxs)(tQ.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(t4.A,{variant:"body2",color:"text.secondary",children:["$",c,"/M input tokens"]}),(0,r.jsxs)(t4.A,{variant:"body2",color:"text.secondary",children:["$",u,"/M output tokens"]})]})]}),(0,r.jsx)(nd.A,{sx:{my:2}}),(0,r.jsx)(t4.A,{variant:"body2",color:"text.primary",whiteSpace:"pre-line",children:l.description})]})]})},n5=e=>{let{historyPanelProps:t,settingsPanelProps:n,modelInfo:o}=e,[i,l]=(0,t1.e3)([tS,tC]),a=(0,t1.e3)(tg),s=(0,t1.e3)(tm);return(0,r.jsx)(nk.Ay,{anchor:"bottom",open:i,onClose:a,ModalProps:{keepMounted:!0},children:(0,r.jsxs)(t5.A,{sx:{display:"flex",flexDirection:"column",height:"calc(100vh - 64px)"},children:[(0,r.jsxs)(nM.A,{value:l,onChange:(e,t)=>s(t),variant:"fullWidth",indicatorColor:"secondary",textColor:"inherit",sx:{borderTop:1,borderColor:"divider",backgroundColor:"background.paper"},children:[(0,r.jsx)(nS.A,{sx:{fontWeight:"history"===l?"bold":"normal"},value:"history",label:"History"}),(0,r.jsx)(nS.A,{sx:{fontWeight:"settings"===l?"bold":"normal"},value:"settings",label:"Settings"}),(0,r.jsx)(nS.A,{sx:{fontWeight:"modelInfo"===l?"bold":"normal"},value:"modelInfo",label:"Model"}),(0,r.jsx)(nS.A,{sx:{fontWeight:"usage"===l?"bold":"normal"},value:"usage",label:"Usage"})]}),(0,r.jsx)(nd.A,{}),(0,r.jsxs)(t5.A,{sx:{flexGrow:1,overflow:"auto"},children:["history"===l&&(0,r.jsx)(nH,{...t}),"settings"===l&&(0,r.jsx)(n2,{...n}),"modelInfo"===l&&o&&(0,r.jsx)(n6,{model:o}),"usage"===l&&(0,r.jsx)(t5.A,{p:2,children:(0,r.jsx)(nx,{})})]})]})})};var n4=n(71169),n9=n(67217),n8=n(20904),n7=n(3337),re=n(9665),rt=n(28005),rn=n(41218),rr=n(13368),ro=n(8494),ri=n(33290),rl=n(80744),ra=n(29652),rs=n(4075),rd=n(31050),rc=n(59011);let ru=e=>{let{content:t}=e;return(0,r.jsx)(ri.oz,{children:t,remarkPlugins:[rl.A,ra.A],rehypePlugins:[rs.A],components:{code(e){let{node:t,inline:n,className:o,children:i,style:l,ref:a,...s}=e,d=/language-(\w+)/.exec(o||""),c=String(i).replace(/\n$/,"");return d&&"mermaid"===d[1]?(0,r.jsxs)("div",{style:{marginTop:"8px",marginBottom:"8px"},children:[" ",(0,r.jsx)(rd.d,{children:c})]}):!n&&d?(0,r.jsx)(rc.f4,{code:c,language:d[1],theme:rc.Zj.vsDark,children:e=>{let{className:t,style:n,tokens:o,getLineProps:i,getTokenProps:l}=e;return(0,r.jsx)("pre",{className:t,style:{...n,padding:"12px",borderRadius:"6px",overflowX:"auto"},children:o.map((e,t)=>(0,r.jsx)("div",{...i({line:e}),children:e.map((e,t)=>(0,r.jsx)("span",{...l({token:e})},t))},t))})}}):(0,r.jsx)("code",{className:o,...s,style:{backgroundColor:"rgba(128, 128, 128, 0.15)",padding:"0.1em 0.3em",borderRadius:"4px",fontFamily:"monospace",fontSize:"0.9em"},children:i})}}})},rp=(e,t)=>{let{visibleDelay:n}=e;return()=>{let e=t();requestAnimationFrame(()=>setTimeout(()=>requestAnimationFrame(()=>e()),n))}},rg=e=>{let{message:t}=e,n=(0,nA.A)(),i=(0,t1.e3)(eA),l=(0,t1.e3)(ek),s=(0,t1.e3)(tI),[d,c]=(0,o.useState)(!1),[u,p]=(0,o.useState)(!1),[g,m]=(0,o.useState)(!1),[h,x]=(0,o.useState)(!1),[f,v]=(0,o.useState)(t.content),[y,j]=(0,o.useState)(""),A=(0,o.useRef)(null),w=i&&l===t.id,b=s===t.id,k=null===s,M=()=>{x(!1),v(y),tx(),requestAnimationFrame(()=>es(!1))},S=()=>{f!==y&&ee({messageId:t.id,newContent:f}),x(!1),tx(),requestAnimationFrame(()=>es(!1))},C=(0,rt.HZ)(rp({visibleDelay:20},()=>(p(!0),()=>{p(!1),et(t.id)})),{threshold:400})("delete"),I=(0,rt.HZ)(rp({visibleDelay:20},()=>(m(!0),()=>{m(!1),en(t)})),{threshold:400})("retry");return(0,o.useEffect)(()=>{},[h,S]),(0,r.jsx)(tJ.A,{className:"chat-message",ref:A,variant:"outlined",id:t.id,onMouseEnter:()=>k&&c(!0),onMouseLeave:()=>k&&c(!1),sx:{borderRadius:2,display:"flex",flexDirection:"column",position:"relative",borderColor:b?n.palette.secondary.light:d&&k?n.palette.primary.light:"transparent",padding:2,transition:n.transitions.create("border-color")},children:(0,r.jsxs)(rn.A,{raised:!0,elevation:1,sx:{p:2,borderRadius:2,alignSelf:"user"===t.role?"flex-end":"flex-start",backgroundColor:"user"===t.role?"primary.dark":n.palette.background.paper,width:h?"-webkit-fill-available":"fit-content",maxWidth:"100%",wordWrap:"break-word"},children:[h?(0,r.jsx)(rr.Ay,{multiline:!0,fullWidth:!0,value:f,onChange:e=>{v(e.target.value)},autoFocus:!0,onKeyDown:e=>{"Escape"===e.key&&M()},sx:{padding:0,borderBottom:0,fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",color:"inherit","& .MuiInputBase-input":{resize:"vertical"}}}):(0,r.jsx)(t4.A,{component:"div",variant:"body1",sx:{fontSize:"inherit",overflowWrap:"break-word",width:"100%"},children:(0,r.jsx)(ru,{content:t.content})}),(w||t.isLoading)&&(0,r.jsx)(nD.A,{size:20,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-10px",marginLeft:"-10px",zIndex:1}}),(0,r.jsx)(tJ.A,{elevation:0,sx:{position:"absolute",borderRadius:20,top:-18,right:4,bgcolor:"background.default",p:.25,gap:.5,display:b||d&&k?"flex":"none",opacity:b||d&&k?1:0,transition:n.transitions.create("opacity"),zIndex:2},children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t9.A,{"aria-label":"confirm",color:"success",size:"small",onClick:S,title:"Confirm Edit (Enter)",children:(0,r.jsx)(nB.A,{fontSize:"small"})}),(0,r.jsx)(t9.A,{"aria-label":"cancel",color:"inherit",size:"small",onClick:M,title:"Cancel Edit (Escape)",children:(0,r.jsx)(t7.A,{fontSize:"small"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t9.A,{"aria-label":"copy",size:"small",color:"inherit",onClick:()=>{"string"==typeof t.content?navigator.clipboard.writeText(t.content).then(()=>console.log("Code/Markdown copied to clipboard")).catch(e=>console.error("Failed to copy code/markdown: ",e)):console.error("Cannot copy non-string content as code/markdown")},title:"Copy Markdown",children:(0,r.jsx)(n$.A,{fontSize:"small"})}),(0,r.jsx)(t9.A,{"aria-label":"edit",size:"small",onClick:()=>{h||null!==s||(j(t.content),th(t.id),x(!0))},color:"inherit",title:"Edit Message (Double-Click)",children:(0,r.jsx)(nW.A,{fontSize:"small"})}),(0,r.jsx)(t9.A,{"aria-label":"delete",size:"small",onClick:()=>{a({message:"Long press to delete a message.",severity:"info"})},title:"Long press to delete",color:u?"error":"inherit",...C,children:(0,r.jsx)(nN.A,{fontSize:"small"})}),(0,r.jsx)(t9.A,{"aria-label":"retry",size:"small",onClick:()=>{a({message:"Long press to regenerate a message.",severity:"info"})},title:"Retry Generation",disabled:i,color:g?"success":"inherit",...I,children:(0,r.jsx)(ro.A,{fontSize:"small"})})]})})]})},t.id)};var rm=n(71977),rh=n(76871),rx=n(60744);let rf=o.forwardRef(function(e,t){return(0,r.jsx)(rx.A,{direction:"up",ref:t,...e})});function rv(e){let t=o.useRef(null);return(0,r.jsx)(t6(),{nodeRef:t,handle:"#draggable-dialog-title",cancel:'[class*="MuiDialogContent-root"]',children:(0,r.jsx)(tJ.A,{...e,ref:t})})}function ry(){let[e,t,n]=(0,t1.e3)([tk,tr,to]);return(0,r.jsxs)(nf.A,{open:e,onClose:t,PaperComponent:rv,TransitionComponent:rf,keepMounted:!0,"aria-labelledby":"draggable-dialog-title","aria-describedby":"alert-dialog-slide-description",children:[(0,r.jsx)(nv.A,{style:{cursor:"move"},id:"draggable-dialog-title",children:"API Key Required"}),(0,r.jsx)(ny.A,{children:(0,r.jsx)(rh.A,{id:"alert-dialog-slide-description",children:"Your OpenRouter API key is missing. Please enter it in Chat Settings to enable sending messages."})}),(0,r.jsxs)(rm.A,{children:[(0,r.jsx)(t0.A,{onClick:t,children:"Close"}),(0,r.jsx)(t0.A,{onClick:()=>{t(),n()},autoFocus:!0,children:"Go to Settings"})]})]})}var rj=n(67350),rA=n(58748),rw=n(57316),rb=n(4420);let rk=(0,rw.A)("div")(e=>{let{theme:t}=e;return{position:"sticky",top:-8,paddingLeft:16,paddingBottom:1,paddingTop:1,color:(0,rb.a)(t.palette.secondary.light,.4),backgroundColor:(0,rb.a)(t.palette.secondary.light,.9),...t.applyStyles("dark",{backgroundColor:(0,rb.e$)(t.palette.secondary.light,.5)})}}),rM=(0,rw.A)("ul")({padding:0}),rS=()=>{let e=(0,nA.A)(),t=(0,nw.A)(e.breakpoints.down("sm")),{models:n,selectedModelId:i,isLoading:l,error:a,handleModelSelect:s,retryFetch:d,showFreeOnly:c}=(0,t1.e3)({models:T,selectedModelId:z,isLoading:F,error:U,handleModelSelect:N,retryFetch:W,showFreeOnly:X}),[u,p]=(0,o.useState)(!1),g=(0,o.useMemo)(()=>{let e=n;return c&&(e=e.filter(e=>{var t,n;return(null===(t=e.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=e.pricing)||void 0===n?void 0:n.completion)==="0"})),e},[n,c]);(0,o.useMemo)(()=>{let e=n.find(e=>e.id===i);return e?e.name.replace(/^[^:]+:\s*/,""):i},[n,i]);let m=(0,o.useMemo)(()=>n.find(e=>e.id===i),[n,i]);return(0,r.jsxs)(t5.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",flexGrow:1},children:[a&&!l&&(0,r.jsx)(nY.A,{title:"Error loading models: ".concat(a,". Click to retry."),children:(0,r.jsx)(rj.A,{color:"error",sx:{mr:1,cursor:"pointer"},onClick:()=>d()})}),(0,r.jsx)(n_.A,{groupBy:e=>e.created?new Date(1e3*e.created).toLocaleString("default",{month:"long",year:"numeric"}):"Unknown",renderGroup:e=>(0,r.jsxs)("li",{children:[(0,r.jsx)(rk,{children:e.group}),(0,r.jsx)(rM,{children:e.children})]},e.key),id:"appbar-model-selector",value:null!=m?m:null,open:u,onOpen:()=>{p(!0),B(!0)},onClose:()=>{p(!1),B(!1)},onChange:(e,t)=>{t&&s(t.id)},options:g,getOptionLabel:e=>e.name.replace(/^[^:]+:\s*/,"")||e.id,isOptionEqualToValue:(e,t)=>e.id===t.id,loading:l,disabled:l||null!==a,sx:{maxWidth:460,flexGrow:1,mx:.6},renderInput:e=>(0,r.jsx)(t8.A,{...e,variant:"outlined",placeholder:"Select Model...",InputProps:{...e.InputProps,style:{color:"inherit",height:"36px"},endAdornment:(0,r.jsx)(o.Fragment,{children:e.InputProps.endAdornment})},inputProps:{...e.inputProps,style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}}),renderOption:(e,t)=>(0,o.createElement)(t5.A,{component:"li",...e,key:t.id,children:[t.name," "]})}),!t&&(0,r.jsx)(t9.A,{size:"small",onClick:()=>{t?tp({tab:"modelInfo"}):tf()},disabled:!m,sx:{color:"inherit"},children:(0,r.jsx)(rA.A,{})})]})},rC=e=>{var t,n,o,i;let{model:l}=e;(0,t1.e3)(tS),(0,t1.e3)(tM);let a=(0,t1.e3)(tM),s=(null===(t=l.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=l.pricing)||void 0===n?void 0:n.completion)==="0",d=l.created?new Date(1e3*l.created).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"",c=(null===(o=l.pricing)||void 0===o?void 0:o.prompt)?(1e6*parseFloat(l.pricing.prompt)).toFixed(2):"0",u=(null===(i=l.pricing)||void 0===i?void 0:i.completion)?(1e6*parseFloat(l.pricing.completion)).toFixed(2):"0";return(0,r.jsxs)(nf.A,{scroll:"body",open:a,onClose:()=>tv(),"aria-labelledby":"Model info","aria-describedby":"Shows Model name, date, cost, and description",children:[(0,r.jsx)(nv.A,{children:"Model Info"}),(0,r.jsx)(ny.A,{children:(0,r.jsxs)(t5.A,{children:[(0,r.jsxs)(tQ.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(t4.A,{variant:"h6",fontWeight:"bold",children:l.name}),s&&(0,r.jsx)(nY.A,{title:"Free model",children:(0,r.jsx)(n3.A,{fontSize:"small"})})]}),(0,r.jsxs)(tQ.A,{direction:"row",alignItems:"center",spacing:1,mt:1,children:[(0,r.jsx)(t4.A,{variant:"body2",fontFamily:"monospace",children:l.id}),(0,r.jsx)(nY.A,{title:"Copy model ID",children:(0,r.jsx)(t9.A,{size:"small",onClick:()=>{navigator.clipboard.writeText(l.id)},children:(0,r.jsx)(n$.A,{fontSize:"small"})})})]}),(0,r.jsx)(nd.A,{sx:{my:2}}),(0,r.jsxs)(tQ.A,{spacing:1,flexWrap:"wrap",children:[(0,r.jsxs)(tQ.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(t4.A,{variant:"body2",color:"text.secondary",children:["Created ",d]}),(0,r.jsxs)(t4.A,{variant:"body2",color:"text.secondary",children:[l.context_length.toLocaleString()," context"]})]}),(0,r.jsxs)(tQ.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(t4.A,{variant:"body2",color:"text.secondary",children:["$",c,"/M input tokens"]}),(0,r.jsxs)(t4.A,{variant:"body2",color:"text.secondary",children:["$",u,"/M output tokens"]})]})]}),(0,r.jsx)(nd.A,{sx:{my:2}}),(0,r.jsx)(t4.A,{variant:"body2",color:"text.primary",whiteSpace:"pre-line",children:l.description})]})}),(0,r.jsx)(rm.A,{children:(0,r.jsx)(t5.A,{sx:{p:2,display:"flex",alignSelf:"center"},children:(0,r.jsx)(t0.A,{variant:"contained",onClick:()=>tv(),autoFocus:!0,children:"Ok"})})})]})};function rI(){!function(){let e=(0,o.useRef)({x:0,y:0}),t=(0,o.useRef)(null);(0,o.useEffect)(()=>{let n=t=>{let n,r;t instanceof MouseEvent?(n=t.clientX,r=t.clientY):"touches"in t&&t.touches.length>0?(n=t.touches[0].clientX,r=t.touches[0].clientY):"changedTouches"in t&&t.changedTouches.length>0?(n=t.changedTouches[0].clientX,r=t.changedTouches[0].clientY):(n=e.current.x,r=e.current.y),e.current={x:n,y:r}};function r(){t.current&&(clearTimeout(t.current),t.current=null),tP()}function o(){r(),t.current=setTimeout(()=>{let t=window.getSelection();if(!t||t.isCollapsed){r();return}let n=t.anchorNode;for(;n&&1!==n.nodeType;)n=n.parentElement;if(!n||!n.closest(".chat-message")){r();return}let o=t.toString().trim();if(!o){r();return}tX({x:e.current.x+window.scrollX-40,y:e.current.y+window.scrollY+16,selectionText:o})},300)}document.addEventListener("mousedown",n),document.addEventListener("mousemove",n),document.addEventListener("touchstart",n,{passive:!0}),document.addEventListener("touchmove",n,{passive:!0}),document.addEventListener("mouseup",n),document.addEventListener("touchend",n),document.addEventListener("selectionchange",o);let i=()=>tP();return document.addEventListener("scroll",i,!0),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("mousemove",n),document.removeEventListener("touchstart",n),document.removeEventListener("touchmove",n),document.removeEventListener("mouseup",n),document.removeEventListener("touchend",n),document.removeEventListener("selectionchange",o),document.removeEventListener("scroll",i,!0)}},[])}();let e=o.useRef(null),t=(0,nA.A)(),n=(0,nw.A)(t.breakpoints.down("sm")),[i,l]=(0,t1.e3)([ej,ey]),c=i.length>0?i[i.length-1]:null,[u,p]=(0,t1.e3)([tw,tb]),[g,m]=(0,t1.e3)([e9,w]),h=(0,t1.e3)(tI),[x,v]=(0,t1.e3)([eA,eb]),M=(0,t1.e3)(eM);(0,t1.e3)(tS);let[S,C,I,D,E]=(0,t1.e3)([e4,e8,eq,eH,e9.map(e=>{var t;return null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null})]),{apiKey:F,temperature:X,systemPrompt:P,currentChatTokens:O}=(0,t1.e3)({apiKey:w,temperature:b,systemPrompt:k,currentChatTokens:ew}),[R,L]=o.useState(""),[U,N]=o.useState(!1),[B,G]=o.useState(null),[$,q]=o.useState(""),[H,_]=o.useState(!1),K=(0,t1.e3)(d),Y=o.useMemo(()=>R?S.filter(e=>e.title.toLowerCase().includes(R.toLowerCase())):S,[S,R]),Z=()=>{n?tp({tab:"settings"}):tl()},V=()=>{if(null!==h){let e=document.getElementById(h);e&&e.scrollIntoView({behavior:"smooth",block:"center"}),console.log("Editing message, not sending new one"),a({message:"Finish editing before sending a new message.",severity:"warning"});return}let e=0===l.trim().length,t=(null==c?void 0:c.role)==="user";e?t&&!x&&ed():x||Q()},ee={searchTerm:R,setSearchTerm:L,isLoading:C,filteredHistory:Y,editingId:B,editedTitle:$,currentChatId:E,setEditedTitle:q,handleStartEdit:(e,t,n)=>{n.stopPropagation(),G(e),q(t)},handleSaveEdit:e=>{eK({id:e,newTitle:$.trim()}),G(null)},handleCancelEdit:()=>{G(null)},handleDeleteChat:(e,t)=>{t.stopPropagation(),D(e)},handleSelectChat:e=>{I(e),n&&tg()}},et={apiKey:F,showApiKey:H,temperature:X,systemPrompt:P,currentChatTokens:O,handleApiKeyChange:y,handleTemperatureChange:j,handleSystemPromptChange:A,handleClickShowApiKey:()=>_(e=>!e),handleMouseDownApiKey:e=>{e.preventDefault()}},[en,er]=(0,t1.e3)([z,T]),eo=o.useMemo(()=>er.find(e=>e.id===en),[er,en]);o.useEffect(()=>{M&&es(!1)},[M]);let ei=(0,t1.e3)(eM),el=(0,t1.e3)(eS);return o.useEffect(()=>{ei||requestAnimationFrame(()=>{var t;null===(t=e.current)||void 0===t||t.scrollIntoView({behavior:"smooth"})})},[c,el,ei]),o.useEffect(()=>{f(),W(),eB()},[]),(0,r.jsxs)(t5.A,{sx:{height:"100vh",overflow:"hidden",fontSize:20},children:[" ",(0,r.jsx)(n4.A,{position:"fixed",sx:e=>{let t=!n&&u,r=!n&&p,o="100%",i="0px",l="0px",a={easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen};return t&&r?(o="calc(100% - ".concat(600,"px)"),i="".concat(300,"px"),l="".concat(300,"px"),a={easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}):t?(o="calc(100% - ".concat(300,"px)"),i="".concat(300,"px"),l="0px",a={easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}):r&&(o="calc(100% - ".concat(300,"px)"),i="0px",l="".concat(300,"px"),a={easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),{width:o,marginLeft:i,marginRight:l,transition:e.transitions.create(["margin","width"],a)}},children:(0,r.jsxs)(nC.A,{variant:"dense",disableGutters:!0,sx:{px:1,borderBottom:1,borderColor:"divider"},children:[(!u||n)&&(0,r.jsx)(t9.A,{color:"inherit","aria-label":"History",onClick:()=>{n?tp({tab:"history"}):tu()},children:(0,r.jsx)(nR.A,{})}),(!u||n)&&(0,r.jsx)(t9.A,{size:"small",color:"inherit","aria-label":"New chat",onClick:()=>e_(),children:(0,r.jsx)(nL.A,{})}),(0,r.jsx)(t5.A,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:(0,r.jsx)(rS,{})}),!n&&(0,r.jsx)(t9.A,{color:"inherit","aria-label":"usage info",onClick:()=>{nu(),N(!0)},children:(0,r.jsx)(ns.A,{})}),!p&&!n&&(0,r.jsx)(t9.A,{color:"inherit","aria-label":"settings",onClick:Z,children:(0,r.jsx)(nQ.A,{})}),n&&(0,r.jsx)(t9.A,{size:"small",edge:"end",color:"inherit","aria-label":"settings",onClick:Z,children:(0,r.jsx)(nQ.A,{})})]})}),(0,r.jsxs)(t5.A,{component:"main",sx:e=>({flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:0,marginRight:0,...u&&!n&&{marginLeft:"".concat(300,"px"),transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},...p&&!n&&{marginRight:"".concat(300,"px"),transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},pt:"".concat(Number(e.mixins.toolbar.minHeight)-16,"px"),pb:0,boxSizing:"border-box"}),children:[(0,r.jsxs)(t5.A,{sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",width:"100%",p:n?1:2,pt:n?2:3,position:"relative"},children:[(0,r.jsxs)(n9.A,{maxWidth:"md",disableGutters:!0,sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%"},children:[(0,r.jsx)(tJ.A,{elevation:0,sx:{backgroundColor:"transparent",display:"flex",flexDirection:"column",width:"100%",alignItems:"center"},children:(0,r.jsxs)(tQ.A,{alignItems:"center",sx:{alignItems:"stretch",width:"100%"},children:[i.map(e=>(0,r.jsx)(rg,{message:e},e.id)),(0,r.jsx)("div",{ref:e})]})})," "]})," ",(0,r.jsx)(nb.A,{open:K.open,anchorOrigin:{vertical:"top",horizontal:"center"},sx:e=>{let t=Number(e.mixins.toolbar.minHeight)+8;return{top:"".concat(t,"px !important")}},children:(0,r.jsx)(re.A,{variant:"filled",onClose:()=>s(),severity:K.severity,children:K.message})}),(0,r.jsx)(na,{})]})," ",v&&(0,r.jsx)(n9.A,{maxWidth:"md",sx:{px:n?1:2,width:"100%"},children:(0,r.jsx)(re.A,{severity:"error",sx:{mt:1,mb:1,width:"100%"},children:v})}),(0,r.jsx)(nn.A,{color:"secondary",sx:{top:1,poosition:"absolute",width:"100%",height:"1px",visibility:x?"visible":"hidden"}}),(0,r.jsxs)(tJ.A,{square:!0,sx:{mt:"auto",width:"100%",backgroundColor:"background.paper",flexShrink:0,borderTop:1,borderColor:"divider",p:1},children:[(0,r.jsxs)(t5.A,{maxWidth:"md",sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,r.jsxs)(t9.A,{sx:{mx:-.5},color:"primary","aria-label":"attach file",disabled:!0,children:[" ",(0,r.jsx)(n7.A,{})]}),(0,r.jsx)(t8.A,{fullWidth:!0,multiline:!0,maxRows:5,variant:"outlined",placeholder:"Type your message...",sx:{flexGrow:1},slotProps:{input:{sx:{fontSize:22,py:1}}},value:l,onChange:e=>J(e.target.value),onFocus:()=>ep(!0),onBlur:()=>ep(!1)}),(0,r.jsx)(t5.A,{children:(()=>{let e=0===l.trim().length,t=i.length>0?i[i.length-1]:null,n=(null==t?void 0:t.role)==="user";return(0,r.jsxs)(t9.A,{"aria-label":"Generate",onClick:V,disabled:x||e&&!n,sx:{mx:-.5,color:"primary.light"},children:[(0,r.jsx)(n8.A,{})," "]})})()})]})," "]})," ",(0,r.jsx)(ry,{})]})," ",(0,r.jsx)(nj,{open:U,onClose:()=>N(!1)}),!n&&(0,r.jsx)(nk.Ay,{variant:"persistent",open:u,anchor:"left",sx:{width:300,flexShrink:0,"& .MuiDrawer-paper":{width:300,boxSizing:"border-box"}},children:(0,r.jsx)(t5.A,{sx:{overflow:"auto"},children:(0,r.jsx)(nH,{...ee})})}),!n&&(0,r.jsx)(nk.Ay,{variant:"persistent",open:p,anchor:"right",sx:{width:300,flexShrink:0,"& .MuiDrawer-paper":{width:300,boxSizing:"border-box"}},children:(0,r.jsx)(n2,{...et})}),n&&(0,r.jsx)(n5,{historyPanelProps:ee,settingsPanelProps:et,modelInfo:eo}),!!eo&&(0,r.jsx)(rC,{model:eo}),(0,r.jsx)(t2,{}),(0,r.jsx)(no,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5661,7330,9568,993,8441,1684,7358],()=>t(1562)),_N_E=e.O()}]);