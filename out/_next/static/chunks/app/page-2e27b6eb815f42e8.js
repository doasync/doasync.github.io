(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{1562:(e,t,n)=>{Promise.resolve().then(n.bind(n,74709))},74709:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>rb});var r=n(95155),o=n(12115),l=n(87971),i=n(41236),a=n(24868);let s=(0,l.lh)(),d=(0,l.lh)(),c=(0,l.y$)({open:!1,message:"",severity:"info"}),u=(0,l.lh)(),p=(0,l.lh)();async function g(e){let{message:t,model:n,apiKey:r}=e;try{var o,l,i;let e=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:null!=n?n:"mistralai/mixtral-8x7b-instruct",messages:[{role:"user",content:t}]})});if(!e.ok)throw Error("OpenRouter API error: ".concat(e.status));let a=await e.json(),s=null===(i=a.choices)||void 0===i?void 0:null===(l=i[0])||void 0===l?void 0:null===(o=l.message)||void 0===o?void 0:o.content;if("string"==typeof s)return s.trim();throw Error("Malformed OpenRouter response")}catch(e){return console.error("OpenRouter API error",e),"Sorry, there was an error processing your request."}}(0,i.c)({source:u,timeout:2500,target:p}),(0,l.XM)({source:c,clock:s,filter:(e,t)=>{let{open:n}=e,{message:r}=t;return!n&&!!r},fn:(e,t)=>{let{message:n,severity:r="info"}=t;return{open:!0,message:n,severity:r}},target:c}),(0,l.XM)({source:c,filter:e=>{let{open:t}=e;return!!t},target:u}),(0,l.XM)({clock:[d,p],source:c,filter:e=>{let{open:t}=e;return!!t},fn:(e,t)=>{let{message:n="",severity:r="info"}=t||{};return{open:!1,message:n,severity:r}},target:c}),(0,a.Y)({showSnackbar:s,hideSnackbar:d,$snackbar:c,startAutoHide:u,autoHide:p});let m="openrouter_api_key",h="default_temperature",x="default_system_prompt",f=(0,l.$5)("settings"),v=f.event("loadSettings"),y=f.event("settingsLoaded"),j=f.event("apiKeyChanged"),A=f.event("temperatureChanged"),w=f.event("systemPromptChanged"),b=f.store("",{name:"apiKey"}),k=f.store(.7,{name:"temperature"}),M=f.store("",{name:"systemPrompt"}),C=f.store(!1,{name:"settingsLoaded"}).on(y,()=>!0),S=(0,l.kg)({apiKey:b,temperature:k,systemPrompt:M}),I=f.effect({name:"loadSettingsFx",handler:async()=>{var e,t;let n=null!==(e=localStorage.getItem(m))&&void 0!==e?e:"",r=localStorage.getItem(h),o=null!==(t=localStorage.getItem(x))&&void 0!==t?t:"",l=.7;if(r){let e=parseFloat(r);isNaN(e)||(l=e)}return{apiKey:n,temperature:l,systemPrompt:o}}}),D=f.effect({name:"saveSettingsFx",handler:async e=>{let{apiKey:t,temperature:n,systemPrompt:r}=e;localStorage.setItem(m,t),localStorage.setItem(h,String(n)),localStorage.setItem(x,r)}});(0,l.XM)({clock:v,target:I}),(0,l.XM)({clock:I.doneData,target:y}),b.on(y,(e,t)=>t.apiKey),k.on(y,(e,t)=>t.temperature),M.on(y,(e,t)=>t.systemPrompt),b.on(j,(e,t)=>t),k.on(A,(e,t)=>t),M.on(w,(e,t)=>t),(0,l.XM)({clock:S,filter:C,target:D}),I.fail.watch(e=>{let{error:t}=e;console.error("Failed to load settings:",t)}),D.fail.watch(e=>{let{error:t}=e;console.error("Failed to save settings:",t)}),(0,a.Y)(b,k,M,C,v,j,A,w,I,D);var T=n(4602);let E=(0,l.$5)("models"),F=E.store([],{name:"availableModels"}),P=E.store("openrouter/quasar-alpha",{name:"selectedModelId"}),z=E.store(!1,{name:"isLoadingModels"}),X=E.store(!1,{name:"showFreeOnly"}),O=E.event("setShowFreeOnly");X.on(O,(e,t)=>t),(0,T.Zr)({store:X,key:"showFreeOnly"}),(0,T.Zr)({store:P,key:"selectedModelId"});let R=E.store("google/gemini-2.0-flash-lite-001",{name:"autoTitleModelId"}),L=E.event("autoTitleModelSelected");R.on(L,(e,t)=>t),(0,T.Zr)({store:R,key:"autoTitleModelId"});let U=E.store(null,{name:"modelsError"}),W=E.event("fetchModels"),N=E.event("modelSelected"),B=E.effect({name:"fetchModelsFx",handler:async()=>{let e=await fetch("https://openrouter.ai/api/v1/models");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).data.sort((e,t)=>{var n,r;return(null!==(n=t.created)&&void 0!==n?n:0)-(null!==(r=e.created)&&void 0!==r?r:0)})}});(0,l.XM)({clock:W,target:B}),z.on(B,()=>!0).reset(B.finally),F.on(B.doneData,(e,t)=>t),(0,l.XM)({clock:B.doneData,source:P,fn:(e,t)=>t.length>0?t.some(t=>t.id===e)?e:t[0].id:e,target:P}),P.on(N,(e,t)=>t),U.on(B.failData,(e,t)=>t.message).reset(B),U.reset(B.done),(0,a.Y)(F,P,z,U,W,N,B);var G=n(76012);let $=async e=>{let{modelId:t,messages:n,apiKey:r,temperature:o,systemPrompt:l}=e,i=[];l&&l.trim()&&i.push({role:"system",content:l}),n.forEach(e=>{("user"===e.role||"assistant"===e.role)&&i.push({role:e.role,content:e.content})});let a=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:t,messages:i,temperature:o})});if(!a.ok){let e="HTTP error! status: ".concat(a.status);try{let t=await a.json();e="API Error (".concat(a.status,"): ").concat(t.error.message)}catch(e){}throw Error(e)}return await a.json()},q=(e,t)=>{var n,r,o;let{messages:l}=e,i=null===(o=t.choices)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(n=r.message)||void 0===n?void 0:n.content;return[...l,i?{id:t.id||crypto.randomUUID(),role:"assistant",content:i,timestamp:Date.now()}:{id:t.id||crypto.randomUUID(),role:"assistant",content:"Error: Empty response",timestamp:Date.now()}]},H=(e,t)=>{let n,{messages:r,apiKey:o,temperature:l,systemPrompt:i,selectedModelId:a}=e,s=r.findIndex(e=>e.id===t.id);if(-1===s)throw Error("Message to retry not found: "+t.id);if("user"===t.role)n=r.slice(0,s+1);else{if(s<0)throw Error("Invalid retryIndex for assistant message retry.");n=r.slice(0,s)}return{modelId:a,messages:n,apiKey:o,temperature:l,systemPrompt:i}},_=(e,t)=>{var n,r,o,l,i,a,s,d;let c;let{messages:u,requestContext:p}=e,g=-1,m=!1;if((null==p?void 0:p.type)==="generate"){if(-1===(g=u.findIndex(e=>e.id===p.placeholderId)))return console.error("Generating placeholder message not found for replacement:",p.placeholderId),null;m=!1,console.log("[DEBUG][lib] calculateRetryUpdatePayloadFn: GENERATE FLOW RETURNING:",{targetIndex:g,newAssistantMessageId:(c={id:t.id||crypto.randomUUID(),role:"assistant",content:null!==(l=null===(o=t.choices)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(n=r.message)||void 0===n?void 0:n.content)&&void 0!==l?l:"Error: Empty response",timestamp:Date.now(),isLoading:!1}).id,insert:m}),console.log("[DEBUG] calculateRetryUpdatePayloadFn: GENERATE FLOW RETURNING:",{targetIndex:g,newAssistantMessage:c,insert:m})}else{if((null==p?void 0:p.type)!=="retry")return console.error("calculateRetryUpdatePayloadFn called with unexpected context:",p),null;let{originalMessageId:e,originalRole:n}=p;if(c={id:t.id||crypto.randomUUID(),role:"assistant",content:null!==(d=null===(s=t.choices)||void 0===s?void 0:null===(a=s[0])||void 0===a?void 0:null===(i=a.message)||void 0===i?void 0:i.content)&&void 0!==d?d:"Error: Empty response",timestamp:Date.now()},"assistant"===n)g=u.findIndex(t=>t.id===e);else{if("user"!==n)return console.error("Unexpected original role in retry context:",n),null;let t=u.findIndex(t=>t.id===e);if(-1===t)return console.error("Original user message for retry not found:",e),null;let r=u.findIndex((e,n)=>n>t&&"assistant"===e.role);-1!==r?(g=r,m=!1):(g=t,m=!0,console.log("[calculateRetryUpdatePayloadFn] No assistant after retried user message, inserting new assistant message after user:",e))}}if(-1===g)return console.error("Retry logic error: Could not determine target index."),null;let h={targetIndex:g,newAssistantMessage:c,insert:m};return -1===g?(console.error("Retry logic error: Final targetIndex is -1. Returning null."),null):h},K=(e,t)=>{let{messageId:n,role:r}=t;if("assistant"===r)return n;{let t=e.findIndex(e=>e.id===n);if(-1===t)return console.error("Retrying user message not found:",n),null;let r=e.find((e,n)=>n>t&&"assistant"===e.role);return r?r.id:null}},Y=(e,t)=>{let{targetIndex:n,newAssistantMessage:r,insert:o=!1}=t;if(o){let t=[...e];return n>=-1&&n<e.length?(t.splice(n+1,0,r),t):(console.error("Retry update (insert) received invalid index:",n),e)}if(-1!==n&&n<e.length)return e.map((e,t)=>t===n?r:e);if(n===e.length){let t=[...e];return t[t.length-1]=r,t}return console.error("Retry update (replace) received invalid index or state."),e},Z=(0,l.$5)("chat"),V=Z.event("messageTextChanged"),J=Z.event("messageSent"),Q=Z.event("editMessage"),ee=Z.event("deleteMessage"),et=Z.event("messageRetry"),en=Z.event("initialChatSaveNeeded"),er=Z.event("apiKeyMissing"),eo=Z.event("apiRequestTokensUpdated"),el=Z.event("userMessageCreated"),ei=Z.event("scrollToLastMessageNeeded"),ea=Z.event("setPreventScroll"),es=Z.event("generateResponseClicked"),ed=Z.event("retryUpdate"),ec=Z.event("normalResponseProcessed"),eu=Z.event("messageRetryInitiated"),ep=Z.event("prepareRetryParams"),eg=Z.event("calculatedRetryUpdate"),em=Z.event("addPlaceholderForGeneration"),eh=Z.event("placeholderGenerated"),ex=Z.effect({name:"sendApiRequestFx",handler:$}),ef=Z.store("",{name:"$messageText"}),ev=Z.store([],{name:"$messages"}),ey=Z.store(!1,{name:"$isGenerating"}),ej=Z.store(0,{name:"$currentChatTokens"}),eA=Z.store(null,{name:"$apiError"}),ew=Z.store(null,{name:"$retryingMessageId"}),eb=Z.store(!1,{name:"$preventScroll"}),ek=Z.store(0,{name:"$scrollTrigger"}).on(ei,()=>Date.now()),eM=e=>!!e&&("user"===e.role||"assistant"===e.role);ef.on(V,(e,t)=>t),ev.on(Q,(e,t)=>{let{messageId:n,newContent:r}=t;return e.map(e=>e.id===n?{...e,content:r,isEdited:!0,originalContent:e.content}:e)}).on(ee,(e,t)=>e.filter(e=>e.id!==t)).on(el,(e,t)=>[...e,t]).on(eh,(e,t)=>[...e,t]).on(ed,(e,t)=>Y(e,t)).on(ex.done,(e,t)=>{var n;let{params:r,result:o}=t;return(null===(n=r.requestContext)||void 0===n?void 0:n.type)==="normal"?q({messages:e},o):e}),eA.reset(J,es,et),ey.on(ex,()=>!0).reset(ex.finally),ej.on(ex.doneData,(e,t)=>{var n,r;return e+(null!==(r=null===(n=t.usage)||void 0===n?void 0:n.total_tokens)&&void 0!==r?r:0)}),ew.on(eu,(e,t)=>{let n=ev.getState();return"assistant"===t.role?t.messageId:K(n,t)}).on(eh,(e,t)=>t.id).reset(ex.finally),eb.on([Q],()=>!0).on([eu,es],()=>!1).on(ex.finally,(e,t)=>null===ew.getState()&&e),(0,l.XM)({clock:J,source:ef,filter:e=>e.trim().length>0,fn:e=>({id:crypto.randomUUID(),role:"user",content:e.trim(),timestamp:Date.now()}),target:el}),(0,l.XM)({clock:el,fn:()=>"",target:ef}),(0,l.XM)({clock:el,source:ev,filter:e=>1===e.length,target:en}),(0,l.XM)({clock:el,source:{messages:ev,apiKey:b,temperature:k,systemPrompt:M,selectedModelId:P},filter:e=>{let{apiKey:t}=e;return!!t},fn:e=>{let{messages:t,apiKey:n,temperature:r,systemPrompt:o,selectedModelId:l}=e;return{modelId:l,messages:t,apiKey:n,temperature:r,systemPrompt:o,requestContext:{type:"normal"}}},target:ex}),(0,l.XM)({clock:J,source:b,filter:e=>!e,target:er}),(0,l.XM)({clock:es,source:ey,filter:e=>!e,target:em}),(0,l.XM)({clock:em,fn:()=>({id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now(),isLoading:!0}),target:eh}),(0,l.XM)({clock:eh,source:{messages:ev,apiKey:b,temperature:k,systemPrompt:M,selectedModelId:P},filter:e=>{let{apiKey:t,messages:n}=e;return!!t&&n.length>0},fn:(e,t)=>{let{messages:n,apiKey:r,temperature:o,systemPrompt:l,selectedModelId:i}=e;return{modelId:i,messages:n.slice(0,-1),apiKey:r,temperature:o,systemPrompt:l,requestContext:{type:"generate",placeholderId:t.id}}},target:ex}),(0,l.XM)({clock:es,source:b,filter:e=>!e,target:er}),(0,l.XM)({clock:et,source:{messages:ev,apiKey:b,temperature:k,systemPrompt:M,selectedModelId:P},filter:(e,t)=>{let{apiKey:n}=e;return!!n&&eM(t)},fn:(e,t)=>{let{messages:n,apiKey:r,temperature:o,systemPrompt:l,selectedModelId:i}=e,a=H({messages:n,apiKey:r,temperature:o,systemPrompt:l,selectedModelId:i},t),s={type:"retry",originalMessageId:t.id,originalRole:t.role};return{...a,requestContext:s}},target:ep}),(0,l.XM)({clock:et,filter:eM,fn:e=>({messageId:e.id,role:e.role}),target:eu}),(0,l.XM)({clock:ep,target:ex}),(0,l.XM)({clock:ex.done,source:ev,fn:(e,t)=>{let{params:n,result:r}=t;return _({messages:e,requestContext:n.requestContext},r)},target:eg}),(0,l.XM)({clock:eg,filter:e=>{let t=null!==e;return console.log("[DEBUG] sample targeting retryUpdate:",{calculatedPayload:e,shouldTrigger:t}),t},target:ed}),(0,l.XM)({clock:ex.done,filter:e=>{var t;let{params:n}=e;return(null===(t=n.requestContext)||void 0===t?void 0:t.type)==="normal"},target:ec}),(0,l.XM)({clock:ex.doneData,target:eo}),(0,l.XM)({clock:[ed,ec],fn:()=>void 0,target:ei}),(0,a.Y)(ef,ev,ey,eA,ej,ew,eb,V,J,Q,ee,et,es,ea,ed,eu,el,ei,ep,eg,eo,en,em,eh,ec,ex);var eC=n(198);let eS="chats",eI=null,eD=()=>(eI||(eI=(0,eC.P2)("LLMChatDB",1,{upgrade(e){if(!e.objectStoreNames.contains(eS)){let t=e.createObjectStore(eS,{keyPath:"id"});t.indexNames.contains("lastModified")||t.createIndex("lastModified","lastModified")}}})),eI),eT=async()=>{let e=(await eD()).transaction(eS,"readonly"),t=e.objectStore(eS),n=await t.getAll();return await e.done,n.sort((e,t)=>t.lastModified-e.lastModified).map(e=>{let{id:t,title:n,lastModified:r}=e;return{id:t,title:n,lastModified:r}})},eE=async e=>{let t=await eD(),n=await t.get(eS,e);return null!=n?n:null},eF=async e=>{let t=await eD(),n={...e,messages:e.messages.map(e=>({...e,isEdited:e.isEdited||!1,originalContent:e.originalContent||null}))};await t.put(eS,n)},eP=async e=>{let t=await eD();await t.delete(eS,e)},ez=async e=>{let{id:t,newTitle:n}=e,r=(await eD()).transaction(eS,"readwrite"),o=r.objectStore(eS),l=await o.get(t);return l?(l.title=n,l.lastModified=Date.now(),await o.put(l),await r.done,{id:l.id,title:l.title,lastModified:l.lastModified}):(await r.done,null)},eX=async e=>{var t,n,r;let{chatId:o,messages:l,apiKey:i}=e;if(!i)throw Error("API key is required for title generation.");if(0===l.length)throw Error("Cannot generate title for empty chat.");let a=[...l.slice(0,6).map(e=>({role:e.role,content:e.content})),{role:"user",content:"Summarize this chat conversation\n  in 1-5 words (maximum conciseness). Use title case. Focus on user's intent.\n  It will be used as a title. Do not mention yourself (assistant) or the user.\n  Example: Exploring Effector Stores"}],s={model:R.getState(),messages:a,temperature:.5,max_tokens:10},d=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify(s)});if(!d.ok){let e="Title generation failed! status: ".concat(d.status);try{let t=await d.json();e="Title Generation API Error (".concat(d.status,"): ").concat(t.error.message)}catch(e){}throw Error(e)}let c=await d.json(),u=null===(r=c.choices)||void 0===r?void 0:null===(n=r[0])||void 0===n?void 0:null===(t=n.message)||void 0===t?void 0:t.content,p=null==u?void 0:u.replace(/[^a-zA-Z0-9\s]/g,"").trim();if(!p)throw console.error("Title generation API response content is empty or undefined:",c),Error("Title generation resulted in an empty response.");return{chatId:o,generatedTitle:p}},eO=(e,t)=>{let n;let r={id:t.id,title:t.title,lastModified:t.lastModified},o=e.findIndex(e=>e.id===t.id);return -1!==o?(n=[...e])[o]=r:n=[r,...e],n.sort((e,t)=>t.lastModified-e.lastModified)},eR=(e,t)=>t?e.map(e=>e.id===t.id?t:e).sort((e,t)=>t.lastModified-e.lastModified):e,eL=e=>{var t,n,r,o,l;let{currentSession:i,messages:a,model:s,temperature:d,systemPrompt:c,tokens:u,draft:p,selectedModelInfo:g}=e,m=Date.now(),h=null==i?void 0:i.id,x=null!=h?h:crypto.randomUUID(),f=h&&null!==(r=null==i?void 0:i.title)&&void 0!==r?r:new Date(m).toLocaleString();return{id:x,title:f,createdAt:h&&null!==(o=null==i?void 0:i.createdAt)&&void 0!==o?o:m,lastModified:m,messages:a,settings:{model:{pricing:{prompt:Number(null==g?void 0:null===(t=g.pricing)||void 0===t?void 0:t.prompt)||0,completion:Number(null==g?void 0:null===(n=g.pricing)||void 0===n?void 0:n.completion)||0},context_length:null!==(l=null==g?void 0:g.context_length)&&void 0!==l?l:1e6},temperature:d,systemPrompt:c},totalTokens:u,draft:null!=p?p:"",modelInfo:null!=g?g:null}},eU=(0,l.lh)("appStarted"),eW=(0,l.$5)("history"),eN=eW.event("loadChatHistory"),eB=eW.event("chatSelected"),eG=eW.event("deleteChat"),e$=eW.event("newChatCreated"),eq=eW.event("chatTitleEdited"),eH=eW.event("generateTitle"),e_=eW.event("duplicateChatClicked"),eK=eW.event("regenerateTitleForChat"),eY=eW.effect("loadChatHistoryIndexFx",{handler:eT}),eZ=eW.effect("duplicateChatFx");eZ.use(async e=>{var t,n,r;let o=await eE(e);if(!o)throw Error("Original chat not found");let l=crypto.randomUUID(),i=Date.now(),a={...o,id:l,createdAt:i,lastModified:i,title:o.title+" (Copy)",messages:null!==(t=o.messages)&&void 0!==t?t:[],settings:null!==(n=o.settings)&&void 0!==n?n:{model:"",temperature:1,systemPrompt:""},totalTokens:null!==(r=o.totalTokens)&&void 0!==r?r:0};return await eF(a),l}),(0,l.XM)({clock:e_,target:eZ}),(0,l.XM)({clock:eZ.doneData,target:eB}),(0,l.XM)({clock:eZ.doneData,target:eY});let eV=eW.effect("loadSpecificChatFx",{handler:eE}),eJ=eW.effect("saveChatFx",{handler:eF}),eQ=eW.effect("deleteChatFx",{handler:eP}),e0=eW.effect("editChatTitleFx",{handler:ez}),e1=eW.effect("generateTitleFx",{handler:eX}),e2=eW.effect("regenerateTitleForChatFx");e2.use(async e=>{let t=b.getState();if(!t)throw Error("API key is missing");let n=await eE(e);if(!n)throw Error("Chat not found");if(!n.messages||0===n.messages.length)return;let r=await eX({chatId:e,messages:n.messages,apiKey:t,modelId:P.getState()});r.generatedTitle&&await ez({id:e,newTitle:r.generatedTitle})}),(0,l.XM)({clock:eK,target:e2}),(0,l.XM)({clock:e2.done,target:eY});let e3=eW.store([],{name:"$chatHistoryIndex"}),e6=eW.store(null,{name:"$currentChatSession"}),e5=e6.map(e=>{var t;return null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null}),e4=eY.pending,e8=eJ.pending,e9=eV.pending;e6.reset(e$);let e7=e=>null!==e;(0,l.XM)({clock:eY.doneData,fn:e=>e,target:e3}),(0,l.XM)({clock:eQ.done,source:e3,fn:(e,t)=>{let{params:n}=t;return e.filter(e=>e.id!==n)},target:e3}),(0,l.XM)({clock:eJ.done,source:e3,fn:(e,t)=>{let{params:n}=t;return eO(e,n)},target:e3}),(0,l.XM)({source:e6.updates,filter:e=>null!==e&&2===e.messages.length&&(/^\d{1,2}\/\d{1,2}\/\d{4}/.test(e.title)||""===e.title.trim()),target:eK.prepend(e=>e.id)}),(0,l.XM)({clock:e0.doneData,source:e3,filter:(e,t)=>!!t,fn:(e,t)=>eR(e,t),target:e3}),(0,l.XM)({clock:eV.doneData,fn:e=>e,target:e6}),(0,l.XM)({clock:eV.doneData,fn:e=>{var t;return null!==(t=null==e?void 0:e.draft)&&void 0!==t?t:""},target:ef}),(0,l.XM)({clock:eJ.done,fn:e=>{let{params:t}=e;return t},target:e6}),(0,l.XM)({clock:e0.doneData,source:e6,filter:(e,t)=>!!e&&!!t&&e.id===t.id,fn:(e,t)=>({...e,title:t.title,lastModified:t.lastModified}),target:e6}),(0,l.XM)({clock:[eU,eN],target:eY}),(0,l.XM)({clock:eB,target:eV}),(0,l.XM)({clock:eG,target:eQ}),(0,l.XM)({clock:eq,target:e0}),(0,l.XM)({clock:eV.doneData,filter:e7,fn:e=>e.messages,target:ev}),(0,l.XM)({clock:eV.doneData,filter:e7,fn:e=>P.getState(),target:P}),(0,l.XM)({clock:eV.doneData,filter:e7,fn:e=>e.settings.temperature,target:k}),(0,l.XM)({clock:eV.doneData,filter:e7,fn:e=>e.settings.systemPrompt,target:M}),(0,l.XM)({clock:eV.doneData,filter:e7,fn:e=>{var t;return null!==(t=e.totalTokens)&&void 0!==t?t:0},target:ej}),(0,l.XM)({clock:e$,fn:()=>[],target:ev});let te=(0,G.s)({source:ef,timeout:1e3});(0,l.XM)({clock:te,source:e6,filter:e=>null!==e,fn:(e,t)=>({...e,draft:t,lastModified:Date.now()}),target:e6}),(0,l.XM)({clock:e6,filter:e=>null!==e,target:eJ}),(0,l.XM)({clock:e$,fn:()=>0,target:ej}),(0,l.XM)({clock:[en,ec,Q,ee,ed],source:{currentSession:e6,messages:ev,model:P,temperature:k,systemPrompt:M,tokens:ej,draft:ef,selectedModelInfo:F.map(e=>{var t;return null!==(t=e.find(e=>e.id===P.getState()))&&void 0!==t?t:null})},filter:e=>{let{messages:t}=e;return t.length>0},fn:e=>(console.log("[saveChatFx Trigger] Fired. Source Messages Length:",e.messages.length),e.messages.length>0&&console.log("[saveChatFx Trigger] Last Message ID:",e.messages[e.messages.length-1].id),eL(e)),target:eJ}),(0,l.XM)({clock:eJ.done,source:b,filter:(e,t)=>{let{params:n}=t;return!!e&&n.messages.length>0&&!n.title},fn:(e,t)=>{let{params:n}=t;return{chatId:n.id,messages:n.messages,apiKey:e,modelId:R.getState()}},target:e1}),(0,l.XM)({clock:e1.doneData,filter:e=>{let{generatedTitle:t}=e;return!!t},fn:e=>{let{chatId:t,generatedTitle:n}=e;return{id:t,newTitle:n}},target:e0}),(0,l.XM)({clock:eH,source:{apiKey:b,currentChat:e6},filter:e=>{let{apiKey:t,currentChat:n}=e;return!!t&&!!n&&n.messages.length>0},fn:e=>{let{apiKey:t,currentChat:n}=e;return{chatId:n.id,messages:n.messages,apiKey:t,modelId:R.getState()}},target:e1}),e1.fail.watch(e=>{let{error:t,params:n}=e;console.error("Failed to generate title for chat ".concat(n.chatId,":"),t)}),eJ.done.watch(()=>{console.log("Effect: saveChatFx done (Debug)")}),eJ.fail.watch(e=>{console.error("Effect: saveChatFx failed (Debug)",e)}),(0,a.Y)(e3,e6,e5,e4,e8,e9,eU,eN,eB,eG,e$,eq,eH,e_,eK,eY,eV,eJ,eQ,e0,e1,eZ),(0,l.XM)({clock:N,source:{chat:e6,models:F},filter:e=>{let{chat:t}=e;return null!==t},fn:(e,t)=>{var n,r,o;let{chat:l,models:i}=e,a=i.find(e=>e.id===t);return a?{...l,lastModified:Date.now(),settings:{...l.settings,model:{pricing:{prompt:Number(null===(n=a.pricing)||void 0===n?void 0:n.prompt)||0,completion:Number(null===(r=a.pricing)||void 0===r?void 0:r.completion)||0},context_length:null!==(o=a.context_length)&&void 0!==o?o:1e6}}}:l},target:e6}),(0,l.XM)({clock:e6.updates,filter:e=>null!==e,target:eJ});let tt="miniChatModelId_v1",tn=(0,l.lh)();(0,l.lh)();let tr=(0,l.y$)("openai/gpt-3.5-turbo"),to=(0,l.EH)(()=>localStorage.getItem(tt)),tl=(0,l.EH)(e=>{localStorage.setItem(tt,e)});(0,l.XM)({clock:eU,target:to}),(0,l.XM)({clock:to.doneData,filter:e=>null!==e,target:tr}),tr.on(tn,(e,t)=>t),(0,l.XM)({clock:tr.updates,target:tl});let ti=(0,l.lh)(),ta=(0,l.lh)(),ts=(0,l.y$)({visible:!1,x:0,y:0,selectionText:""}).on(ti,(e,t)=>({visible:!0,...t})).on(ta,e=>({...e,visible:!1,selectionText:""})),td=(0,l.lh)(),tc=(0,l.lh)(),tu=(0,l.lh)(),tp=(0,l.lh)(),tg=(0,l.lh)(),tm=(0,l.lh)(),th=(0,l.lh)(),tx=(0,l.y$)({isOpen:!1,isCompact:!1,input:"",messages:[],loading:!1}).on(td,(e,t)=>{let{initialInput:n,startCompact:r}=t;return{isOpen:!0,isCompact:!!r,input:null!=n?n:"",messages:e.isOpen?e.messages:[],loading:!1}}).on(tc,()=>({isOpen:!1,isCompact:!1,input:"",messages:[],loading:!1})).on(tu,(e,t)=>({...e,input:t})).on(tp,(e,t)=>({...e,isCompact:!1,input:"",messages:[...e.messages,{role:"user",content:t}],loading:!0})).on(tg,(e,t)=>({...e,isCompact:!1,messages:[...e.messages,{role:"assistant",content:t}],loading:!1})).reset(th),tf=(0,l.EH)();tf.use(async e=>{let{message:t,model:n,apiKey:r}=e;return g({message:t,model:n,apiKey:r})}),(0,l.XM)({clock:tp,source:{apiKey:b,model:tr},fn:(e,t)=>{let{apiKey:n,model:r}=e;return{message:t,model:r,apiKey:n}},target:tf}),(0,l.XM)({clock:tf.doneData,target:tg});let tv=(0,l.EH)();tv.use(async()=>{let e=tx.getState();if(!e.messages.length)return;let t=crypto.randomUUID(),n=Date.now(),r={id:t,createdAt:n,lastModified:n,title:"",messages:e.messages.map(e=>({id:crypto.randomUUID(),timestamp:Date.now(),role:e.role,content:e.content})),settings:(()=>{var e,t,n;let r=tr.getState(),o=F.getState().find(e=>e.id===r);return{model:{pricing:{prompt:Number(null==o?void 0:null===(e=o.pricing)||void 0===e?void 0:e.prompt)||0,completion:Number(null==o?void 0:null===(t=o.pricing)||void 0===t?void 0:t.completion)||0},context_length:null!==(n=null==o?void 0:o.context_length)&&void 0!==n?n:1e6},temperature:k.getState(),systemPrompt:M.getState()}})(),totalTokens:0,draft:""};await eJ(r),th(),ta()}),(0,l.XM)({clock:tm,target:tv});var ty=n(18407),tj=n(71803),tA=n(68534),tw=n(2123);let tb=()=>{let e=(0,tw.e3)(ts),t=(0,tw.e3)(tx);return e.visible?(0,r.jsx)(ty.A,{elevation:4,sx:{position:"absolute",top:e.y+8,left:e.x-40,zIndex:9999},children:(0,r.jsxs)(tj.A,{direction:"column",spacing:1,padding:1,children:[(0,r.jsx)(tA.A,{size:"small",variant:"contained",onClick:()=>{t.isOpen?tu("> ".concat(e.selectionText,"\n\n")+t.input):td({initialInput:"> ".concat(e.selectionText,"\n\n"),startCompact:!0}),ta()},children:"Ask"}),(0,r.jsx)(tA.A,{size:"small",variant:"contained",color:"secondary",onClick:()=>{let n="Please explain this to me: ".concat(e.selectionText);t.isOpen||td({initialInput:""}),tp(n),ta()},children:"Explain"})]})}):null};var tk=n(5939),tM=n.n(tk),tC=n(700),tS=n(3127),tI=n(49540),tD=n(69242),tT=n(68004),tE=n(77262),tF=n(60440);let tP=()=>{let{isOpen:e,isCompact:t,messages:n,loading:l,input:i}=(0,tw.e3)(tx),a=o.useRef(null);return e?(0,r.jsx)(tM(),{handle:".drag-handle",nodeRef:a,children:(0,r.jsxs)(ty.A,{ref:a,elevation:6,style:{position:"fixed",top:"30%",left:"40%",width:300,maxHeight:400,overflow:"auto",zIndex:9999,display:"flex",flexDirection:"column"},children:[(0,r.jsxs)(tj.A,{direction:"row",justifyContent:"space-between",alignItems:"center",className:"drag-handle",sx:{cursor:"move",p:.5,pl:1.3,borderBottom:1,borderColor:"divider"},children:[(0,r.jsx)(tC.A,{variant:"subtitle1",children:"Mini chat"}),(0,r.jsxs)(tj.A,{direction:"row",spacing:1,children:[!t&&(0,r.jsx)(tS.A,{size:"small",onClick:()=>tm(),children:(0,r.jsx)(tT.A,{fontSize:"small"})}),(0,r.jsx)(tS.A,{size:"small",onClick:()=>tc(),children:(0,r.jsx)(tD.A,{fontSize:"small"})})]})]}),!t&&(0,r.jsxs)(tj.A,{spacing:1,sx:{p:1,pb:.2,flexGrow:1,overflowY:"auto"},children:[n.map((e,t)=>(0,r.jsx)(ty.A,{sx:{p:1,minWidth:"30%",bgcolor:"user"===e.role?"primary.dark":"secondary.dark"},children:(0,r.jsx)(tC.A,{variant:"body2",children:e.content})},t)),l&&(0,r.jsx)(tE.A,{sx:{borderRadius:8}})]}),(0,r.jsx)(tj.A,{direction:"row",spacing:1,sx:{p:1},children:(0,r.jsx)(tI.A,{size:"small",placeholder:"Type a message...",fullWidth:!0,multiline:!0,value:i,onChange:e=>tu(e.target.value),sx:{"& .MuiOutlinedInput-root":{p:.6,pr:1},"& textarea":{pl:1}},slotProps:{input:{style:{marginLeft:1.5},endAdornment:(0,r.jsx)(tS.A,{"aria-label":"send",size:"small",edge:"end",disabled:!i.trim()||l,onClick:()=>{i.trim()&&tp(i.trim())},children:(0,r.jsx)(tF.A,{fontSize:"small"})})}}})})]})}):null};var tz=n(65997),tX=n(74964),tO=n(54581);async function tR(){var e,t,n,r;if(null===(t=navigator)||void 0===t?void 0:null===(e=t.storage)||void 0===e?void 0:e.estimate){let e=await navigator.storage.estimate();return{quota:null!==(n=e.quota)&&void 0!==n?n:0,usage:null!==(r=e.usage)&&void 0!==r?r:0}}return{quota:0,usage:0}}let tL=(0,l.lh)(),tU=(0,l.y$)({tokensSent:0,tokensReceived:0,contextTokensUsed:0,contextTokensMax:1e6,apiCost:0,chatSizeMB:0,dbSizeMB:0,quotaMB:0,totalUsageMB:0,chatId:null}),tW=tU.map(e=>e.contextTokensMax>0?e.contextTokensUsed/e.contextTokensMax*100:0),tN=(0,l.EH)(async()=>{let{quota:e,usage:t}=await tR();return{quotaMB:e/1048576,dbSizeMB:t/1048576,totalUsageMB:t/1048576,chatSizeMB:0}}),tB=(0,l.EH)(async e=>{var t,n,r,o,l,i;let{chatSession:a,totalTokens:s}=e,d=null!==(l=null==a?void 0:null===(n=a.settings)||void 0===n?void 0:null===(t=n.model)||void 0===t?void 0:t.context_length)&&void 0!==l?l:1e6,c=function(e,t,n){var r,o;return n?+(e/1e6*(null!==(r=n.prompt)&&void 0!==r?r:0)+0*(null!==(o=n.completion)&&void 0!==o?o:0)).toFixed(6):0}(s,0,null==a?void 0:null===(o=a.settings)||void 0===o?void 0:null===(r=o.model)||void 0===r?void 0:r.pricing);return{tokensSent:s,tokensReceived:0,contextTokensUsed:s,contextTokensMax:d,apiCost:c,chatId:null!==(i=null==a?void 0:a.id)&&void 0!==i?i:null}});(0,l.XM)({clock:tL,target:tN}),(0,l.XM)({clock:[tL,e6.updates,ej.updates],source:(0,l.kg)({chatSession:e6,totalTokens:ej}),target:tB}),(0,l.XM)({clock:[tN.doneData,tB.doneData],source:tU,fn:(e,t)=>({...e,...t}),target:tU});let tG=()=>{var e;let t=(0,tw.e3)(tU),n=(0,tw.e3)(tW);return(0,r.jsxs)(tj.A,{spacing:2,children:[(0,r.jsx)(tX.A,{children:"Chat"}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Chat ID:"})," ",null!==(e=t.chatId)&&void 0!==e?e:"N/A"]}),(0,r.jsx)(tX.A,{children:"Tokens"}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Sent:"})," ",t.tokensSent.toLocaleString()]}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Received:"})," ",t.tokensReceived.toLocaleString()]}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Total:"})," ",(t.tokensSent+t.tokensReceived).toLocaleString()]}),(0,r.jsx)(tX.A,{children:"Context Window"}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Used:"})," ",t.contextTokensUsed.toLocaleString()]}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Max:"})," ",t.contextTokensMax.toLocaleString()]}),(0,r.jsx)(tO.A,{children:(0,r.jsx)(tE.A,{variant:"determinate",color:"success",value:Math.min(n,100),sx:{height:8,borderRadius:4,mt:1}})}),(0,r.jsx)(tX.A,{children:"API Cost"}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Estimated Cost:"})," $",t.apiCost.toFixed(6)]}),(0,r.jsx)(tX.A,{children:"Storage"}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Chat Size:"})," ",t.chatSizeMB.toFixed(2)," MB"]}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Total DB:"})," ",t.dbSizeMB.toFixed(2)," MB"]}),(0,r.jsxs)(tC.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Quota:"})," ",t.quotaMB.toFixed(2)," MB"]})]})};var t$=n(56278),tq=n(54492),tH=n(99927);let t_=e=>{let{open:t,onClose:n}=e;return(0,tw.e3)(tU),(0,tw.e3)(tW),(0,r.jsxs)(t$.A,{open:t,onClose:n,maxWidth:"xs",fullWidth:!0,children:[(0,r.jsxs)(tq.A,{children:["Usage Info",(0,r.jsx)(tS.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,r.jsx)(tD.A,{})})]}),(0,r.jsx)(tH.A,{children:(0,r.jsx)(tG,{})})]})};var tK=n(16324),tY=n(27943),tZ=n(35726),tV=n(18987),tJ=n(29267),tQ=n(18096);let t0=(0,l.$5)("ui"),t1=t0.event("showApiKeyDialog"),t2=t0.event("hideApiKeyDialog"),t3=t0.event("openSettingsDrawer"),t6=t0.event("closeSettingsDrawer"),t5=t0.event("toggleSettingsDrawer"),t4=t0.event("openModelInfoDrawer"),t8=t0.event("closeModelInfoDrawer"),t9=t0.event("openHistoryDrawer"),t7=t0.event("closeHistoryDrawer"),ne=t0.event("toggleHistoryDrawer"),nt=t0.event("openMobileDrawer"),nn=t0.event("closeMobileDrawer"),nr=t0.event("setMobileDrawerTab"),no=t0.event("startEditingMessage"),nl=t0.event("stopEditingMessage"),ni=t0.event("openModelInfoAlert"),na=t0.event("closeModelInfoAlert"),ns=t0.effect({name:"loadUiSettingsFx",handler:async()=>{try{let e="true"===localStorage.getItem("ui_historyDrawerOpen"),t="true"===localStorage.getItem("ui_settingsDrawerOpen");return{historyOpen:e,settingsOpen:t}}catch(e){return console.error("Failed to load UI settings from localStorage:",e),{historyOpen:!1,settingsOpen:!1}}}}),nd=t0.effect({name:"saveHistoryDrawerStateFx",handler:async e=>{try{localStorage.setItem("ui_historyDrawerOpen",String(e))}catch(e){console.error("Failed to save history drawer state to localStorage:",e)}}}),nc=t0.effect({name:"saveSettingsDrawerStateFx",handler:async e=>{try{localStorage.setItem("ui_settingsDrawerOpen",String(e))}catch(e){console.error("Failed to save settings drawer state to localStorage:",e)}}}),nu=t0.store(!1,{name:"$isHistoryDrawerPersistentOpen"}),np=t0.store(!1,{name:"$isSettingsDrawerPersistentOpen"}),ng=t0.store(!1).on(t1,()=>!0).on(t2,()=>!1),nm=t0.store(!1,{name:"isSettingsDrawerOpen"}).on(t3,()=>!0).on(t6,()=>!1),nh=t0.store(!1,{name:"isHistoryDrawerOpen"}).on(t9,()=>!0).on(t7,()=>!1).on(ne,e=>!e),nx=t0.store(!1,{name:"$isModelInfoDrawerOpen"}).on(t4,()=>!0).on(t8,()=>!1),nf=t0.store(!1,{name:"$isModelInfoDrawerOpen"}).on(ni,()=>!0).on(na,()=>!1),nv=t0.store(!1,{name:"isMobileDrawerOpen"}).on(nt,()=>!0).on(nn,()=>!1),ny=t0.store("history",{name:"mobileDrawerTab"}).on(nt,(e,t)=>t.tab).on(nr,(e,t)=>t).reset(nn),nj=t0.store(null,{name:"$editingMessageId"}).on(no,(e,t)=>t).reset(nl);nu.on(ne,e=>!e).on(t9,()=>!0).on(t7,()=>!1).on(ns.doneData,(e,t)=>t.historyOpen),np.on(t5,e=>!e).on(t3,()=>!0).on(t6,()=>!1).on(ns.doneData,(e,t)=>t.settingsOpen),nj.reset(eB,e$),(0,l.XM)({clock:eU,target:ns}),(0,l.XM)({clock:nu.updates,filter:ns.pending.map(e=>!e),target:nd}),(0,l.XM)({clock:np.updates,filter:ns.pending.map(e=>!e),target:nc}),(0,l.XM)({clock:[eU,er],source:b,filter:e=>"string"==typeof e&&0===e.trim().length,target:t1}),(0,l.XM)({clock:b,source:ng,filter:(e,t)=>e&&"string"==typeof t&&t.trim().length>0,target:t2}),(0,a.Y)(ng,nm,nh,nu,np,nx,nv,ny,nj,t1,t2,t3,t6,t5,t9,t7,ne,t4,t8,nt,nn,nr,no,nl,ns,nd,nc);var nA=n(30529),nw=n(33989),nb=n(14426),nk=n(63148),nM=n(65528),nC=n(22376),nS=n(85222),nI=n(21963),nD=n(76380),nT=n(39489),nE=n(6742),nF=n(25249),nP=n(63954),nz=n(28890),nX=n(19505),nO=n(95206),nR=n(69008),nL=n(62170),nU=n(37857);let nW=e=>{let{searchTerm:t,setSearchTerm:n,isLoading:l,filteredHistory:i,editingId:a,editedTitle:s,currentChatId:d,setEditedTitle:c,handleStartEdit:u,handleSaveEdit:p,handleCancelEdit:g,handleDeleteChat:m,handleSelectChat:h}=e,[x,f]=(0,o.useState)(null),[v,y]=(0,o.useState)(null),[j,A]=(0,o.useState)(""),w=(0,tK.A)(),b=(0,tY.A)(w.breakpoints.down("sm")),k=(0,tw.e3)(nv),M=(e,t,n)=>{e.stopPropagation(),f(e.currentTarget),y(t),A(n)},C=()=>{f(null),y(null),A("")};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(tO.A,{sx:{width:{xs:"100%",sm:360,md:400},maxWidth:"100%",flexGrow:1,display:"flex",flexDirection:"column",height:"100%"},role:"presentation",children:[!k&&(0,r.jsxs)(nA.A,{disableGutters:!0,variant:"dense",sx:{display:"flex",alignItems:"center",justifyContent:"start",pl:2,pr:1,borderBottom:1,borderColor:"divider"},children:[(0,r.jsx)(tC.A,{variant:"h6",sx:{flexGrow:1},children:"Chat History"}),!b&&(0,r.jsx)(tS.A,{"aria-label":"New chat",onClick:()=>e$(),children:(0,r.jsx)(nF.A,{})}),!b&&(0,r.jsx)(tS.A,{onClick:()=>t7(),"aria-label":"close history drawer",children:(0,r.jsx)(nE.A,{})})]}),(0,r.jsx)(tO.A,{sx:{p:2},children:(0,r.jsx)(tI.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Search chats...",value:t,onChange:e=>n(e.target.value),InputProps:{startAdornment:(0,r.jsx)(nw.A,{position:"start",children:(0,r.jsx)(nP.A,{fontSize:"small"})})}})}),(0,r.jsx)(tX.A,{}),(0,r.jsx)(tO.A,{sx:{flexGrow:1,overflowY:"auto"},children:l?(0,r.jsx)(tO.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,r.jsx)(nb.A,{})}):(0,r.jsxs)(nk.A,{disablePadding:!0,children:[0===i.length&&!l&&(0,r.jsx)(tC.A,{sx:{p:2,textAlign:"center",color:"text.secondary"},children:t?"No matching chats found.":"No chat history yet."}),i.map(e=>(0,r.jsx)(nM.Ay,{disablePadding:!0,secondaryAction:(0,r.jsx)(r.Fragment,{children:a===e.id?(0,r.jsx)(tS.A,{edge:"end",size:"small","aria-label":"save",onClick:t=>{t.stopPropagation(),p(e.id)},children:(0,r.jsx)(nO.A,{fontSize:"medium"})}):(0,r.jsx)(tS.A,{edge:"end","aria-label":"more",onClick:t=>M(t,e.id,e.title),children:(0,r.jsx)(nR.A,{fontSize:"medium"})})}),children:(0,r.jsx)(nC.A,{onClick:()=>h(e.id),selected:e.id===d,children:a===e.id?(0,r.jsx)(tO.A,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:(0,r.jsx)(tI.A,{size:"small",value:s,onChange:e=>c(e.target.value),onClick:e=>e.stopPropagation(),onKeyDown:t=>{"Enter"===t.key?(t.preventDefault(),p(e.id)):"Escape"===t.key&&(t.preventDefault(),g())},onBlur:()=>p(e.id),autoFocus:!0,fullWidth:!0,variant:"standard"})}):(0,r.jsx)(nS.A,{primary:e.title,secondary:new Date(e.lastModified).toLocaleString(),primaryTypographyProps:{noWrap:!0,sx:{maxWidth:265,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:e.id===d?"bold":"normal"}},secondaryTypographyProps:{noWrap:!0,fontSize:"0.75rem"}})})},e.id))]})})]}),(0,r.jsxs)(nI.A,{anchorEl:x,open:!!x,onClose:C,onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)(nD.A,{onClick:e=>{e.stopPropagation(),C(),v&&setTimeout(()=>{u(v,j,e)},0)},children:[(0,r.jsx)(nT.A,{children:(0,r.jsx)(nz.A,{fontSize:"small"})}),(0,r.jsx)(nS.A,{primary:"Rename"})]}),(0,r.jsxs)(nD.A,{onClick:()=>{v&&e_(v),C()},children:[(0,r.jsx)(nT.A,{children:(0,r.jsx)(nL.A,{fontSize:"small"})}),(0,r.jsx)(nS.A,{primary:"Duplicate"})]}),(0,r.jsxs)(nD.A,{onClick:()=>{v&&eK(v),C()},children:[(0,r.jsx)(nT.A,{children:(0,r.jsx)(nU.A,{fontSize:"small"})}),(0,r.jsx)(nS.A,{primary:"Regenerate Title"})]}),(0,r.jsxs)(nD.A,{onClick:e=>{e.stopPropagation(),v&&m(v,e),C()},sx:{color:"error.main"},children:[(0,r.jsx)(nT.A,{sx:{color:"error.main"},children:(0,r.jsx)(nX.A,{fontSize:"small"})}),(0,r.jsx)(nS.A,{primary:"Delete"})]})]})]})};var nN=n(11698);let nB=()=>{let[e,t]=(0,o.useState)(!1),n=(0,tw.e3)(F),l=(0,tw.e3)(z),i=(0,tw.e3)(tr),a=(0,tw.e3)(X),s=o.useMemo(()=>{var e;return null!==(e=n.find(e=>e.id===i))&&void 0!==e?e:null},[n,i]),d=o.useMemo(()=>{let e=n;return a&&(e=e.filter(e=>{var t,n;return(null===(t=e.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=e.pricing)||void 0===n?void 0:n.completion)==="0"})),e},[n,a]);return(0,r.jsx)(tO.A,{sx:{my:1},children:(0,r.jsx)(nN.A,{id:"mini-chat-model-selector",sx:{width:"100%"},open:e,onOpen:()=>{t(!0),0===n.length&&W()},onClose:()=>{t(!1)},value:s,onChange:(e,t)=>{t&&tn(t.id)},isOptionEqualToValue:(e,t)=>e.id===t.id,getOptionLabel:e=>e.name||e.id,options:d,loading:l,renderInput:e=>(0,r.jsx)(tI.A,{...e,label:"Mini-Chat Model",variant:"outlined",size:"small",InputProps:{...e.InputProps,endAdornment:(0,r.jsxs)(o.Fragment,{children:[l?(0,r.jsx)(nb.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})}}),renderOption:(e,t)=>(0,o.createElement)(tO.A,{component:"li",...e,key:t.id},t.name||t.id)})})};var nG=n(83729),n$=n(82330),nq=n(4915),nH=n(82449),n_=n(11247),nK=n(58674),nY=n(81787);let nZ=e=>{let{apiKey:t,showApiKey:n,temperature:l,systemPrompt:i,currentChatTokens:a,handleApiKeyChange:s,handleSystemPromptChange:d,handleTemperatureChange:c,handleClickShowApiKey:u,handleMouseDownApiKey:p}=e,g=(0,tw.e3)(X),m=(0,tw.e3)(nv),[h,x]=(0,tw.e3)([R,F]),f=o.useMemo(()=>{var e;return null!==(e=x.find(e=>e.id===h))&&void 0!==e?e:null},[x,h]);return(0,r.jsxs)(tO.A,{sx:{width:{xs:"100%",sm:360,md:400},maxWidth:"100%",flexGrow:1,display:"flex",flexDirection:"column",height:"100%"},children:[!m&&(0,r.jsxs)(nA.A,{disableGutters:!0,variant:"dense",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2},children:[(0,r.jsx)(tC.A,{variant:"h6",children:"Chat Settings"}),(0,r.jsx)(tS.A,{onClick:()=>t6(),"aria-label":"close settings drawer",edge:"end",children:(0,r.jsx)(n_.A,{})})]}),(0,r.jsx)(tX.A,{}),(0,r.jsx)(tO.A,{sx:{p:2},children:(0,r.jsx)(nG.A,{title:"Your OpenRouter API Key. Stored locally in your browser.",placement:"left",children:(0,r.jsx)(tI.A,{size:"small",fullWidth:!0,label:"OpenRouter API Key",variant:"outlined",type:n?"text":"password",value:t,onChange:e=>s(e.target.value),InputProps:{endAdornment:(0,r.jsx)(nw.A,{position:"end",children:(0,r.jsx)(tS.A,{"aria-label":"toggle api key visibility",onClick:u,onMouseDown:p,edge:"end",size:"small",children:n?(0,r.jsx)(nY.A,{}):(0,r.jsx)(nK.A,{})})})}})})}),(0,r.jsxs)(tO.A,{sx:{px:2},children:[(0,r.jsxs)(tC.A,{gutterBottom:!0,children:["Temperature: ",l.toFixed(1)]}),(0,r.jsx)(nG.A,{title:"Controls randomness. Lower values are more deterministic.",placement:"left",children:(0,r.jsx)(n$.Ay,{value:l,onChange:(e,t)=>"number"==typeof t&&c(t),"aria-labelledby":"temperature-slider",step:.1,marks:!0,min:0,max:2})})]}),(0,r.jsx)(tO.A,{sx:{px:2,py:1},children:(0,r.jsx)(nq.A,{control:(0,r.jsx)(nH.A,{checked:g,onChange:e=>O(e.target.checked),color:"primary"}),label:"Show only free models"})}),(0,r.jsx)(tO.A,{sx:{px:2,py:1},children:(0,r.jsx)(nB,{})}),(0,r.jsx)(tO.A,{sx:{px:2,pb:2,pt:1},children:(0,r.jsx)(nN.A,{size:"small",options:x,groupBy:e=>e.created?new Date(1e3*e.created).toLocaleString("default",{month:"long",year:"numeric"}):"Unknown",getOptionLabel:e=>e.name.replace(/^[^:]+:\s*/,"")||e.id,value:f,onChange:(e,t)=>{t&&L(t.id)},renderInput:e=>(0,r.jsx)(tI.A,{...e,label:"AutoTitle Model",variant:"outlined",fullWidth:!0}),isOptionEqualToValue:(e,t)=>e.id===t.id})}),(0,r.jsx)(tX.A,{}),(0,r.jsxs)(tO.A,{sx:{px:2,py:1,flexGrow:1,display:"flex",flexDirection:"column"},children:[(0,r.jsx)(tC.A,{variant:"overline",gutterBottom:!0,children:"System Prompt"}),(0,r.jsx)(tI.A,{fullWidth:!0,variant:"outlined",multiline:!0,value:i,onChange:e=>d(e.target.value),sx:{"& .MuiInputBase-input":{resize:"vertical"}},InputProps:{sx:{height:"100%"}}})]})]})};var nV=n(94980);let nJ=e=>{var t,n,o,l;let{model:i}=e,a=(0,tw.e3)(nv),s=(null===(t=i.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=i.pricing)||void 0===n?void 0:n.completion)==="0",d=i.created?new Date(1e3*i.created).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"",c=(null===(o=i.pricing)||void 0===o?void 0:o.prompt)?(1e6*parseFloat(i.pricing.prompt)).toFixed(2):"0",u=(null===(l=i.pricing)||void 0===l?void 0:l.completion)?(1e6*parseFloat(i.pricing.completion)).toFixed(2):"0";return(0,r.jsxs)(tO.A,{children:[!a&&(0,r.jsx)(nA.A,{variant:"dense",disableGutters:!0,children:(0,r.jsx)(tC.A,{variant:"h6",fontWeight:"bold",children:"Model Info"})}),(0,r.jsxs)(tO.A,{padding:2,children:[(0,r.jsxs)(tj.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(tC.A,{variant:"h6",fontWeight:"bold",children:i.name}),s&&(0,r.jsx)(nG.A,{title:"Free model",children:(0,r.jsx)(nV.A,{fontSize:"small"})})]}),(0,r.jsxs)(tj.A,{direction:"row",alignItems:"center",spacing:1,mt:1,children:[(0,r.jsx)(tC.A,{variant:"body2",fontFamily:"monospace",children:i.id}),(0,r.jsx)(nG.A,{title:"Copy model ID",children:(0,r.jsx)(tS.A,{size:"small",onClick:()=>{navigator.clipboard.writeText(i.id)},children:(0,r.jsx)(nL.A,{fontSize:"small"})})})]}),(0,r.jsx)(tX.A,{sx:{my:2}}),(0,r.jsxs)(tj.A,{spacing:1,flexWrap:"wrap",children:[(0,r.jsxs)(tj.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(tC.A,{variant:"body2",color:"text.secondary",children:["Created ",d]}),(0,r.jsxs)(tC.A,{variant:"body2",color:"text.secondary",children:[i.context_length.toLocaleString()," context"]})]}),(0,r.jsxs)(tj.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(tC.A,{variant:"body2",color:"text.secondary",children:["$",c,"/M input tokens"]}),(0,r.jsxs)(tC.A,{variant:"body2",color:"text.secondary",children:["$",u,"/M output tokens"]})]})]}),(0,r.jsx)(tX.A,{sx:{my:2}}),(0,r.jsx)(tC.A,{variant:"body2",color:"text.primary",whiteSpace:"pre-line",children:i.description})]})]})},nQ=e=>{let{historyPanelProps:t,settingsPanelProps:n,modelInfo:o}=e,[l,i]=(0,tw.e3)([nv,ny]),a=(0,tw.e3)(nn),s=(0,tw.e3)(nr);return(0,r.jsx)(tV.Ay,{anchor:"bottom",open:l,onClose:a,ModalProps:{keepMounted:!0},children:(0,r.jsxs)(tO.A,{sx:{display:"flex",flexDirection:"column",height:"80vh",maxHeight:"90vh"},children:[(0,r.jsxs)(tJ.A,{value:i,onChange:(e,t)=>s(t),variant:"fullWidth",indicatorColor:"secondary",textColor:"inherit",sx:{backgroundColor:"background.paper"},children:[(0,r.jsx)(tQ.A,{sx:{fontWeight:"history"===i?"bold":"normal"},value:"history",label:"History"}),(0,r.jsx)(tQ.A,{sx:{fontWeight:"modelInfo"===i?"bold":"normal"},value:"modelInfo",label:"Model"}),(0,r.jsx)(tQ.A,{sx:{fontWeight:"settings"===i?"bold":"normal"},value:"settings",label:"Settings"}),(0,r.jsx)(tQ.A,{sx:{fontWeight:"usage"===i?"bold":"normal"},value:"usage",label:"Usage"})]}),(0,r.jsx)(tX.A,{}),(0,r.jsxs)(tO.A,{sx:{flexGrow:1,overflow:"auto"},children:["history"===i&&(0,r.jsx)(nW,{...t}),"settings"===i&&(0,r.jsx)(nZ,{...n}),"modelInfo"===i&&o&&(0,r.jsx)(nJ,{model:o}),"usage"===i&&(0,r.jsx)(tO.A,{p:2,children:(0,r.jsx)(tG,{})})]})]})})};var n0=n(71169),n1=n(67217),n2=n(20904),n3=n(3337),n6=n(9665),n5=n(28005),n4=n(41218),n8=n(13368),n9=n(6295),n7=n(8494),re=n(33290),rt=n(80744),rn=n(29652),rr=n(4075),ro=n(31050),rl=n(59011);let ri=e=>{let{content:t}=e;return(0,r.jsx)(re.oz,{children:t,remarkPlugins:[rt.A,rn.A],rehypePlugins:[rr.A],components:{code(e){let{node:t,inline:n,className:o,children:l,style:i,ref:a,...s}=e,d=/language-(\w+)/.exec(o||""),c=String(l).replace(/\n$/,"");return d&&"mermaid"===d[1]?(0,r.jsxs)("div",{style:{marginTop:"8px",marginBottom:"8px"},children:[" ",(0,r.jsx)(ro.d,{children:c})]}):!n&&d?(0,r.jsx)(rl.f4,{code:c,language:d[1],theme:rl.Zj.vsDark,children:e=>{let{className:t,style:n,tokens:o,getLineProps:l,getTokenProps:i}=e;return(0,r.jsx)("pre",{className:t,style:{...n,padding:"12px",borderRadius:"6px",overflowX:"auto"},children:o.map((e,t)=>(0,r.jsx)("div",{...l({line:e}),children:e.map((e,t)=>(0,r.jsx)("span",{...i({token:e})},t))},t))})}}):(0,r.jsx)("code",{className:o,...s,style:{backgroundColor:"rgba(128, 128, 128, 0.15)",padding:"0.1em 0.3em",borderRadius:"4px",fontFamily:"monospace",fontSize:"0.9em"},children:l})}}})},ra=(e,t)=>{let{visibleDelay:n}=e;return()=>{let e=t();requestAnimationFrame(()=>setTimeout(()=>requestAnimationFrame(()=>e()),n))}},rs=e=>{let{message:t}=e,n=(0,tK.A)(),l=(0,tw.e3)(ey),i=(0,tw.e3)(ew),a=(0,tw.e3)(nj),[d,c]=(0,o.useState)(!1),[u,p]=(0,o.useState)(!1),[g,m]=(0,o.useState)(!1),[h,x]=(0,o.useState)(!1),[f,v]=(0,o.useState)(t.content),[y,j]=(0,o.useState)(""),A=(0,o.useRef)(null),w=l&&i===t.id,b=a===t.id,k=null===a,M=()=>{h||null!==a||(j(t.content),no(t.id),x(!0))},C=()=>{x(!1),v(y),nl(),requestAnimationFrame(()=>ea(!1))},S=()=>{f!==y&&Q({messageId:t.id,newContent:f}),x(!1),nl(),requestAnimationFrame(()=>ea(!1))},I=(0,n5.HZ)(ra({visibleDelay:20},()=>(p(!0),()=>{p(!1),ee(t.id)})),{threshold:400})("delete"),D=(0,n5.HZ)(ra({visibleDelay:20},()=>(m(!0),()=>{m(!1),et(t)})),{threshold:400})("retry");return(0,o.useEffect)(()=>{},[h,S]),(0,r.jsx)(ty.A,{className:"chat-message",ref:A,variant:"outlined",id:t.id,onMouseEnter:()=>k&&c(!0),onMouseLeave:()=>k&&c(!1),sx:{borderRadius:2,display:"flex",flexDirection:"column",position:"relative",borderColor:b?n.palette.secondary.light:d&&k?n.palette.primary.light:"transparent",padding:2,transition:n.transitions.create("border-color")},children:(0,r.jsxs)(n4.A,{raised:!0,elevation:1,sx:{p:2,borderRadius:2,alignSelf:"user"===t.role?"flex-end":"flex-start",backgroundColor:"user"===t.role?"primary.dark":n.palette.background.paper,width:h?"-webkit-fill-available":"fit-content",maxWidth:"85%",minWidth:"20%",wordWrap:"break-word"},children:[h?(0,r.jsx)(n8.Ay,{multiline:!0,fullWidth:!0,value:f,onChange:e=>{v(e.target.value)},autoFocus:!0,onKeyDown:e=>{"Escape"===e.key&&C()},sx:{padding:0,borderBottom:0,fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",color:"inherit","& .MuiInputBase-input":{resize:"vertical"}}}):(0,r.jsx)(tC.A,{onDoubleClick:M,component:"div",variant:"body1",sx:{overflowWrap:"break-word",width:"100%"},children:(0,r.jsx)(ri,{content:t.content})}),(w||t.isLoading)&&(0,r.jsx)(nb.A,{size:20,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-10px",marginLeft:"-10px",zIndex:1}}),(0,r.jsx)(ty.A,{elevation:0,sx:{position:"absolute",borderRadius:20,top:-18,right:4,bgcolor:"background.default",p:.25,gap:.5,display:b||d&&k?"flex":"none",opacity:b||d&&k?1:0,transition:n.transitions.create("opacity"),zIndex:2},children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tS.A,{"aria-label":"confirm",color:"success",size:"small",onClick:S,title:"Confirm Edit (Enter)",children:(0,r.jsx)(nO.A,{fontSize:"small"})}),(0,r.jsx)(tS.A,{"aria-label":"cancel",color:"inherit",size:"small",onClick:C,title:"Cancel Edit (Escape)",children:(0,r.jsx)(tD.A,{fontSize:"small"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tS.A,{"aria-label":"copy text",size:"small",color:"inherit",onClick:()=>{"string"==typeof t.content?navigator.clipboard.writeText(t.content).then(()=>console.log("Text copied to clipboard")).catch(e=>console.error("Failed to copy text: ",e)):console.error("Cannot copy non-string content")},title:"Copy Text",children:(0,r.jsx)(nL.A,{fontSize:"small"})}),(0,r.jsx)(tS.A,{"aria-label":"copy code",size:"small",color:"inherit",onClick:()=>{"string"==typeof t.content?navigator.clipboard.writeText(t.content).then(()=>console.log("Code/Markdown copied to clipboard")).catch(e=>console.error("Failed to copy code/markdown: ",e)):console.error("Cannot copy non-string content as code/markdown")},title:"Copy Code/Markdown",children:(0,r.jsx)(n9.A,{fontSize:"small"})}),(0,r.jsx)(tS.A,{"aria-label":"edit",size:"small",onClick:M,color:"inherit",title:"Edit Message (Double-Click)",children:(0,r.jsx)(nz.A,{fontSize:"small"})}),(0,r.jsx)(tS.A,{"aria-label":"delete",size:"small",onClick:()=>{s({message:"Long press to delete a message.",severity:"info"})},title:"Long press to delete",color:u?"error":"inherit",...I,children:(0,r.jsx)(nX.A,{fontSize:"small"})}),(0,r.jsx)(tS.A,{"aria-label":"retry",size:"small",onClick:()=>{s({message:"Long press to regenerate a message.",severity:"info"})},title:"Retry Generation",disabled:l,color:g?"success":"inherit",...D,children:(0,r.jsx)(n7.A,{fontSize:"small"})})]})})]})},t.id)};var rd=n(71977),rc=n(76871),ru=n(60744);let rp=o.forwardRef(function(e,t){return(0,r.jsx)(ru.A,{direction:"up",ref:t,...e})});function rg(e){let t=o.useRef(null);return(0,r.jsx)(tM(),{nodeRef:t,handle:"#draggable-dialog-title",cancel:'[class*="MuiDialogContent-root"]',children:(0,r.jsx)(ty.A,{...e,ref:t})})}function rm(){let[e,t,n]=(0,tw.e3)([ng,t2,t3]);return(0,r.jsxs)(t$.A,{open:e,onClose:t,PaperComponent:rg,TransitionComponent:rp,keepMounted:!0,"aria-labelledby":"draggable-dialog-title","aria-describedby":"alert-dialog-slide-description",children:[(0,r.jsx)(tq.A,{style:{cursor:"move"},id:"draggable-dialog-title",children:"API Key Required"}),(0,r.jsx)(tH.A,{children:(0,r.jsx)(rc.A,{id:"alert-dialog-slide-description",children:"Your OpenRouter API key is missing. Please enter it in Chat Settings to enable sending messages."})}),(0,r.jsxs)(rd.A,{children:[(0,r.jsx)(tA.A,{onClick:t,children:"Close"}),(0,r.jsx)(tA.A,{onClick:()=>{t(),n()},autoFocus:!0,children:"Go to Settings"})]})]})}var rh=n(67350),rx=n(58748),rf=n(57316),rv=n(4420);let ry=(0,rf.A)("div")(e=>{let{theme:t}=e;return{position:"sticky",top:-8,paddingLeft:16,paddingBottom:1,paddingTop:1,color:(0,rv.a)(t.palette.secondary.light,.4),backgroundColor:(0,rv.a)(t.palette.secondary.light,.9),...t.applyStyles("dark",{backgroundColor:(0,rv.e$)(t.palette.secondary.light,.5)})}}),rj=(0,rf.A)("ul")({padding:0}),rA=()=>{let e=(0,tK.A)(),t=(0,tY.A)(e.breakpoints.down("sm")),{models:n,selectedModelId:l,isLoading:i,error:a,handleModelSelect:s,retryFetch:d,showFreeOnly:c}=(0,tw.e3)({models:F,selectedModelId:P,isLoading:z,error:U,handleModelSelect:N,retryFetch:W,showFreeOnly:X}),[u,p]=(0,o.useState)(!1),g=(0,o.useMemo)(()=>{let e=n;return c&&(e=e.filter(e=>{var t,n;return(null===(t=e.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=e.pricing)||void 0===n?void 0:n.completion)==="0"})),e},[n,c]);(0,o.useMemo)(()=>{let e=n.find(e=>e.id===l);return e?e.name.replace(/^[^:]+:\s*/,""):l},[n,l]);let m=(0,o.useMemo)(()=>n.find(e=>e.id===l),[n,l]);return(0,r.jsxs)(tO.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[a&&!i&&(0,r.jsx)(nG.A,{title:"Error loading models: ".concat(a,". Click to retry."),children:(0,r.jsx)(rh.A,{color:"error",sx:{mr:1,cursor:"pointer"},onClick:()=>d()})}),(0,r.jsx)(nN.A,{groupBy:e=>e.created?new Date(1e3*e.created).toLocaleString("default",{month:"long",year:"numeric"}):"Unknown",renderGroup:e=>(0,r.jsxs)("li",{children:[(0,r.jsx)(ry,{children:e.group}),(0,r.jsx)(rj,{children:e.children})]},e.key),id:"appbar-model-selector",value:null!=m?m:null,open:u,onOpen:()=>p(!0),onClose:()=>p(!1),onChange:(e,t)=>{t&&s(t.id)},options:g,getOptionLabel:e=>e.name.replace(/^[^:]+:\s*/,"")||e.id,isOptionEqualToValue:(e,t)=>e.id===t.id,loading:i,disabled:i||null!==a,sx:{minWidth:250,mr:.5},renderInput:e=>(0,r.jsx)(tI.A,{...e,variant:"outlined",placeholder:"Select Model...",InputProps:{...e.InputProps,style:{color:"inherit",height:"36px"},endAdornment:(0,r.jsx)(o.Fragment,{children:e.InputProps.endAdornment})},inputProps:{...e.inputProps,style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}}),renderOption:(e,t)=>(0,o.createElement)(tO.A,{component:"li",...e,key:t.id,children:[t.name," "]})}),(0,r.jsx)(tS.A,{onClick:()=>{t?nt({tab:"modelInfo"}):ni()},disabled:!m,sx:{color:"inherit"},children:(0,r.jsx)(rx.A,{})})]})},rw=e=>{var t,n,o,l;let{model:i}=e;(0,tw.e3)(nv),(0,tw.e3)(nf);let a=(0,tw.e3)(nf),s=(null===(t=i.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=i.pricing)||void 0===n?void 0:n.completion)==="0",d=i.created?new Date(1e3*i.created).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"",c=(null===(o=i.pricing)||void 0===o?void 0:o.prompt)?(1e6*parseFloat(i.pricing.prompt)).toFixed(2):"0",u=(null===(l=i.pricing)||void 0===l?void 0:l.completion)?(1e6*parseFloat(i.pricing.completion)).toFixed(2):"0";return(0,r.jsxs)(t$.A,{scroll:"body",open:a,onClose:()=>na(),"aria-labelledby":"Model info","aria-describedby":"Shows Model name, date, cost, and description",children:[(0,r.jsx)(tq.A,{children:"Model Info"}),(0,r.jsx)(tH.A,{children:(0,r.jsxs)(tO.A,{children:[(0,r.jsxs)(tj.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(tC.A,{variant:"h6",fontWeight:"bold",children:i.name}),s&&(0,r.jsx)(nG.A,{title:"Free model",children:(0,r.jsx)(nV.A,{fontSize:"small"})})]}),(0,r.jsxs)(tj.A,{direction:"row",alignItems:"center",spacing:1,mt:1,children:[(0,r.jsx)(tC.A,{variant:"body2",fontFamily:"monospace",children:i.id}),(0,r.jsx)(nG.A,{title:"Copy model ID",children:(0,r.jsx)(tS.A,{size:"small",onClick:()=>{navigator.clipboard.writeText(i.id)},children:(0,r.jsx)(nL.A,{fontSize:"small"})})})]}),(0,r.jsx)(tX.A,{sx:{my:2}}),(0,r.jsxs)(tj.A,{spacing:1,flexWrap:"wrap",children:[(0,r.jsxs)(tj.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(tC.A,{variant:"body2",color:"text.secondary",children:["Created ",d]}),(0,r.jsxs)(tC.A,{variant:"body2",color:"text.secondary",children:[i.context_length.toLocaleString()," context"]})]}),(0,r.jsxs)(tj.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(tC.A,{variant:"body2",color:"text.secondary",children:["$",c,"/M input tokens"]}),(0,r.jsxs)(tC.A,{variant:"body2",color:"text.secondary",children:["$",u,"/M output tokens"]})]})]}),(0,r.jsx)(tX.A,{sx:{my:2}}),(0,r.jsx)(tC.A,{variant:"body2",color:"text.primary",whiteSpace:"pre-line",children:i.description})]})}),(0,r.jsx)(rd.A,{children:(0,r.jsx)(tO.A,{sx:{p:2,display:"flex",alignSelf:"center"},children:(0,r.jsx)(tA.A,{variant:"contained",onClick:()=>na(),autoFocus:!0,children:"Ok"})})})]})};function rb(){(0,o.useEffect)(()=>{function e(){let e=window.getSelection();if(!e||e.isCollapsed){ta();return}let t=e.getRangeAt(0).getBoundingClientRect(),n=e.anchorNode;for(;n&&1!==n.nodeType;)n=n.parentElement;if(!n||!n.closest(".chat-message")){ta();return}let r=e.toString().trim();if(!r){ta();return}ti({x:t.left+t.width/2+window.scrollX,y:t.bottom+window.scrollY,selectionText:r})}document.addEventListener("mouseup",e),document.addEventListener("keyup",e);let t=()=>ta();return document.addEventListener("scroll",t,!0),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("keyup",e),document.removeEventListener("scroll",t,!0)}},[]);let e=o.useRef(null),t=(0,tK.A)(),n=(0,tY.A)(t.breakpoints.down("sm")),[l,i]=(0,tw.e3)([ev,ef]),a=l.length>0?l[l.length-1]:null,[u,p]=(0,tw.e3)([nu,np]),[g,m]=(0,tw.e3)([e6,b]),h=(0,tw.e3)(nj),[x,f]=(0,tw.e3)([ey,eA]),y=(0,tw.e3)(eb);(0,tw.e3)(nv);let[C,S,I,D,T]=(0,tw.e3)([e3,e4,eB,eG,e6.map(e=>{var t;return null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null})]),{apiKey:E,temperature:z,systemPrompt:X,currentChatTokens:O}=(0,tw.e3)({apiKey:b,temperature:k,systemPrompt:M,currentChatTokens:ej}),[R,L]=o.useState(""),[U,N]=o.useState(!1),[B,G]=o.useState(null),[$,q]=o.useState(""),[H,_]=o.useState(!1),K=(0,tw.e3)(c),Y=o.useMemo(()=>R?C.filter(e=>e.title.toLowerCase().includes(R.toLowerCase())):C,[C,R]),Z=()=>{n?nt({tab:"history"}):ne()},Q=()=>{n?nt({tab:"settings"}):t5()},ee=()=>{if(null!==h){let e=document.getElementById(h);e&&e.scrollIntoView({behavior:"smooth",block:"center"}),console.log("Editing message, not sending new one"),s({message:"Finish editing before sending a new message.",severity:"warning"});return}let e=0===i.trim().length,t=(null==a?void 0:a.role)==="user";e?t&&!x&&es():x||J()},et={searchTerm:R,setSearchTerm:L,isLoading:S,filteredHistory:Y,editingId:B,editedTitle:$,currentChatId:T,setEditedTitle:q,handleStartEdit:(e,t,n)=>{n.stopPropagation(),G(e),q(t)},handleSaveEdit:e=>{eq({id:e,newTitle:$.trim()}),G(null)},handleCancelEdit:()=>{G(null)},handleDeleteChat:(e,t)=>{t.stopPropagation(),D(e)},handleSelectChat:e=>{I(e)}},en={apiKey:E,showApiKey:H,temperature:z,systemPrompt:X,currentChatTokens:O,handleApiKeyChange:j,handleTemperatureChange:A,handleSystemPromptChange:w,handleClickShowApiKey:()=>_(e=>!e),handleMouseDownApiKey:e=>{e.preventDefault()}},[er,eo]=(0,tw.e3)([P,F]),el=o.useMemo(()=>eo.find(e=>e.id===er),[eo,er]);o.useEffect(()=>{y&&ea(!1)},[y]);let ei=(0,tw.e3)(eb),ed=(0,tw.e3)(ek);return o.useEffect(()=>{ei||requestAnimationFrame(()=>{var t;null===(t=e.current)||void 0===t||t.scrollIntoView({behavior:"smooth"})})},[a,ed,ei]),o.useEffect(()=>{v(),W(),eU()},[]),(0,r.jsxs)(tO.A,{sx:{height:"100vh"},children:[" ",(0,r.jsxs)(n0.A,{position:"fixed",children:[(0,r.jsxs)(nA.A,{variant:"dense",disableGutters:!0,sx:{px:1},children:[!u&&!n&&(0,r.jsx)(tS.A,{color:"inherit","aria-label":"History",onClick:Z,children:(0,r.jsx)(nE.A,{})}),n&&(0,r.jsx)(tS.A,{color:"inherit","aria-label":"History",onClick:Z,children:(0,r.jsx)(nE.A,{})}),!u&&(0,r.jsx)(tS.A,{color:"inherit","aria-label":"New chat",onClick:()=>e$(),children:(0,r.jsx)(nF.A,{})}),(0,r.jsx)(tO.A,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:(0,r.jsx)(rA,{})}),!p&&!n&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tS.A,{color:"inherit","aria-label":"usage info",onClick:()=>{tL(),N(!0)},children:(0,r.jsx)(tz.A,{})}),(0,r.jsx)(tS.A,{color:"inherit","aria-label":"settings",onClick:Q,children:(0,r.jsx)(n_.A,{})})]}),n&&(0,r.jsx)(tS.A,{size:"large",edge:"end",color:"inherit","aria-label":"settings",onClick:Q,children:(0,r.jsx)(n_.A,{})})]}),(0,r.jsx)(t_,{open:U,onClose:()=>N(!1)})]}),!n&&(0,r.jsx)(tV.Ay,{variant:"persistent",open:u,anchor:"left",sx:{width:300,flexShrink:0,"& .MuiDrawer-paper":{width:300,boxSizing:"border-box"}},children:(0,r.jsx)(tO.A,{sx:{overflow:"auto"},children:(0,r.jsx)(nW,{...et})})}),!n&&(0,r.jsx)(tV.Ay,{variant:"persistent",open:p,anchor:"right",sx:{width:300,flexShrink:0,"& .MuiDrawer-paper":{width:300,boxSizing:"border-box"}},children:(0,r.jsx)(nZ,{...en})}),(0,r.jsxs)(tO.A,{component:"main",sx:e=>({flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:0,marginRight:0,...u&&!n&&{marginLeft:"".concat(300,"px"),transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},...p&&!n&&{marginRight:"".concat(300,"px"),transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},pt:"".concat(Number(e.mixins.toolbar.minHeight)-16,"px"),pb:0,boxSizing:"border-box"}),children:[(0,r.jsxs)(tO.A,{sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",width:"100%",p:n?1:2,pt:n?2:3,position:"relative"},children:[(0,r.jsxs)(n1.A,{maxWidth:"md",disableGutters:!0,sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%"},children:[(0,r.jsx)(ty.A,{elevation:0,sx:{backgroundColor:"transparent",display:"flex",flexDirection:"column",width:"100%",alignItems:"center"},children:(0,r.jsxs)(tj.A,{alignItems:"center",sx:{alignItems:"stretch",width:"100%"},children:[l.map(e=>(0,r.jsx)(rs,{message:e},e.id)),(0,r.jsx)("div",{ref:e})]})})," "]})," ",(0,r.jsx)(tZ.A,{open:K.open,anchorOrigin:{vertical:"top",horizontal:"center"},sx:e=>{let t=Number(e.mixins.toolbar.minHeight)+8;return{top:"".concat(t,"px !important")}},children:(0,r.jsx)(n6.A,{variant:"filled",onClose:()=>d(),severity:K.severity,children:K.message})})]})," ",f&&(0,r.jsx)(n1.A,{maxWidth:"md",sx:{px:n?1:2,width:"100%"},children:(0,r.jsx)(n6.A,{severity:"error",sx:{mt:1,mb:1,width:"100%"},children:f})}),(0,r.jsxs)(ty.A,{square:!0,sx:{mt:"auto",width:"100%",backgroundColor:"background.paper",flexShrink:0,borderTop:1,borderColor:"divider",p:1},children:[" ",(0,r.jsxs)(tO.A,{maxWidth:"md",sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,r.jsxs)(tS.A,{color:"primary","aria-label":"attach file",disabled:!0,children:[" ",(0,r.jsx)(n3.A,{})]}),(0,r.jsx)(tI.A,{fullWidth:!0,multiline:!0,maxRows:5,variant:"outlined",placeholder:"Type your message...",sx:{flexGrow:1},value:i,onChange:e=>V(e.target.value)}),(0,r.jsxs)(tO.A,{sx:{position:"relative"},children:[(()=>{let e=0===i.trim().length,t=l.length>0?l[l.length-1]:null,n=(null==t?void 0:t.role)==="user",o=x||e&&!n;return(0,r.jsxs)(tS.A,{size:"small","aria-label":"Generate",onClick:ee,disabled:o,sx:{color:"primary.light"},children:[(0,r.jsx)(n2.A,{fontSize:"large"})," "]})})(),x&&(0,r.jsx)(nb.A,{size:24,sx:{color:"primary.main",position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})]})," "]})," ",(0,r.jsx)(rm,{})]})," ",n&&(0,r.jsx)(nQ,{historyPanelProps:et,settingsPanelProps:en,modelInfo:el}),!!el&&(0,r.jsx)(rw,{model:el}),(0,r.jsx)(tb,{}),(0,r.jsx)(tP,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5661,7330,9568,7113,8441,1684,7358],()=>t(1562)),_N_E=e.O()}]);