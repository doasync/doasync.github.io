(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{1562:(e,t,n)=>{Promise.resolve().then(n.bind(n,74709))},74709:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>rh});var r=n(95155),o=n(12115),i=n(87971),l=n(41236);let a=(0,i.lh)(),s=(0,i.lh)(),d=(0,i.y$)({open:!1,message:"",severity:"info"}),c=(0,i.lh)(),u=(0,i.lh)();async function p(e){let{message:t,model:n,apiKey:r}=e;try{var o,i,l;let e=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:null!=n?n:"mistralai/mixtral-8x7b-instruct",messages:[{role:"user",content:t}]})});if(!e.ok)throw Error("OpenRouter API error: ".concat(e.status));let a=await e.json(),s=null===(l=a.choices)||void 0===l?void 0:null===(i=l[0])||void 0===i?void 0:null===(o=i.message)||void 0===o?void 0:o.content;if("string"==typeof s)return s.trim();throw Error("Malformed OpenRouter response")}catch(e){return console.error("OpenRouter API error",e),"Sorry, there was an error processing your request."}}(0,l.c)({source:c,timeout:2500,target:u}),(0,i.XM)({source:d,clock:a,filter:(e,t)=>{let{open:n}=e,{message:r}=t;return!n&&!!r},fn:(e,t)=>{let{message:n,severity:r="info"}=t;return{open:!0,message:n,severity:r}},target:d}),(0,i.XM)({source:d,filter:e=>{let{open:t}=e;return!!t},target:c}),(0,i.XM)({clock:[s,u],source:d,filter:e=>{let{open:t}=e;return!!t},fn:(e,t)=>{let{message:n="",severity:r="info"}=t||{};return{open:!1,message:n,severity:r}},target:d});let g="openrouter_api_key",m="default_temperature",h="default_system_prompt",x=(0,i.$5)("settings"),f=x.event("loadSettings"),v=x.event("settingsLoaded"),y=x.event("apiKeyChanged"),j=x.event("temperatureChanged"),A=x.event("systemPromptChanged"),w=x.store("",{name:"apiKey"}),b=x.store(.7,{name:"temperature"}),k=x.store("",{name:"systemPrompt"}),M=x.store(!1,{name:"settingsLoaded"}).on(v,()=>!0),S=(0,i.kg)({apiKey:w,temperature:b,systemPrompt:k}),C=x.effect({name:"loadSettingsFx",handler:async()=>{var e,t;let n=null!==(e=localStorage.getItem(g))&&void 0!==e?e:"",r=localStorage.getItem(m),o=null!==(t=localStorage.getItem(h))&&void 0!==t?t:"",i=.7;if(r){let e=parseFloat(r);isNaN(e)||(i=e)}return{apiKey:n,temperature:i,systemPrompt:o}}}),I=x.effect({name:"saveSettingsFx",handler:async e=>{let{apiKey:t,temperature:n,systemPrompt:r}=e;localStorage.setItem(g,t),localStorage.setItem(m,String(n)),localStorage.setItem(h,r)}});(0,i.XM)({clock:f,target:C}),(0,i.XM)({clock:C.doneData,target:v}),w.on(v,(e,t)=>t.apiKey),b.on(v,(e,t)=>t.temperature),k.on(v,(e,t)=>t.systemPrompt),w.on(y,(e,t)=>t),b.on(j,(e,t)=>t),k.on(A,(e,t)=>t),(0,i.XM)({clock:S,filter:M,target:I}),C.fail.watch(e=>{let{error:t}=e;console.error("Failed to load settings:",t)}),I.fail.watch(e=>{let{error:t}=e;console.error("Failed to save settings:",t)});var D=n(4602);let T=(0,i.$5)("models"),E=T.store([],{name:"availableModels"}),F=T.store("openrouter/quasar-alpha",{name:"selectedModelId"}),P=T.store(!1,{name:"isLoadingModels"}),z=T.store(!1,{name:"showFreeOnly"}),X=T.event("setShowFreeOnly");z.on(X,(e,t)=>t),(0,D.Zr)({store:z,key:"showFreeOnly"}),(0,D.Zr)({store:F,key:"selectedModelId"});let O=T.store("google/gemini-2.0-flash-lite-001",{name:"autoTitleModelId"}),R=T.event("autoTitleModelSelected");O.on(R,(e,t)=>t),(0,D.Zr)({store:O,key:"autoTitleModelId"});let L=T.store(null,{name:"modelsError"}),U=T.event("fetchModels"),W=T.event("modelSelected"),N=T.effect({name:"fetchModelsFx",handler:async()=>{let e=await fetch("https://openrouter.ai/api/v1/models");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return(await e.json()).data.sort((e,t)=>{var n,r;return(null!==(n=t.created)&&void 0!==n?n:0)-(null!==(r=e.created)&&void 0!==r?r:0)})}});(0,i.XM)({clock:U,target:N}),P.on(N,()=>!0).reset(N.finally),E.on(N.doneData,(e,t)=>t),(0,i.XM)({clock:N.doneData,source:F,fn:(e,t)=>t.length>0?t.some(t=>t.id===e)?e:t[0].id:e,target:F}),F.on(W,(e,t)=>t),L.on(N.failData,(e,t)=>t.message).reset(N),L.reset(N.done);var B=n(76012);let G=async e=>{let{modelId:t,messages:n,apiKey:r,temperature:o,systemPrompt:i}=e,l=[];i&&i.trim()&&l.push({role:"system",content:i}),n.forEach(e=>{("user"===e.role||"assistant"===e.role)&&l.push({role:e.role,content:e.content})});let a=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:t,messages:l,temperature:o})});if(!a.ok){let e="HTTP error! status: ".concat(a.status);try{let t=await a.json();e="API Error (".concat(a.status,"): ").concat(t.error.message)}catch(e){}throw Error(e)}return await a.json()},$=(e,t)=>{var n,r,o;let{messages:i}=e,l=null===(o=t.choices)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(n=r.message)||void 0===n?void 0:n.content;return[...i,l?{id:t.id||crypto.randomUUID(),role:"assistant",content:l,timestamp:Date.now()}:{id:t.id||crypto.randomUUID(),role:"assistant",content:"Error: Empty response",timestamp:Date.now()}]},q=(e,t)=>{let n,{messages:r,apiKey:o,temperature:i,systemPrompt:l,selectedModelId:a}=e,s=r.findIndex(e=>e.id===t.id);if(-1===s)throw Error("Message to retry not found: "+t.id);if("user"===t.role)n=r.slice(0,s+1);else{if(s<0)throw Error("Invalid retryIndex for assistant message retry.");n=r.slice(0,s)}return{modelId:a,messages:n,apiKey:o,temperature:i,systemPrompt:l}},_=(e,t)=>{var n,r,o,i,l,a,s,d;let c;let{messages:u,requestContext:p}=e,g=-1,m=!1;if((null==p?void 0:p.type)==="generate"){if(-1===(g=u.findIndex(e=>e.id===p.placeholderId)))return console.error("Generating placeholder message not found for replacement:",p.placeholderId),null;m=!1,console.log("[DEBUG][lib] calculateRetryUpdatePayloadFn: GENERATE FLOW RETURNING:",{targetIndex:g,newAssistantMessageId:(c={id:t.id||crypto.randomUUID(),role:"assistant",content:null!==(i=null===(o=t.choices)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(n=r.message)||void 0===n?void 0:n.content)&&void 0!==i?i:"Error: Empty response",timestamp:Date.now(),isLoading:!1}).id,insert:m}),console.log("[DEBUG] calculateRetryUpdatePayloadFn: GENERATE FLOW RETURNING:",{targetIndex:g,newAssistantMessage:c,insert:m})}else{if((null==p?void 0:p.type)!=="retry")return console.error("calculateRetryUpdatePayloadFn called with unexpected context:",p),null;let{originalMessageId:e,originalRole:n}=p;if(c={id:t.id||crypto.randomUUID(),role:"assistant",content:null!==(d=null===(s=t.choices)||void 0===s?void 0:null===(a=s[0])||void 0===a?void 0:null===(l=a.message)||void 0===l?void 0:l.content)&&void 0!==d?d:"Error: Empty response",timestamp:Date.now()},"assistant"===n)g=u.findIndex(t=>t.id===e);else{if("user"!==n)return console.error("Unexpected original role in retry context:",n),null;let t=u.findIndex(t=>t.id===e);if(-1===t)return console.error("Original user message for retry not found:",e),null;let r=u.findIndex((e,n)=>n>t&&"assistant"===e.role);-1!==r?(g=r,m=!1):(g=t,m=!0,console.log("[calculateRetryUpdatePayloadFn] No assistant after retried user message, inserting new assistant message after user:",e))}}if(-1===g)return console.error("Retry logic error: Could not determine target index."),null;let h={targetIndex:g,newAssistantMessage:c,insert:m};return -1===g?(console.error("Retry logic error: Final targetIndex is -1. Returning null."),null):h},H=(e,t)=>{let{messageId:n,role:r}=t;if("assistant"===r)return n;{let t=e.findIndex(e=>e.id===n);if(-1===t)return console.error("Retrying user message not found:",n),null;let r=e.find((e,n)=>n>t&&"assistant"===e.role);return r?r.id:null}},K=(e,t)=>{let{targetIndex:n,newAssistantMessage:r,insert:o=!1}=t;if(o){let t=[...e];return n>=-1&&n<e.length?(t.splice(n+1,0,r),t):(console.error("Retry update (insert) received invalid index:",n),e)}if(-1!==n&&n<e.length)return e.map((e,t)=>t===n?r:e);if(n===e.length){let t=[...e];return t[t.length-1]=r,t}return console.error("Retry update (replace) received invalid index or state."),e},Z=(0,i.$5)("chat"),Y=Z.event("messageTextChanged"),V=Z.event("messageSent"),J=Z.event("editMessage"),Q=Z.event("deleteMessage"),ee=Z.event("messageRetry"),et=Z.event("initialChatSaveNeeded"),en=Z.event("apiKeyMissing"),er=Z.event("apiRequestTokensUpdated"),eo=Z.event("userMessageCreated"),ei=Z.event("scrollToLastMessageNeeded"),el=Z.event("setPreventScroll"),ea=Z.event("generateResponseClicked"),es=Z.event("retryUpdate"),ed=Z.event("normalResponseProcessed"),ec=Z.event("messageRetryInitiated"),eu=Z.event("prepareRetryParams"),ep=Z.event("calculatedRetryUpdate"),eg=Z.event("addPlaceholderForGeneration"),em=Z.event("placeholderGenerated"),eh=Z.effect({name:"sendApiRequestFx",handler:G}),ex=Z.store("",{name:"$messageText"}),ef=Z.store([],{name:"$messages"}),ev=Z.store(!1,{name:"$isGenerating"}),ey=Z.store(0,{name:"$currentChatTokens"}),ej=Z.store(null,{name:"$apiError"}),eA=Z.store(null,{name:"$retryingMessageId"}),ew=Z.store(!1,{name:"$preventScroll"}),eb=Z.store(0,{name:"$scrollTrigger"}).on(ei,()=>Date.now()),ek=e=>!!e&&("user"===e.role||"assistant"===e.role);ex.on(Y,(e,t)=>t),ef.on(J,(e,t)=>{let{messageId:n,newContent:r}=t;return e.map(e=>e.id===n?{...e,content:r,isEdited:!0,originalContent:e.content}:e)}).on(Q,(e,t)=>e.filter(e=>e.id!==t)).on(eo,(e,t)=>[...e,t]).on(em,(e,t)=>[...e,t]).on(es,(e,t)=>K(e,t)).on(eh.done,(e,t)=>{var n;let{params:r,result:o}=t;return(null===(n=r.requestContext)||void 0===n?void 0:n.type)==="normal"?$({messages:e},o):e}),ej.reset(V,ea,ee),ev.on(eh,()=>!0).reset(eh.finally),ey.on(eh.doneData,(e,t)=>{var n,r;return e+(null!==(r=null===(n=t.usage)||void 0===n?void 0:n.total_tokens)&&void 0!==r?r:0)}),eA.on(ec,(e,t)=>{let n=ef.getState();return"assistant"===t.role?t.messageId:H(n,t)}).on(em,(e,t)=>t.id).reset(eh.finally),ew.on([J],()=>!0).on([ec,ea],()=>!1).on(eh.finally,(e,t)=>null===eA.getState()&&e),(0,i.XM)({clock:V,source:ex,filter:e=>e.trim().length>0,fn:e=>({id:crypto.randomUUID(),role:"user",content:e.trim(),timestamp:Date.now()}),target:eo}),(0,i.XM)({clock:eo,fn:()=>"",target:ex}),(0,i.XM)({clock:eo,source:ef,filter:e=>1===e.length,target:et}),(0,i.XM)({clock:eo,source:{messages:ef,apiKey:w,temperature:b,systemPrompt:k,selectedModelId:F},filter:e=>{let{apiKey:t}=e;return!!t},fn:e=>{let{messages:t,apiKey:n,temperature:r,systemPrompt:o,selectedModelId:i}=e;return{modelId:i,messages:t,apiKey:n,temperature:r,systemPrompt:o,requestContext:{type:"normal"}}},target:eh}),(0,i.XM)({clock:V,source:w,filter:e=>!e,target:en}),(0,i.XM)({clock:ea,source:ev,filter:e=>!e,target:eg}),(0,i.XM)({clock:eg,fn:()=>({id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now(),isLoading:!0}),target:em}),(0,i.XM)({clock:em,source:{messages:ef,apiKey:w,temperature:b,systemPrompt:k,selectedModelId:F},filter:e=>{let{apiKey:t,messages:n}=e;return!!t&&n.length>0},fn:(e,t)=>{let{messages:n,apiKey:r,temperature:o,systemPrompt:i,selectedModelId:l}=e;return{modelId:l,messages:n.slice(0,-1),apiKey:r,temperature:o,systemPrompt:i,requestContext:{type:"generate",placeholderId:t.id}}},target:eh}),(0,i.XM)({clock:ea,source:w,filter:e=>!e,target:en}),(0,i.XM)({clock:ee,source:{messages:ef,apiKey:w,temperature:b,systemPrompt:k,selectedModelId:F},filter:(e,t)=>{let{apiKey:n}=e;return!!n&&ek(t)},fn:(e,t)=>{let{messages:n,apiKey:r,temperature:o,systemPrompt:i,selectedModelId:l}=e,a=q({messages:n,apiKey:r,temperature:o,systemPrompt:i,selectedModelId:l},t),s={type:"retry",originalMessageId:t.id,originalRole:t.role};return{...a,requestContext:s}},target:eu}),(0,i.XM)({clock:ee,filter:ek,fn:e=>({messageId:e.id,role:e.role}),target:ec}),(0,i.XM)({clock:eu,target:eh}),(0,i.XM)({clock:eh.done,source:ef,fn:(e,t)=>{let{params:n,result:r}=t;return _({messages:e,requestContext:n.requestContext},r)},target:ep}),(0,i.XM)({clock:ep,filter:e=>{let t=null!==e;return console.log("[DEBUG] sample targeting retryUpdate:",{calculatedPayload:e,shouldTrigger:t}),t},target:es}),(0,i.XM)({clock:eh.done,filter:e=>{var t;let{params:n}=e;return(null===(t=n.requestContext)||void 0===t?void 0:t.type)==="normal"},target:ed}),(0,i.XM)({clock:eh.doneData,target:er}),(0,i.XM)({clock:[es,ed],fn:()=>void 0,target:ei});var eM=n(198);let eS="chats",eC=null,eI=()=>(eC||(eC=(0,eM.P2)("LLMChatDB",1,{upgrade(e){if(!e.objectStoreNames.contains(eS)){let t=e.createObjectStore(eS,{keyPath:"id"});t.indexNames.contains("lastModified")||t.createIndex("lastModified","lastModified")}}})),eC),eD=async()=>{let e=(await eI()).transaction(eS,"readonly"),t=e.objectStore(eS),n=await t.getAll();return await e.done,n.sort((e,t)=>t.lastModified-e.lastModified).map(e=>{let{id:t,title:n,lastModified:r}=e;return{id:t,title:n,lastModified:r}})},eT=async e=>{let t=await eI(),n=await t.get(eS,e);return null!=n?n:null},eE=async e=>{let t=await eI(),n={...e,messages:e.messages.map(e=>({...e,isEdited:e.isEdited||!1,originalContent:e.originalContent||null}))};await t.put(eS,n)},eF=async e=>{let t=await eI();await t.delete(eS,e)},eP=async e=>{let{id:t,newTitle:n}=e,r=(await eI()).transaction(eS,"readwrite"),o=r.objectStore(eS),i=await o.get(t);return i?(i.title=n,i.lastModified=Date.now(),await o.put(i),await r.done,{id:i.id,title:i.title,lastModified:i.lastModified}):(await r.done,null)},ez=async e=>{var t,n,r;let{chatId:o,messages:i,apiKey:l}=e;if(!l)throw Error("API key is required for title generation.");if(0===i.length)throw Error("Cannot generate title for empty chat.");let a=[...i.slice(0,6).map(e=>({role:e.role,content:e.content})),{role:"user",content:"Summarize this chat conversation\n  in 1-5 words (maximum conciseness). Use title case. Focus on user's intent.\n  It will be used as a title. Do not mention yourself (assistant) or the user.\n  Example: Exploring Effector Stores"}],s={model:O.getState(),messages:a,temperature:.5,max_tokens:10},d=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify(s)});if(!d.ok){let e="Title generation failed! status: ".concat(d.status);try{let t=await d.json();e="Title Generation API Error (".concat(d.status,"): ").concat(t.error.message)}catch(e){}throw Error(e)}let c=await d.json(),u=null===(r=c.choices)||void 0===r?void 0:null===(n=r[0])||void 0===n?void 0:null===(t=n.message)||void 0===t?void 0:t.content,p=null==u?void 0:u.replace(/[^a-zA-Z0-9\s]/g,"").trim();if(!p)throw console.error("Title generation API response content is empty or undefined:",c),Error("Title generation resulted in an empty response.");return{chatId:o,generatedTitle:p}},eX=(e,t)=>{let n;let r={id:t.id,title:t.title,lastModified:t.lastModified},o=e.findIndex(e=>e.id===t.id);return -1!==o?(n=[...e])[o]=r:n=[r,...e],n.sort((e,t)=>t.lastModified-e.lastModified)},eO=(e,t)=>t?e.map(e=>e.id===t.id?t:e).sort((e,t)=>t.lastModified-e.lastModified):e,eR=e=>{var t,n,r,o,i;let{currentSession:l,messages:a,model:s,temperature:d,systemPrompt:c,tokens:u,draft:p,selectedModelInfo:g}=e,m=Date.now(),h=null==l?void 0:l.id,x=null!=h?h:crypto.randomUUID(),f=h&&null!==(r=null==l?void 0:l.title)&&void 0!==r?r:new Date(m).toLocaleString();return{id:x,title:f,createdAt:h&&null!==(o=null==l?void 0:l.createdAt)&&void 0!==o?o:m,lastModified:m,messages:a,settings:{model:{pricing:{prompt:Number(null==g?void 0:null===(t=g.pricing)||void 0===t?void 0:t.prompt)||0,completion:Number(null==g?void 0:null===(n=g.pricing)||void 0===n?void 0:n.completion)||0},context_length:null!==(i=null==g?void 0:g.context_length)&&void 0!==i?i:1e6},temperature:d,systemPrompt:c},totalTokens:u,draft:null!=p?p:"",modelInfo:null!=g?g:null}},eL=(0,i.lh)("appStarted"),eU=(0,i.$5)("history"),eW=eU.event("loadChatHistory"),eN=eU.event("chatSelected"),eB=eU.event("deleteChat"),eG=eU.event("newChatCreated"),e$=eU.event("chatTitleEdited"),eq=eU.event("generateTitle"),e_=eU.event("duplicateChatClicked"),eH=eU.event("regenerateTitleForChat"),eK=eU.effect("loadChatHistoryIndexFx",{handler:eD}),eZ=eU.effect("duplicateChatFx");eZ.use(async e=>{var t,n,r;let o=await eT(e);if(!o)throw Error("Original chat not found");let i=crypto.randomUUID(),l=Date.now(),a={...o,id:i,createdAt:l,lastModified:l,title:o.title+" (Copy)",messages:null!==(t=o.messages)&&void 0!==t?t:[],settings:null!==(n=o.settings)&&void 0!==n?n:{model:"",temperature:1,systemPrompt:""},totalTokens:null!==(r=o.totalTokens)&&void 0!==r?r:0};return await eE(a),i}),(0,i.XM)({clock:e_,target:eZ}),(0,i.XM)({clock:eZ.doneData,target:eN}),(0,i.XM)({clock:eZ.doneData,target:eK});let eY=eU.effect("loadSpecificChatFx",{handler:eT}),eV=eU.effect("saveChatFx",{handler:eE}),eJ=eU.effect("deleteChatFx",{handler:eF}),eQ=eU.effect("editChatTitleFx",{handler:eP}),e0=eU.effect("generateTitleFx",{handler:ez}),e1=eU.effect("regenerateTitleForChatFx");e1.use(async e=>{let t=w.getState();if(!t)throw Error("API key is missing");let n=await eT(e);if(!n)throw Error("Chat not found");if(!n.messages||0===n.messages.length)return;let r=await ez({chatId:e,messages:n.messages,apiKey:t,modelId:F.getState()});r.generatedTitle&&await eP({id:e,newTitle:r.generatedTitle})}),(0,i.XM)({clock:eH,target:e1}),(0,i.XM)({clock:e1.done,target:eK});let e2=eU.store([],{name:"$chatHistoryIndex"}),e3=eU.store(null,{name:"$currentChatSession"});e3.map(e=>{var t;return null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null});let e6=eK.pending;eV.pending,eY.pending,e3.reset(eG);let e4=e=>null!==e;(0,i.XM)({clock:eK.doneData,fn:e=>e,target:e2}),(0,i.XM)({clock:eJ.done,source:e2,fn:(e,t)=>{let{params:n}=t;return e.filter(e=>e.id!==n)},target:e2}),(0,i.XM)({clock:eV.done,source:e2,fn:(e,t)=>{let{params:n}=t;return eX(e,n)},target:e2}),(0,i.XM)({source:e3.updates,filter:e=>null!==e&&2===e.messages.length&&(/^\d{1,2}\/\d{1,2}\/\d{4}/.test(e.title)||""===e.title.trim()),target:eH.prepend(e=>e.id)}),(0,i.XM)({clock:eQ.doneData,source:e2,filter:(e,t)=>!!t,fn:(e,t)=>eO(e,t),target:e2}),(0,i.XM)({clock:eY.doneData,fn:e=>e,target:e3}),(0,i.XM)({clock:eY.doneData,fn:e=>{var t;return null!==(t=null==e?void 0:e.draft)&&void 0!==t?t:""},target:ex}),(0,i.XM)({clock:eV.done,fn:e=>{let{params:t}=e;return t},target:e3}),(0,i.XM)({clock:eQ.doneData,source:e3,filter:(e,t)=>!!e&&!!t&&e.id===t.id,fn:(e,t)=>({...e,title:t.title,lastModified:t.lastModified}),target:e3}),(0,i.XM)({clock:[eL,eW],target:eK}),(0,i.XM)({clock:eN,target:eY}),(0,i.XM)({clock:eB,target:eJ}),(0,i.XM)({clock:e$,target:eQ}),(0,i.XM)({clock:eY.doneData,filter:e4,fn:e=>e.messages,target:ef}),(0,i.XM)({clock:eY.doneData,filter:e4,fn:e=>F.getState(),target:F}),(0,i.XM)({clock:eY.doneData,filter:e4,fn:e=>e.settings.temperature,target:b}),(0,i.XM)({clock:eY.doneData,filter:e4,fn:e=>e.settings.systemPrompt,target:k}),(0,i.XM)({clock:eY.doneData,filter:e4,fn:e=>{var t;return null!==(t=e.totalTokens)&&void 0!==t?t:0},target:ey}),(0,i.XM)({clock:eG,fn:()=>[],target:ef});let e5=(0,B.s)({source:ex,timeout:1e3});(0,i.XM)({clock:e5,source:e3,filter:e=>null!==e,fn:(e,t)=>({...e,draft:t,lastModified:Date.now()}),target:e3}),(0,i.XM)({clock:e3,filter:e=>null!==e,target:eV}),(0,i.XM)({clock:eG,fn:()=>0,target:ey}),(0,i.XM)({clock:[et,ed,J,Q,es],source:{currentSession:e3,messages:ef,model:F,temperature:b,systemPrompt:k,tokens:ey,draft:ex,selectedModelInfo:E.map(e=>{var t;return null!==(t=e.find(e=>e.id===F.getState()))&&void 0!==t?t:null})},filter:e=>{let{messages:t}=e;return t.length>0},fn:e=>(console.log("[saveChatFx Trigger] Fired. Source Messages Length:",e.messages.length),e.messages.length>0&&console.log("[saveChatFx Trigger] Last Message ID:",e.messages[e.messages.length-1].id),eR(e)),target:eV}),(0,i.XM)({clock:eV.done,source:w,filter:(e,t)=>{let{params:n}=t;return!!e&&n.messages.length>0&&!n.title},fn:(e,t)=>{let{params:n}=t;return{chatId:n.id,messages:n.messages,apiKey:e,modelId:O.getState()}},target:e0}),(0,i.XM)({clock:e0.doneData,filter:e=>{let{generatedTitle:t}=e;return!!t},fn:e=>{let{chatId:t,generatedTitle:n}=e;return{id:t,newTitle:n}},target:eQ}),(0,i.XM)({clock:eq,source:{apiKey:w,currentChat:e3},filter:e=>{let{apiKey:t,currentChat:n}=e;return!!t&&!!n&&n.messages.length>0},fn:e=>{let{apiKey:t,currentChat:n}=e;return{chatId:n.id,messages:n.messages,apiKey:t,modelId:O.getState()}},target:e0}),e0.fail.watch(e=>{let{error:t,params:n}=e;console.error("Failed to generate title for chat ".concat(n.chatId,":"),t)}),eV.done.watch(()=>{console.log("Effect: saveChatFx done (Debug)")}),eV.fail.watch(e=>{console.error("Effect: saveChatFx failed (Debug)",e)}),(0,i.XM)({clock:W,source:{chat:e3,models:E},filter:e=>{let{chat:t}=e;return null!==t},fn:(e,t)=>{var n,r,o;let{chat:i,models:l}=e,a=l.find(e=>e.id===t);return a?{...i,lastModified:Date.now(),settings:{...i.settings,model:{pricing:{prompt:Number(null===(n=a.pricing)||void 0===n?void 0:n.prompt)||0,completion:Number(null===(r=a.pricing)||void 0===r?void 0:r.completion)||0},context_length:null!==(o=a.context_length)&&void 0!==o?o:1e6}}}:i},target:e3}),(0,i.XM)({clock:e3.updates,filter:e=>null!==e,target:eV});let e8="miniChatModelId_v1",e9=(0,i.lh)();(0,i.lh)();let e7=(0,i.y$)("openai/gpt-3.5-turbo"),te=(0,i.EH)(()=>localStorage.getItem(e8)),tt=(0,i.EH)(e=>{localStorage.setItem(e8,e)});(0,i.XM)({clock:eL,target:te}),(0,i.XM)({clock:te.doneData,filter:e=>null!==e,target:e7}),e7.on(e9,(e,t)=>t),(0,i.XM)({clock:e7.updates,target:tt});let tn=(0,i.lh)(),tr=(0,i.lh)(),to=(0,i.y$)({visible:!1,x:0,y:0,selectionText:""}).on(tn,(e,t)=>({visible:!0,...t})).on(tr,e=>({...e,visible:!1,selectionText:""})),ti=(0,i.lh)(),tl=(0,i.lh)(),ta=(0,i.lh)(),ts=(0,i.lh)(),td=(0,i.lh)(),tc=(0,i.lh)(),tu=(0,i.lh)(),tp=(0,i.y$)({isOpen:!1,isCompact:!1,input:"",messages:[],loading:!1}).on(ti,(e,t)=>{let{initialInput:n,startCompact:r}=t;return{isOpen:!0,isCompact:!!r,input:null!=n?n:"",messages:e.isOpen?e.messages:[],loading:!1}}).on(tl,()=>({isOpen:!1,isCompact:!1,input:"",messages:[],loading:!1})).on(ta,(e,t)=>({...e,input:t})).on(ts,(e,t)=>({...e,isCompact:!1,input:"",messages:[...e.messages,{role:"user",content:t}],loading:!0})).on(td,(e,t)=>({...e,isCompact:!1,messages:[...e.messages,{role:"assistant",content:t}],loading:!1})).reset(tu),tg=(0,i.EH)();tg.use(async e=>{let{message:t,model:n,apiKey:r}=e;return p({message:t,model:n,apiKey:r})}),(0,i.XM)({clock:ts,source:{apiKey:w,model:e7},fn:(e,t)=>{let{apiKey:n,model:r}=e;return{message:t,model:r,apiKey:n}},target:tg}),(0,i.XM)({clock:tg.doneData,target:td});let tm=(0,i.EH)();tm.use(async()=>{let e=tp.getState();if(!e.messages.length)return;let t=crypto.randomUUID(),n=Date.now(),r={id:t,createdAt:n,lastModified:n,title:"",messages:e.messages.map(e=>({id:crypto.randomUUID(),timestamp:Date.now(),role:e.role,content:e.content})),settings:(()=>{var e,t,n;let r=e7.getState(),o=E.getState().find(e=>e.id===r);return{model:{pricing:{prompt:Number(null==o?void 0:null===(e=o.pricing)||void 0===e?void 0:e.prompt)||0,completion:Number(null==o?void 0:null===(t=o.pricing)||void 0===t?void 0:t.completion)||0},context_length:null!==(n=null==o?void 0:o.context_length)&&void 0!==n?n:1e6},temperature:b.getState(),systemPrompt:k.getState()}})(),totalTokens:0,draft:""};await eV(r),tu(),tr()}),(0,i.XM)({clock:tc,target:tm});var th=n(18407),tx=n(71803),tf=n(68534),tv=n(2123);let ty=()=>{let e=(0,tv.e3)(to),t=(0,tv.e3)(tp);return e.visible?(0,r.jsx)(th.A,{elevation:4,sx:{position:"absolute",top:e.y+8,left:e.x-40,zIndex:9999},children:(0,r.jsxs)(tx.A,{direction:"column",spacing:1,padding:1,children:[(0,r.jsx)(tf.A,{size:"small",variant:"contained",onClick:()=>{t.isOpen?ta("> ".concat(e.selectionText,"\n\n")+t.input):ti({initialInput:"> ".concat(e.selectionText,"\n\n"),startCompact:!0}),tr()},children:"Ask"}),(0,r.jsx)(tf.A,{size:"small",variant:"contained",color:"secondary",onClick:()=>{let n="Please explain this to me: ".concat(e.selectionText);t.isOpen||ti({initialInput:""}),ts(n),tr()},children:"Explain"})]})}):null};var tj=n(5939),tA=n.n(tj),tw=n(54581),tb=n(700),tk=n(3127),tM=n(49540),tS=n(69242),tC=n(68004),tI=n(77262),tD=n(60440);let tT=()=>{let{isOpen:e,isCompact:t,messages:n,loading:i,input:l}=(0,tv.e3)(tp),a=o.useRef(null);return e?(0,r.jsx)(tA(),{handle:".drag-handle",nodeRef:a,children:(0,r.jsxs)(th.A,{ref:a,elevation:6,style:{position:"fixed",bottom:"20px",right:"20px",maxWidth:"min(350px, 80vw)",maxHeight:"60vh",overflow:"auto",zIndex:9999,display:"flex",flexDirection:"column",transform:"translate(0, 0)"},children:[(0,r.jsxs)(tx.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{p:.5,pl:1.3,borderBottom:1,borderColor:"divider"},children:[(0,r.jsx)(tw.A,{className:"drag-handle",sx:{cursor:"move",flexGrow:1,mr:1},children:(0,r.jsx)(tb.A,{variant:"subtitle1",children:"Mini chat"})}),(0,r.jsxs)(tx.A,{direction:"row",spacing:1,children:[!t&&(0,r.jsx)(tk.A,{"aria-label":"Expand",size:"small",onClick:()=>tc(),children:(0,r.jsx)(tC.A,{fontSize:"small"})}),(0,r.jsx)(tk.A,{"aria-label":"Close",size:"small",onClick:()=>tl(),children:(0,r.jsx)(tS.A,{fontSize:"small"})})]})]}),!t&&(0,r.jsxs)(tx.A,{spacing:1,sx:{p:1,pb:.2,flexGrow:1,overflowY:"auto"},children:[n.map((e,t)=>(0,r.jsx)(th.A,{className:"chat-message",sx:{p:1,minWidth:"30%",bgcolor:"user"===e.role?"primary.dark":"secondary.dark"},children:(0,r.jsx)(tb.A,{variant:"body2",children:e.content})},t)),i&&(0,r.jsx)(tI.A,{sx:{borderRadius:8}})]}),(0,r.jsx)(tx.A,{direction:"row",spacing:1,sx:{p:1},children:(0,r.jsx)(tM.A,{size:"small",placeholder:"Type a message...",fullWidth:!0,multiline:!0,value:l,onChange:e=>ta(e.target.value),sx:{"& .MuiOutlinedInput-root":{p:.6,pr:1},"& textarea":{pl:1}},slotProps:{input:{style:{marginLeft:1.5},endAdornment:(0,r.jsx)(tk.A,{"aria-label":"send",size:"small",edge:"end",disabled:!l.trim()||i,onClick:()=>{l.trim()&&ts(l.trim())},children:(0,r.jsx)(tD.A,{fontSize:"small"})})}}})})]})}):null};var tE=n(65997),tF=n(74964);async function tP(){var e,t,n,r;if(null===(t=navigator)||void 0===t?void 0:null===(e=t.storage)||void 0===e?void 0:e.estimate){let e=await navigator.storage.estimate();return{quota:null!==(n=e.quota)&&void 0!==n?n:0,usage:null!==(r=e.usage)&&void 0!==r?r:0}}return{quota:0,usage:0}}let tz=(0,i.lh)(),tX=(0,i.y$)({tokensSent:0,tokensReceived:0,contextTokensUsed:0,contextTokensMax:1e6,apiCost:0,chatSizeMB:0,dbSizeMB:0,quotaMB:0,totalUsageMB:0,chatId:null}),tO=tX.map(e=>e.contextTokensMax>0?e.contextTokensUsed/e.contextTokensMax*100:0),tR=(0,i.EH)(async()=>{let{quota:e,usage:t}=await tP();return{quotaMB:e/1048576,dbSizeMB:t/1048576,totalUsageMB:t/1048576,chatSizeMB:0}}),tL=(0,i.EH)(async e=>{var t,n,r,o,i,l;let{chatSession:a,totalTokens:s}=e,d=null!==(i=null==a?void 0:null===(n=a.settings)||void 0===n?void 0:null===(t=n.model)||void 0===t?void 0:t.context_length)&&void 0!==i?i:1e6,c=function(e,t,n){var r,o;return n?+(e/1e6*(null!==(r=n.prompt)&&void 0!==r?r:0)+0*(null!==(o=n.completion)&&void 0!==o?o:0)).toFixed(6):0}(s,0,null==a?void 0:null===(o=a.settings)||void 0===o?void 0:null===(r=o.model)||void 0===r?void 0:r.pricing);return{tokensSent:s,tokensReceived:0,contextTokensUsed:s,contextTokensMax:d,apiCost:c,chatId:null!==(l=null==a?void 0:a.id)&&void 0!==l?l:null}});(0,i.XM)({clock:tz,target:tR}),(0,i.XM)({clock:[tz,e3.updates,ey.updates],source:(0,i.kg)({chatSession:e3,totalTokens:ey}),target:tL}),(0,i.XM)({clock:[tR.doneData,tL.doneData],source:tX,fn:(e,t)=>({...e,...t}),target:tX});let tU=()=>{var e;let t=(0,tv.e3)(tX),n=(0,tv.e3)(tO);return(0,r.jsxs)(tx.A,{spacing:2,children:[(0,r.jsx)(tF.A,{children:"Context"}),(0,r.jsxs)(tb.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Used:"})," ",t.contextTokensUsed.toLocaleString()," / ",t.contextTokensMax.toLocaleString()]}),(0,r.jsx)(tw.A,{children:(0,r.jsx)(tI.A,{variant:"determinate",color:"success",value:Math.min(n,100),sx:{height:8,borderRadius:4,mt:1}})}),(0,r.jsx)(tF.A,{children:"API Cost"}),(0,r.jsxs)(tb.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Estimated Cost:"})," $",t.apiCost.toFixed(6)]}),(0,r.jsx)(tF.A,{children:"Chat Session"}),(0,r.jsxs)(tb.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Chat ID:"})," ",null!==(e=t.chatId)&&void 0!==e?e:"N/A"]}),(0,r.jsx)(tF.A,{children:"Storage"}),(0,r.jsxs)(tb.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Chat Size:"})," ",t.chatSizeMB.toFixed(2)," MB"]}),(0,r.jsxs)(tb.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Total DB:"})," ",t.dbSizeMB.toFixed(2)," MB"]}),(0,r.jsxs)(tb.A,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Quota:"})," ",t.quotaMB.toFixed(2)," MB"]}),(0,r.jsx)(tF.A,{children:"Tokens"}),(0,r.jsxs)(tb.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Sent:"})," ",t.tokensSent.toLocaleString()]}),(0,r.jsxs)(tb.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Received:"})," ",t.tokensReceived.toLocaleString()]}),(0,r.jsxs)(tb.A,{color:"textDisabled",variant:"body2",children:[(0,r.jsx)("strong",{children:"Total:"})," ",(t.tokensSent+t.tokensReceived).toLocaleString()]})]})};var tW=n(56278),tN=n(54492),tB=n(99927);let tG=e=>{let{open:t,onClose:n}=e;return(0,tv.e3)(tX),(0,tv.e3)(tO),(0,r.jsxs)(tW.A,{open:t,onClose:n,maxWidth:"xs",fullWidth:!0,children:[(0,r.jsxs)(tN.A,{children:["Usage Info",(0,r.jsx)(tk.A,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,r.jsx)(tS.A,{})})]}),(0,r.jsx)(tB.A,{children:(0,r.jsx)(tU,{})})]})};var t$=n(16324),tq=n(27943),t_=n(35726),tH=n(18987),tK=n(29267),tZ=n(18096);let tY=(0,i.$5)("ui"),tV=tY.event("showApiKeyDialog"),tJ=tY.event("hideApiKeyDialog"),tQ=tY.event("openSettingsDrawer"),t0=tY.event("closeSettingsDrawer"),t1=tY.event("toggleSettingsDrawer"),t2=tY.event("openModelInfoDrawer"),t3=tY.event("closeModelInfoDrawer"),t6=tY.event("openHistoryDrawer"),t4=tY.event("closeHistoryDrawer"),t5=tY.event("toggleHistoryDrawer"),t8=tY.event("openMobileDrawer"),t9=tY.event("closeMobileDrawer"),t7=tY.event("setMobileDrawerTab"),ne=tY.event("startEditingMessage"),nt=tY.event("stopEditingMessage"),nn=tY.event("openModelInfoAlert"),nr=tY.event("closeModelInfoAlert"),no=tY.effect({name:"loadUiSettingsFx",handler:async()=>{try{let e="true"===localStorage.getItem("ui_historyDrawerOpen"),t="true"===localStorage.getItem("ui_settingsDrawerOpen");return{historyOpen:e,settingsOpen:t}}catch(e){return console.error("Failed to load UI settings from localStorage:",e),{historyOpen:!1,settingsOpen:!1}}}}),ni=tY.effect({name:"saveHistoryDrawerStateFx",handler:async e=>{try{localStorage.setItem("ui_historyDrawerOpen",String(e))}catch(e){console.error("Failed to save history drawer state to localStorage:",e)}}}),nl=tY.effect({name:"saveSettingsDrawerStateFx",handler:async e=>{try{localStorage.setItem("ui_settingsDrawerOpen",String(e))}catch(e){console.error("Failed to save settings drawer state to localStorage:",e)}}}),na=tY.store(!1,{name:"$isHistoryDrawerPersistentOpen"}),ns=tY.store(!1,{name:"$isSettingsDrawerPersistentOpen"}),nd=tY.store(!1).on(tV,()=>!0).on(tJ,()=>!1);tY.store(!1,{name:"isSettingsDrawerOpen"}).on(tQ,()=>!0).on(t0,()=>!1),tY.store(!1,{name:"isHistoryDrawerOpen"}).on(t6,()=>!0).on(t4,()=>!1).on(t5,e=>!e),tY.store(!1,{name:"$isModelInfoDrawerOpen"}).on(t2,()=>!0).on(t3,()=>!1);let nc=tY.store(!1,{name:"$isModelInfoDrawerOpen"}).on(nn,()=>!0).on(nr,()=>!1),nu=tY.store(!1,{name:"isMobileDrawerOpen"}).on(t8,()=>!0).on(t9,()=>!1),np=tY.store("history",{name:"mobileDrawerTab"}).on(t8,(e,t)=>t.tab).on(t7,(e,t)=>t).reset(t9),ng=tY.store(null,{name:"$editingMessageId"}).on(ne,(e,t)=>t).reset(nt);na.on(t5,e=>!e).on(t6,()=>!0).on(t4,()=>!1).on(no.doneData,(e,t)=>t.historyOpen),ns.on(t1,e=>!e).on(tQ,()=>!0).on(t0,()=>!1).on(no.doneData,(e,t)=>t.settingsOpen),ng.reset(eN,eG),(0,i.XM)({clock:eL,target:no}),(0,i.XM)({clock:na.updates,filter:no.pending.map(e=>!e),target:ni}),(0,i.XM)({clock:ns.updates,filter:no.pending.map(e=>!e),target:nl}),(0,i.XM)({clock:[eL,en],source:w,filter:e=>"string"==typeof e&&0===e.trim().length,target:tV}),(0,i.XM)({clock:w,source:nd,filter:(e,t)=>e&&"string"==typeof t&&t.trim().length>0,target:tJ});var nm=n(30529),nh=n(33989),nx=n(14426),nf=n(63148),nv=n(65528),ny=n(22376),nj=n(85222),nA=n(21963),nw=n(76380),nb=n(39489),nk=n(6742),nM=n(25249),nS=n(63954),nC=n(28890),nI=n(19505),nD=n(95206),nT=n(69008),nE=n(62170),nF=n(37857);let nP=e=>{let{searchTerm:t,setSearchTerm:n,isLoading:i,filteredHistory:l,editingId:a,editedTitle:s,currentChatId:d,setEditedTitle:c,handleStartEdit:u,handleSaveEdit:p,handleCancelEdit:g,handleDeleteChat:m,handleSelectChat:h}=e,[x,f]=(0,o.useState)(null),[v,y]=(0,o.useState)(null),[j,A]=(0,o.useState)(""),w=(0,t$.A)(),b=(0,tq.A)(w.breakpoints.down("sm")),k=(0,tv.e3)(nu),M=(e,t,n)=>{e.stopPropagation(),f(e.currentTarget),y(t),A(n)},S=()=>{f(null),y(null),A("")};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(tw.A,{sx:{width:{xs:"100%",sm:360,md:400},maxWidth:"100%",flexGrow:1,display:"flex",flexDirection:"column",height:"100%"},role:"presentation",children:[!k&&(0,r.jsxs)(nm.A,{disableGutters:!0,variant:"dense",sx:{display:"flex",alignItems:"center",justifyContent:"start",pl:2,pr:1,borderBottom:1,borderColor:"divider"},children:[(0,r.jsx)(tb.A,{variant:"h6",sx:{flexGrow:1},children:"Chat History"}),!b&&(0,r.jsx)(tk.A,{"aria-label":"New chat",onClick:()=>eG(),children:(0,r.jsx)(nM.A,{})}),!b&&(0,r.jsx)(tk.A,{onClick:()=>t4(),"aria-label":"close history drawer",children:(0,r.jsx)(nk.A,{})})]}),(0,r.jsx)(tw.A,{sx:{p:2},children:(0,r.jsx)(tM.A,{fullWidth:!0,variant:"outlined",size:"small",placeholder:"Search chats...",value:t,onChange:e=>n(e.target.value),InputProps:{startAdornment:(0,r.jsx)(nh.A,{position:"start",children:(0,r.jsx)(nS.A,{fontSize:"small"})})}})}),(0,r.jsx)(tF.A,{}),(0,r.jsx)(tw.A,{sx:{flexGrow:1,overflowY:"auto"},children:i?(0,r.jsx)(tw.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,r.jsx)(nx.A,{})}):(0,r.jsxs)(nf.A,{disablePadding:!0,children:[0===l.length&&!i&&(0,r.jsx)(tb.A,{sx:{p:2,textAlign:"center",color:"text.secondary"},children:t?"No matching chats found.":"No chat history yet."}),l.map(e=>(0,r.jsx)(nv.Ay,{disablePadding:!0,secondaryAction:(0,r.jsx)(r.Fragment,{children:a===e.id?(0,r.jsx)(tk.A,{edge:"end",size:"small","aria-label":"save",onClick:t=>{t.stopPropagation(),p(e.id)},children:(0,r.jsx)(nD.A,{fontSize:"medium"})}):(0,r.jsx)(tk.A,{edge:"end","aria-label":"more",onClick:t=>M(t,e.id,e.title),children:(0,r.jsx)(nT.A,{fontSize:"medium"})})}),children:(0,r.jsx)(ny.A,{onClick:()=>h(e.id),selected:e.id===d,children:a===e.id?(0,r.jsx)(tw.A,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:(0,r.jsx)(tM.A,{size:"small",value:s,onChange:e=>c(e.target.value),onClick:e=>e.stopPropagation(),onKeyDown:t=>{"Enter"===t.key?(t.preventDefault(),p(e.id)):"Escape"===t.key&&(t.preventDefault(),g())},onBlur:()=>p(e.id),autoFocus:!0,fullWidth:!0,variant:"standard"})}):(0,r.jsx)(nj.A,{primary:e.title,secondary:new Date(e.lastModified).toLocaleString(),primaryTypographyProps:{noWrap:!0,sx:{maxWidth:265,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:e.id===d?"bold":"normal"}},secondaryTypographyProps:{noWrap:!0,fontSize:"0.75rem"}})})},e.id))]})})]}),(0,r.jsxs)(nA.A,{anchorEl:x,open:!!x,onClose:S,onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)(nw.A,{onClick:e=>{e.stopPropagation(),S(),v&&setTimeout(()=>{u(v,j,e)},0)},children:[(0,r.jsx)(nb.A,{children:(0,r.jsx)(nC.A,{fontSize:"small"})}),(0,r.jsx)(nj.A,{primary:"Rename"})]}),(0,r.jsxs)(nw.A,{onClick:()=>{v&&e_(v),S()},children:[(0,r.jsx)(nb.A,{children:(0,r.jsx)(nE.A,{fontSize:"small"})}),(0,r.jsx)(nj.A,{primary:"Duplicate"})]}),(0,r.jsxs)(nw.A,{onClick:()=>{v&&eH(v),S()},children:[(0,r.jsx)(nb.A,{children:(0,r.jsx)(nF.A,{fontSize:"small"})}),(0,r.jsx)(nj.A,{primary:"Regenerate Title"})]}),(0,r.jsxs)(nw.A,{onClick:e=>{e.stopPropagation(),v&&m(v,e),S()},sx:{color:"error.main"},children:[(0,r.jsx)(nb.A,{sx:{color:"error.main"},children:(0,r.jsx)(nI.A,{fontSize:"small"})}),(0,r.jsx)(nj.A,{primary:"Delete"})]})]})]})};var nz=n(11698);let nX=()=>{let[e,t]=(0,o.useState)(!1),n=(0,tv.e3)(E),i=(0,tv.e3)(P),l=(0,tv.e3)(e7),a=(0,tv.e3)(z),s=o.useMemo(()=>{var e;return null!==(e=n.find(e=>e.id===l))&&void 0!==e?e:null},[n,l]),d=o.useMemo(()=>{let e=n;return a&&(e=e.filter(e=>{var t,n;return(null===(t=e.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=e.pricing)||void 0===n?void 0:n.completion)==="0"})),e},[n,a]);return(0,r.jsx)(tw.A,{sx:{my:1},children:(0,r.jsx)(nz.A,{id:"mini-chat-model-selector",sx:{width:"100%"},open:e,onOpen:()=>{t(!0),0===n.length&&U()},onClose:()=>{t(!1)},value:s,onChange:(e,t)=>{t&&e9(t.id)},isOptionEqualToValue:(e,t)=>e.id===t.id,getOptionLabel:e=>e.name||e.id,options:d,loading:i,renderInput:e=>(0,r.jsx)(tM.A,{...e,label:"Mini-Chat Model",variant:"outlined",size:"small",InputProps:{...e.InputProps,endAdornment:(0,r.jsxs)(o.Fragment,{children:[i?(0,r.jsx)(nx.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})}}),renderOption:(e,t)=>(0,o.createElement)(tw.A,{component:"li",...e,key:t.id},t.name||t.id)})})};var nO=n(83729),nR=n(82330),nL=n(4915),nU=n(82449),nW=n(11247),nN=n(58674),nB=n(81787);let nG=e=>{let{apiKey:t,showApiKey:n,temperature:i,systemPrompt:l,currentChatTokens:a,handleApiKeyChange:s,handleSystemPromptChange:d,handleTemperatureChange:c,handleClickShowApiKey:u,handleMouseDownApiKey:p}=e,g=(0,tv.e3)(X),[m,h]=o.useState(!1),x=(0,tv.e3)(nu),[f,v]=(0,tv.e3)([O,E]),y=o.useMemo(()=>{var e;return null!==(e=v.find(e=>e.id===f))&&void 0!==e?e:null},[v,f]);return o.useEffect(()=>{h(z.getState())},[]),(0,r.jsxs)(tw.A,{sx:{width:{xs:"100%",sm:360,md:400},maxWidth:"100%",flexGrow:1,display:"flex",flexDirection:"column",height:"100%"},children:[!x&&(0,r.jsxs)(nm.A,{disableGutters:!0,variant:"dense",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:2},children:[(0,r.jsx)(tb.A,{variant:"h6",children:"Chat Settings"}),(0,r.jsx)(tk.A,{onClick:()=>t0(),"aria-label":"close settings drawer",edge:"end",children:(0,r.jsx)(nW.A,{})})]}),(0,r.jsxs)(tw.A,{sx:{px:2,pt:2},children:[(0,r.jsxs)(tb.A,{gutterBottom:!0,children:["Temperature: ",i.toFixed(1)]}),(0,r.jsx)(nO.A,{title:"Controls randomness. Lower values are more deterministic.",placement:"left",children:(0,r.jsx)(nR.Ay,{value:i,onChange:(e,t)=>"number"==typeof t&&c(t),"aria-labelledby":"temperature-slider",step:.1,marks:!0,min:0,max:2})})]}),(0,r.jsx)(tF.A,{}),(0,r.jsx)(tw.A,{sx:{p:2,pb:1},children:(0,r.jsx)(nO.A,{title:"Your OpenRouter API Key. Stored locally in your browser.",placement:"left",children:(0,r.jsx)(tM.A,{size:"small",fullWidth:!0,label:"OpenRouter API Key",variant:"outlined",type:n?"text":"password",value:t,onChange:e=>s(e.target.value),InputProps:{endAdornment:(0,r.jsx)(nh.A,{position:"end",children:(0,r.jsx)(tk.A,{"aria-label":"toggle api key visibility",onClick:u,onMouseDown:p,edge:"end",size:"small",children:n?(0,r.jsx)(nB.A,{}):(0,r.jsx)(nN.A,{})})})}})})}),(0,r.jsx)(tw.A,{sx:{px:2},children:(0,r.jsx)(nL.A,{control:(0,r.jsx)(nU.A,{checked:m,onChange:e=>{let t=e.target.checked;h(t),g(t)},color:"primary"}),label:"Show only free models"})}),(0,r.jsx)(tw.A,{sx:{px:2,py:1},children:(0,r.jsx)(nX,{})}),(0,r.jsx)(tw.A,{sx:{px:2,pb:2,pt:1},children:(0,r.jsx)(nz.A,{size:"small",options:v,groupBy:e=>e.created?new Date(1e3*e.created).toLocaleString("default",{month:"long",year:"numeric"}):"Unknown",getOptionLabel:e=>e.name.replace(/^[^:]+:\s*/,"")||e.id,value:y,onChange:(e,t)=>{t&&R(t.id)},renderInput:e=>(0,r.jsx)(tM.A,{...e,label:"AutoTitle Model",variant:"outlined",fullWidth:!0}),isOptionEqualToValue:(e,t)=>e.id===t.id})}),(0,r.jsx)(tF.A,{}),(0,r.jsxs)(tw.A,{sx:{px:2,py:1,flexGrow:1,display:"flex",flexDirection:"column"},children:[(0,r.jsx)(tb.A,{variant:"overline",gutterBottom:!0,children:"System Prompt"}),(0,r.jsx)(tM.A,{fullWidth:!0,variant:"outlined",multiline:!0,value:l,onChange:e=>d(e.target.value),sx:{"& .MuiInputBase-input":{resize:"vertical"}},InputProps:{sx:{height:"100%"}}})]})]})};var n$=n(94980);let nq=e=>{var t,n,o,i;let{model:l}=e,a=(0,tv.e3)(nu),s=(null===(t=l.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=l.pricing)||void 0===n?void 0:n.completion)==="0",d=l.created?new Date(1e3*l.created).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"",c=(null===(o=l.pricing)||void 0===o?void 0:o.prompt)?(1e6*parseFloat(l.pricing.prompt)).toFixed(2):"0",u=(null===(i=l.pricing)||void 0===i?void 0:i.completion)?(1e6*parseFloat(l.pricing.completion)).toFixed(2):"0";return(0,r.jsxs)(tw.A,{children:[!a&&(0,r.jsx)(nm.A,{variant:"dense",disableGutters:!0,children:(0,r.jsx)(tb.A,{variant:"h6",fontWeight:"bold",children:"Model Info"})}),(0,r.jsxs)(tw.A,{padding:2,children:[(0,r.jsxs)(tx.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(tb.A,{variant:"h6",fontWeight:"bold",children:l.name}),s&&(0,r.jsx)(nO.A,{title:"Free model",children:(0,r.jsx)(n$.A,{fontSize:"small"})})]}),(0,r.jsxs)(tx.A,{direction:"row",alignItems:"center",spacing:1,mt:1,children:[(0,r.jsx)(tb.A,{variant:"body2",fontFamily:"monospace",children:l.id}),(0,r.jsx)(nO.A,{title:"Copy model ID",children:(0,r.jsx)(tk.A,{size:"small",onClick:()=>{navigator.clipboard.writeText(l.id)},children:(0,r.jsx)(nE.A,{fontSize:"small"})})})]}),(0,r.jsx)(tF.A,{sx:{my:2}}),(0,r.jsxs)(tx.A,{spacing:1,flexWrap:"wrap",children:[(0,r.jsxs)(tx.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(tb.A,{variant:"body2",color:"text.secondary",children:["Created ",d]}),(0,r.jsxs)(tb.A,{variant:"body2",color:"text.secondary",children:[l.context_length.toLocaleString()," context"]})]}),(0,r.jsxs)(tx.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(tb.A,{variant:"body2",color:"text.secondary",children:["$",c,"/M input tokens"]}),(0,r.jsxs)(tb.A,{variant:"body2",color:"text.secondary",children:["$",u,"/M output tokens"]})]})]}),(0,r.jsx)(tF.A,{sx:{my:2}}),(0,r.jsx)(tb.A,{variant:"body2",color:"text.primary",whiteSpace:"pre-line",children:l.description})]})]})},n_=e=>{let{historyPanelProps:t,settingsPanelProps:n,modelInfo:o}=e,[i,l]=(0,tv.e3)([nu,np]),a=(0,tv.e3)(t9),s=(0,tv.e3)(t7);return(0,r.jsx)(tH.Ay,{anchor:"bottom",open:i,onClose:a,ModalProps:{keepMounted:!0},children:(0,r.jsxs)(tw.A,{sx:{display:"flex",flexDirection:"column",height:"calc(100vh - 64px)"},children:[(0,r.jsxs)(tK.A,{value:l,onChange:(e,t)=>s(t),variant:"fullWidth",indicatorColor:"secondary",textColor:"inherit",sx:{borderTop:1,borderColor:"divider",backgroundColor:"background.paper"},children:[(0,r.jsx)(tZ.A,{sx:{fontWeight:"history"===l?"bold":"normal"},value:"history",label:"History"}),(0,r.jsx)(tZ.A,{sx:{fontWeight:"settings"===l?"bold":"normal"},value:"settings",label:"Settings"}),(0,r.jsx)(tZ.A,{sx:{fontWeight:"modelInfo"===l?"bold":"normal"},value:"modelInfo",label:"Model"}),(0,r.jsx)(tZ.A,{sx:{fontWeight:"usage"===l?"bold":"normal"},value:"usage",label:"Usage"})]}),(0,r.jsx)(tF.A,{}),(0,r.jsxs)(tw.A,{sx:{flexGrow:1,overflow:"auto"},children:["history"===l&&(0,r.jsx)(nP,{...t}),"settings"===l&&(0,r.jsx)(nG,{...n}),"modelInfo"===l&&o&&(0,r.jsx)(nq,{model:o}),"usage"===l&&(0,r.jsx)(tw.A,{p:2,children:(0,r.jsx)(tU,{})})]})]})})};var nH=n(71169),nK=n(67217),nZ=n(20904),nY=n(3337),nV=n(9665),nJ=n(28005),nQ=n(41218),n0=n(13368),n1=n(8494),n2=n(33290),n3=n(80744),n6=n(29652),n4=n(4075),n5=n(31050),n8=n(59011);let n9=e=>{let{content:t}=e;return(0,r.jsx)(n2.oz,{children:t,remarkPlugins:[n3.A,n6.A],rehypePlugins:[n4.A],components:{code(e){let{node:t,inline:n,className:o,children:i,style:l,ref:a,...s}=e,d=/language-(\w+)/.exec(o||""),c=String(i).replace(/\n$/,"");return d&&"mermaid"===d[1]?(0,r.jsxs)("div",{style:{marginTop:"8px",marginBottom:"8px"},children:[" ",(0,r.jsx)(n5.d,{children:c})]}):!n&&d?(0,r.jsx)(n8.f4,{code:c,language:d[1],theme:n8.Zj.vsDark,children:e=>{let{className:t,style:n,tokens:o,getLineProps:i,getTokenProps:l}=e;return(0,r.jsx)("pre",{className:t,style:{...n,padding:"12px",borderRadius:"6px",overflowX:"auto"},children:o.map((e,t)=>(0,r.jsx)("div",{...i({line:e}),children:e.map((e,t)=>(0,r.jsx)("span",{...l({token:e})},t))},t))})}}):(0,r.jsx)("code",{className:o,...s,style:{backgroundColor:"rgba(128, 128, 128, 0.15)",padding:"0.1em 0.3em",borderRadius:"4px",fontFamily:"monospace",fontSize:"0.9em"},children:i})}}})},n7=(e,t)=>{let{visibleDelay:n}=e;return()=>{let e=t();requestAnimationFrame(()=>setTimeout(()=>requestAnimationFrame(()=>e()),n))}},re=e=>{let{message:t}=e,n=(0,t$.A)(),i=(0,tv.e3)(ev),l=(0,tv.e3)(eA),s=(0,tv.e3)(ng),[d,c]=(0,o.useState)(!1),[u,p]=(0,o.useState)(!1),[g,m]=(0,o.useState)(!1),[h,x]=(0,o.useState)(!1),[f,v]=(0,o.useState)(t.content),[y,j]=(0,o.useState)(""),A=(0,o.useRef)(null),w=i&&l===t.id,b=s===t.id,k=null===s,M=()=>{h||null!==s||(j(t.content),ne(t.id),x(!0))},S=()=>{x(!1),v(y),nt(),requestAnimationFrame(()=>el(!1))},C=()=>{f!==y&&J({messageId:t.id,newContent:f}),x(!1),nt(),requestAnimationFrame(()=>el(!1))},I=(0,nJ.HZ)(n7({visibleDelay:20},()=>(p(!0),()=>{p(!1),Q(t.id)})),{threshold:400})("delete"),D=(0,nJ.HZ)(n7({visibleDelay:20},()=>(m(!0),()=>{m(!1),ee(t)})),{threshold:400})("retry");return(0,o.useEffect)(()=>{},[h,C]),(0,r.jsx)(th.A,{className:"chat-message",ref:A,variant:"outlined",id:t.id,onMouseEnter:()=>k&&c(!0),onMouseLeave:()=>k&&c(!1),sx:{borderRadius:2,display:"flex",flexDirection:"column",position:"relative",borderColor:b?n.palette.secondary.light:d&&k?n.palette.primary.light:"transparent",padding:2,transition:n.transitions.create("border-color")},children:(0,r.jsxs)(nQ.A,{raised:!0,elevation:1,sx:{p:2,borderRadius:2,alignSelf:"user"===t.role?"flex-end":"flex-start",backgroundColor:"user"===t.role?"primary.dark":n.palette.background.paper,width:h?"-webkit-fill-available":"fit-content",maxWidth:"85%",wordWrap:"break-word"},children:[h?(0,r.jsx)(n0.Ay,{multiline:!0,fullWidth:!0,value:f,onChange:e=>{v(e.target.value)},autoFocus:!0,onKeyDown:e=>{"Escape"===e.key&&S()},sx:{padding:0,borderBottom:0,fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",color:"inherit","& .MuiInputBase-input":{resize:"vertical"}}}):(0,r.jsx)(tb.A,{onDoubleClick:M,component:"div",variant:"body1",sx:{fontSize:"inherit",overflowWrap:"break-word",width:"100%"},children:(0,r.jsx)(n9,{content:t.content})}),(w||t.isLoading)&&(0,r.jsx)(nx.A,{size:20,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-10px",marginLeft:"-10px",zIndex:1}}),(0,r.jsx)(th.A,{elevation:0,sx:{position:"absolute",borderRadius:20,top:-18,right:4,bgcolor:"background.default",p:.25,gap:.5,display:b||d&&k?"flex":"none",opacity:b||d&&k?1:0,transition:n.transitions.create("opacity"),zIndex:2},children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tk.A,{"aria-label":"confirm",color:"success",size:"small",onClick:C,title:"Confirm Edit (Enter)",children:(0,r.jsx)(nD.A,{fontSize:"small"})}),(0,r.jsx)(tk.A,{"aria-label":"cancel",color:"inherit",size:"small",onClick:S,title:"Cancel Edit (Escape)",children:(0,r.jsx)(tS.A,{fontSize:"small"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tk.A,{"aria-label":"copy",size:"small",color:"inherit",onClick:()=>{"string"==typeof t.content?navigator.clipboard.writeText(t.content).then(()=>console.log("Code/Markdown copied to clipboard")).catch(e=>console.error("Failed to copy code/markdown: ",e)):console.error("Cannot copy non-string content as code/markdown")},title:"Copy Markdown",children:(0,r.jsx)(nE.A,{fontSize:"small"})}),(0,r.jsx)(tk.A,{"aria-label":"edit",size:"small",onClick:M,color:"inherit",title:"Edit Message (Double-Click)",children:(0,r.jsx)(nC.A,{fontSize:"small"})}),(0,r.jsx)(tk.A,{"aria-label":"delete",size:"small",onClick:()=>{a({message:"Long press to delete a message.",severity:"info"})},title:"Long press to delete",color:u?"error":"inherit",...I,children:(0,r.jsx)(nI.A,{fontSize:"small"})}),(0,r.jsx)(tk.A,{"aria-label":"retry",size:"small",onClick:()=>{a({message:"Long press to regenerate a message.",severity:"info"})},title:"Retry Generation",disabled:i,color:g?"success":"inherit",...D,children:(0,r.jsx)(n1.A,{fontSize:"small"})})]})})]})},t.id)};var rt=n(71977),rn=n(76871),rr=n(60744);let ro=o.forwardRef(function(e,t){return(0,r.jsx)(rr.A,{direction:"up",ref:t,...e})});function ri(e){let t=o.useRef(null);return(0,r.jsx)(tA(),{nodeRef:t,handle:"#draggable-dialog-title",cancel:'[class*="MuiDialogContent-root"]',children:(0,r.jsx)(th.A,{...e,ref:t})})}function rl(){let[e,t,n]=(0,tv.e3)([nd,tJ,tQ]);return(0,r.jsxs)(tW.A,{open:e,onClose:t,PaperComponent:ri,TransitionComponent:ro,keepMounted:!0,"aria-labelledby":"draggable-dialog-title","aria-describedby":"alert-dialog-slide-description",children:[(0,r.jsx)(tN.A,{style:{cursor:"move"},id:"draggable-dialog-title",children:"API Key Required"}),(0,r.jsx)(tB.A,{children:(0,r.jsx)(rn.A,{id:"alert-dialog-slide-description",children:"Your OpenRouter API key is missing. Please enter it in Chat Settings to enable sending messages."})}),(0,r.jsxs)(rt.A,{children:[(0,r.jsx)(tf.A,{onClick:t,children:"Close"}),(0,r.jsx)(tf.A,{onClick:()=>{t(),n()},autoFocus:!0,children:"Go to Settings"})]})]})}var ra=n(67350),rs=n(58748),rd=n(57316),rc=n(4420);let ru=(0,rd.A)("div")(e=>{let{theme:t}=e;return{position:"sticky",top:-8,paddingLeft:16,paddingBottom:1,paddingTop:1,color:(0,rc.a)(t.palette.secondary.light,.4),backgroundColor:(0,rc.a)(t.palette.secondary.light,.9),...t.applyStyles("dark",{backgroundColor:(0,rc.e$)(t.palette.secondary.light,.5)})}}),rp=(0,rd.A)("ul")({padding:0}),rg=()=>{let e=(0,t$.A)(),t=(0,tq.A)(e.breakpoints.down("sm")),{models:n,selectedModelId:i,isLoading:l,error:a,handleModelSelect:s,retryFetch:d,showFreeOnly:c}=(0,tv.e3)({models:E,selectedModelId:F,isLoading:P,error:L,handleModelSelect:W,retryFetch:U,showFreeOnly:z}),[u,p]=(0,o.useState)(!1),g=(0,o.useMemo)(()=>{let e=n;return c&&(e=e.filter(e=>{var t,n;return(null===(t=e.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=e.pricing)||void 0===n?void 0:n.completion)==="0"})),e},[n,c]);(0,o.useMemo)(()=>{let e=n.find(e=>e.id===i);return e?e.name.replace(/^[^:]+:\s*/,""):i},[n,i]);let m=(0,o.useMemo)(()=>n.find(e=>e.id===i),[n,i]);return(0,r.jsxs)(tw.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",flexGrow:1},children:[a&&!l&&(0,r.jsx)(nO.A,{title:"Error loading models: ".concat(a,". Click to retry."),children:(0,r.jsx)(ra.A,{color:"error",sx:{mr:1,cursor:"pointer"},onClick:()=>d()})}),(0,r.jsx)(nz.A,{groupBy:e=>e.created?new Date(1e3*e.created).toLocaleString("default",{month:"long",year:"numeric"}):"Unknown",renderGroup:e=>(0,r.jsxs)("li",{children:[(0,r.jsx)(ru,{children:e.group}),(0,r.jsx)(rp,{children:e.children})]},e.key),id:"appbar-model-selector",value:null!=m?m:null,open:u,onOpen:()=>p(!0),onClose:()=>p(!1),onChange:(e,t)=>{t&&s(t.id)},options:g,getOptionLabel:e=>e.name.replace(/^[^:]+:\s*/,"")||e.id,isOptionEqualToValue:(e,t)=>e.id===t.id,loading:l,disabled:l||null!==a,sx:{maxWidth:460,flexGrow:1,mx:.6},renderInput:e=>(0,r.jsx)(tM.A,{...e,variant:"outlined",placeholder:"Select Model...",InputProps:{...e.InputProps,style:{color:"inherit",height:"36px"},endAdornment:(0,r.jsx)(o.Fragment,{children:e.InputProps.endAdornment})},inputProps:{...e.inputProps,style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}}),renderOption:(e,t)=>(0,o.createElement)(tw.A,{component:"li",...e,key:t.id,children:[t.name," "]})}),!t&&(0,r.jsx)(tk.A,{size:"small",onClick:()=>{t?t8({tab:"modelInfo"}):nn()},disabled:!m,sx:{color:"inherit"},children:(0,r.jsx)(rs.A,{})})]})},rm=e=>{var t,n,o,i;let{model:l}=e;(0,tv.e3)(nu),(0,tv.e3)(nc);let a=(0,tv.e3)(nc),s=(null===(t=l.pricing)||void 0===t?void 0:t.prompt)==="0"&&(null===(n=l.pricing)||void 0===n?void 0:n.completion)==="0",d=l.created?new Date(1e3*l.created).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"",c=(null===(o=l.pricing)||void 0===o?void 0:o.prompt)?(1e6*parseFloat(l.pricing.prompt)).toFixed(2):"0",u=(null===(i=l.pricing)||void 0===i?void 0:i.completion)?(1e6*parseFloat(l.pricing.completion)).toFixed(2):"0";return(0,r.jsxs)(tW.A,{scroll:"body",open:a,onClose:()=>nr(),"aria-labelledby":"Model info","aria-describedby":"Shows Model name, date, cost, and description",children:[(0,r.jsx)(tN.A,{children:"Model Info"}),(0,r.jsx)(tB.A,{children:(0,r.jsxs)(tw.A,{children:[(0,r.jsxs)(tx.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(tb.A,{variant:"h6",fontWeight:"bold",children:l.name}),s&&(0,r.jsx)(nO.A,{title:"Free model",children:(0,r.jsx)(n$.A,{fontSize:"small"})})]}),(0,r.jsxs)(tx.A,{direction:"row",alignItems:"center",spacing:1,mt:1,children:[(0,r.jsx)(tb.A,{variant:"body2",fontFamily:"monospace",children:l.id}),(0,r.jsx)(nO.A,{title:"Copy model ID",children:(0,r.jsx)(tk.A,{size:"small",onClick:()=>{navigator.clipboard.writeText(l.id)},children:(0,r.jsx)(nE.A,{fontSize:"small"})})})]}),(0,r.jsx)(tF.A,{sx:{my:2}}),(0,r.jsxs)(tx.A,{spacing:1,flexWrap:"wrap",children:[(0,r.jsxs)(tx.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(tb.A,{variant:"body2",color:"text.secondary",children:["Created ",d]}),(0,r.jsxs)(tb.A,{variant:"body2",color:"text.secondary",children:[l.context_length.toLocaleString()," context"]})]}),(0,r.jsxs)(tx.A,{direction:"row",spacing:2,flexWrap:"wrap",children:[(0,r.jsxs)(tb.A,{variant:"body2",color:"text.secondary",children:["$",c,"/M input tokens"]}),(0,r.jsxs)(tb.A,{variant:"body2",color:"text.secondary",children:["$",u,"/M output tokens"]})]})]}),(0,r.jsx)(tF.A,{sx:{my:2}}),(0,r.jsx)(tb.A,{variant:"body2",color:"text.primary",whiteSpace:"pre-line",children:l.description})]})}),(0,r.jsx)(rt.A,{children:(0,r.jsx)(tw.A,{sx:{p:2,display:"flex",alignSelf:"center"},children:(0,r.jsx)(tf.A,{variant:"contained",onClick:()=>nr(),autoFocus:!0,children:"Ok"})})})]})};function rh(){(0,o.useEffect)(()=>{function e(){let e=window.getSelection();if(!e||e.isCollapsed){tr();return}let t=e.getRangeAt(0).getBoundingClientRect(),n=e.anchorNode;for(;n&&1!==n.nodeType;)n=n.parentElement;if(!n||!n.closest(".chat-message")){tr();return}let r=e.toString().trim();if(!r){tr();return}tn({x:t.left+t.width/2+window.scrollX,y:t.bottom+window.scrollY,selectionText:r})}document.addEventListener("selectionchange",e);let t=()=>tr();return document.addEventListener("scroll",t,!0),()=>{document.removeEventListener("selectionchange",e),document.removeEventListener("scroll",t,!0)}},[]);let e=o.useRef(null),t=(0,t$.A)(),n=(0,tq.A)(t.breakpoints.down("sm")),[i,l]=(0,tv.e3)([ef,ex]),c=i.length>0?i[i.length-1]:null,[u,p]=(0,tv.e3)([na,ns]),[g,m]=(0,tv.e3)([e3,w]),h=(0,tv.e3)(ng),[x,v]=(0,tv.e3)([ev,ej]),M=(0,tv.e3)(ew);(0,tv.e3)(nu);let[S,C,I,D,T]=(0,tv.e3)([e2,e6,eN,eB,e3.map(e=>{var t;return null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null})]),{apiKey:P,temperature:z,systemPrompt:X,currentChatTokens:O}=(0,tv.e3)({apiKey:w,temperature:b,systemPrompt:k,currentChatTokens:ey}),[R,L]=o.useState(""),[W,N]=o.useState(!1),[B,G]=o.useState(null),[$,q]=o.useState(""),[_,H]=o.useState(!1),K=(0,tv.e3)(d),Z=o.useMemo(()=>R?S.filter(e=>e.title.toLowerCase().includes(R.toLowerCase())):S,[S,R]),J=()=>{n?t8({tab:"settings"}):t1()},Q=()=>{if(null!==h){let e=document.getElementById(h);e&&e.scrollIntoView({behavior:"smooth",block:"center"}),console.log("Editing message, not sending new one"),a({message:"Finish editing before sending a new message.",severity:"warning"});return}let e=0===l.trim().length,t=(null==c?void 0:c.role)==="user";e?t&&!x&&ea():x||V()},ee={searchTerm:R,setSearchTerm:L,isLoading:C,filteredHistory:Z,editingId:B,editedTitle:$,currentChatId:T,setEditedTitle:q,handleStartEdit:(e,t,n)=>{n.stopPropagation(),G(e),q(t)},handleSaveEdit:e=>{e$({id:e,newTitle:$.trim()}),G(null)},handleCancelEdit:()=>{G(null)},handleDeleteChat:(e,t)=>{t.stopPropagation(),D(e)},handleSelectChat:e=>{I(e),n&&t9()}},et={apiKey:P,showApiKey:_,temperature:z,systemPrompt:X,currentChatTokens:O,handleApiKeyChange:y,handleTemperatureChange:j,handleSystemPromptChange:A,handleClickShowApiKey:()=>H(e=>!e),handleMouseDownApiKey:e=>{e.preventDefault()}},[en,er]=(0,tv.e3)([F,E]),eo=o.useMemo(()=>er.find(e=>e.id===en),[er,en]);o.useEffect(()=>{M&&el(!1)},[M]);let ei=(0,tv.e3)(ew),es=(0,tv.e3)(eb);return o.useEffect(()=>{ei||requestAnimationFrame(()=>{var t;null===(t=e.current)||void 0===t||t.scrollIntoView({behavior:"smooth"})})},[c,es,ei]),o.useEffect(()=>{f(),U(),eL()},[]),(0,r.jsxs)(tw.A,{sx:{height:"100vh",overflow:"hidden",fontSize:20},children:[" ",(0,r.jsx)(nH.A,{position:"fixed",sx:e=>{let t=!n&&u,r=!n&&p,o="100%",i="0px",l="0px",a={easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen};return t&&r?(o="calc(100% - ".concat(600,"px)"),i="".concat(300,"px"),l="".concat(300,"px"),a={easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}):t?(o="calc(100% - ".concat(300,"px)"),i="".concat(300,"px"),l="0px",a={easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}):r&&(o="calc(100% - ".concat(300,"px)"),i="0px",l="".concat(300,"px"),a={easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),{width:o,marginLeft:i,marginRight:l,transition:e.transitions.create(["margin","width"],a)}},children:(0,r.jsxs)(nm.A,{variant:"dense",disableGutters:!0,sx:{px:1,borderBottom:1,borderColor:"divider"},children:[(!u||n)&&(0,r.jsx)(tk.A,{color:"inherit","aria-label":"History",onClick:()=>{n?t8({tab:"history"}):t5()},children:(0,r.jsx)(nk.A,{})}),(!u||n)&&(0,r.jsx)(tk.A,{size:"small",color:"inherit","aria-label":"New chat",onClick:()=>eG(),children:(0,r.jsx)(nM.A,{})}),(0,r.jsx)(tw.A,{sx:{flexGrow:1,display:"flex",justifyContent:"center"},children:(0,r.jsx)(rg,{})}),!n&&(0,r.jsx)(tk.A,{color:"inherit","aria-label":"usage info",onClick:()=>{tz(),N(!0)},children:(0,r.jsx)(tE.A,{})}),!p&&!n&&(0,r.jsx)(tk.A,{color:"inherit","aria-label":"settings",onClick:J,children:(0,r.jsx)(nW.A,{})}),n&&(0,r.jsx)(tk.A,{size:"small",edge:"end",color:"inherit","aria-label":"settings",onClick:J,children:(0,r.jsx)(nW.A,{})})]})}),(0,r.jsxs)(tw.A,{component:"main",sx:e=>({flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:0,marginRight:0,...u&&!n&&{marginLeft:"".concat(300,"px"),transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},...p&&!n&&{marginRight:"".concat(300,"px"),transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},pt:"".concat(Number(e.mixins.toolbar.minHeight)-16,"px"),pb:0,boxSizing:"border-box"}),children:[(0,r.jsxs)(tw.A,{sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",width:"100%",p:n?1:2,pt:n?2:3,position:"relative"},children:[(0,r.jsxs)(nK.A,{maxWidth:"md",disableGutters:!0,sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%"},children:[(0,r.jsx)(th.A,{elevation:0,sx:{backgroundColor:"transparent",display:"flex",flexDirection:"column",width:"100%",alignItems:"center"},children:(0,r.jsxs)(tx.A,{alignItems:"center",sx:{alignItems:"stretch",width:"100%"},children:[i.map(e=>(0,r.jsx)(re,{message:e},e.id)),(0,r.jsx)("div",{ref:e})]})})," "]})," ",(0,r.jsx)(t_.A,{open:K.open,anchorOrigin:{vertical:"top",horizontal:"center"},sx:e=>{let t=Number(e.mixins.toolbar.minHeight)+8;return{top:"".concat(t,"px !important")}},children:(0,r.jsx)(nV.A,{variant:"filled",onClose:()=>s(),severity:K.severity,children:K.message})})]})," ",v&&(0,r.jsx)(nK.A,{maxWidth:"md",sx:{px:n?1:2,width:"100%"},children:(0,r.jsx)(nV.A,{severity:"error",sx:{mt:1,mb:1,width:"100%"},children:v})}),(0,r.jsx)(tI.A,{color:"secondary",sx:{top:1,poosition:"absolute",width:"100%",height:"1px",visibility:x?"visible":"hidden"}}),(0,r.jsxs)(th.A,{square:!0,sx:{mt:"auto",width:"100%",backgroundColor:"background.paper",flexShrink:0,borderTop:1,borderColor:"divider",p:1},children:[(0,r.jsxs)(tw.A,{maxWidth:"md",sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[(0,r.jsxs)(tk.A,{sx:{mx:-.5},color:"primary","aria-label":"attach file",disabled:!0,children:[" ",(0,r.jsx)(nY.A,{})]}),(0,r.jsx)(tM.A,{fullWidth:!0,multiline:!0,maxRows:5,variant:"outlined",placeholder:"Type your message...",sx:{flexGrow:1},slotProps:{input:{sx:{fontSize:22,py:1}}},value:l,onChange:e=>Y(e.target.value)}),(0,r.jsx)(tw.A,{children:(()=>{let e=0===l.trim().length,t=i.length>0?i[i.length-1]:null,n=(null==t?void 0:t.role)==="user";return(0,r.jsxs)(tk.A,{"aria-label":"Generate",onClick:Q,disabled:x||e&&!n,sx:{mx:-.5,color:"primary.light"},children:[(0,r.jsx)(nZ.A,{})," "]})})()})]})," "]})," ",(0,r.jsx)(rl,{})]})," ",(0,r.jsx)(tG,{open:W,onClose:()=>N(!1)}),!n&&(0,r.jsx)(tH.Ay,{variant:"persistent",open:u,anchor:"left",sx:{width:300,flexShrink:0,"& .MuiDrawer-paper":{width:300,boxSizing:"border-box"}},children:(0,r.jsx)(tw.A,{sx:{overflow:"auto"},children:(0,r.jsx)(nP,{...ee})})}),!n&&(0,r.jsx)(tH.Ay,{variant:"persistent",open:p,anchor:"right",sx:{width:300,flexShrink:0,"& .MuiDrawer-paper":{width:300,boxSizing:"border-box"}},children:(0,r.jsx)(nG,{...et})}),n&&(0,r.jsx)(n_,{historyPanelProps:ee,settingsPanelProps:et,modelInfo:eo}),!!eo&&(0,r.jsx)(rm,{model:eo}),(0,r.jsx)(ty,{}),(0,r.jsx)(tT,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5661,7330,9568,4410,8441,1684,7358],()=>t(1562)),_N_E=e.O()}]);